<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenTezos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenTezos Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Smart contracts | OpenTezos</title><meta data-react-helmet="true" property="og:url" content="https://opentezos.com/tezos-basics/smart-contracts"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Smart contracts | OpenTezos"><meta data-react-helmet="true" name="description" content="In this chapter, you will learn the Tezos smart contracts basics. Their components and the workflow to record and use them on the Tezos blockchain."><meta data-react-helmet="true" property="og:description" content="In this chapter, you will learn the Tezos smart contracts basics. Their components and the workflow to record and use them on the Tezos blockchain."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://opentezos.com/tezos-basics/smart-contracts"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/tezos-basics/smart-contracts" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/tezos-basics/smart-contracts" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d7943943.css">
<link rel="preload" href="/assets/js/runtime~main.e4f1d814.js" as="script">
<link rel="preload" href="/assets/js/main.cec49b6e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT" style="margin-left:2px">üåô</span></div><div class="react-toggle-track-x"><span class="toggle_71bT" style="margin-left:1px">‚òÄÔ∏è</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Welcome</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/paths">Paths</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Blockchain Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/main-properties">Main properties of the first &quot;blockchain&quot;</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/proof-of-work">Proof-of-work</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/other-consensuses">Introduction to other consensuses</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/exam">Exam</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tezos Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/tezos-basics/smart-contracts">Smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/liquid-proof-of-stake">Liquid Proof-of-Stake</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/operations">Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/cli-and-rpc">CLI and RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/governance-on-chain">Governance on-chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/history-of-amendments">History of amendments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/economics-and-rewards">Economics and rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy a node</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to use an Explorer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/indexer-explained">How Indexers Work?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/available-tezos-indexers">Available Tezos Explorers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-main-features">How to use the tzStats blockchain explorer?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-smart-contract">Checkout your smart contract on TzStats</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/private-indexer">Private indexer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SmartPy</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/write-contract-smartpy">Smart contract development with SmartPy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">LIGO</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/write-contracts-ligo">Smart contract development in Pascaligo</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/language-basics">Language basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/deploy-a-contract">Smart Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/unit-testing">Unit Testing with PyTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/take-away">Take Away</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Michelson</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/tutorial">Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/instructions-reference">Instructions Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/take-away">Take away</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Build a Dapp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/truffle_compilation_migration">Smart contract deployment with Truffle</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Baking</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy Bakers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DeFi</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/token-standards">Token Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/dexs">Decentralized Exchanges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/wrapped-assets">Wrapped Assets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/cross-chain-swaps">Cross-chain Swaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/oracles">On-chain Oracles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/stablecoins">Stablecoins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/synthetics">Synthetics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/lending">Lending and Flash Loans</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Formal Verification</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/gadt-coq">Coq, GADT and Mi-Cho-Coq</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/modeling-theorem">Formal verification on smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Private Blockchain</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/report-issue">Report an issue</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/opentezos">Contribute to OpenTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/tezos-core">Contribute to the Tezos Core Protocol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/grant">Receive a grant</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/baker">Become a baker or a delegator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/exam">Exam</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Smart contracts</h1></header><div class="markdown"><p>In this chapter, you will learn the Tezos smart contracts basics. Their components and the workflow to record and use them on the Tezos <em>blockchain</em>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="general-definition-of-a-tezos-smart-contract"></a>General definition of a Tezos smart contract<a class="hash-link" href="#general-definition-of-a-tezos-smart-contract" title="Direct link to heading">#</a></h2><p>A smart contract is a code stored inside the <em>blockchain</em>. It executes a set of pre-defined instructions (promises). Once deployed (stored), it becomes <strong>immutable</strong>. A smart contract is deployed using a <strong>transaction</strong>, so we embed spending conditions inside it, which are <strong>immutable</strong>. Though for smart contracts, the key difference is a user <em>can trigger the execution of the code without modifying it. Therefore without moving it to another transaction or block</em>. It stays where it has been stored <strong>forever</strong>. Tezos doesn&#x27;t use an <a href="https://en.wikipedia.org/wiki/Unspent_transaction_output" target="_blank" rel="noopener noreferrer">UTXO model</a> (no &quot;<em>vaults</em>&quot;, see <em>Blockchain Basics</em>) but a <strong>stateful accounts</strong> one.</p><p>Like in Ethereum, Tezos uses 2 types of accounts:</p><ol><li>Classic accounts with a primary address, simply storing tez (Íú©) coins</li><li>Smart contract accounts with an address, storing code and tez (Íú©) coins</li></ol><p>Though in Tezos vocabulary though, &quot;<em>contracts</em>&quot; refers to both types in general. Actually each <em>contract</em> has a &quot;<strong><em>manager</em></strong>&quot;. Precisely, a classic account has an &quot;<strong><em>owner</em></strong>&quot;. If a contract has the &quot;<em>spendable</em>&quot; property, the manager is the entity allowed to spend funds from it.</p><p>Smart contracts can achieve different kinds of operations with coins and <em>other smart contracts</em>. They&#x27;re comparable to <em>automatic</em> <strong>sealed</strong> food and drink dispensers from the same company:<br>
Each machine has a contract saying &quot;<em>Give me cryptocurrency, then I give you food or drink</em>&quot;. Each machine can have a different smart contract for various foods or drinks, and there could be another smart contract gathering the cryptocurrency total for the company. Each machine doesn&#x27;t operate until enough currency is delivered (<em>Gas</em>). Note that the <strong>quantities</strong> of foods or drinks change while their <strong>types</strong> can&#x27;t (ever).</p><p>Of course, smart contracts like the Tezos ones go beyond this metaphor. Thanks to <em>transparency</em> and <em>immutability</em>, they allow an <strong>agreement</strong> to be secured between two or more parties. In this context, the concept of &quot;<a href="https://en.wikipedia.org/wiki/Lawrence_Lessig#%22Code_is_law%22" target="_blank" rel="noopener noreferrer">Code is Law</a>&quot; from <a href="https://en.wikipedia.org/wiki/Lawrence_Lessig" target="_blank" rel="noopener noreferrer"><em>Lawrence Lessig</em></a> is very appropriate.</p><p>For example, it is common to create financial instruments like various <em>tokens</em> (usually worth a fraction of the blockchain&#x27;s <em>coin</em>) with different usability and characteristics inside a multiple smart contracts system. Other more or less complex projects can propose <em>lending</em>, <em>stablecoins</em>, or <em>crowdfundings</em>.</p><p>In most cases, smart contracts remove <em>intermediate</em> and drastically reduce costs compared to classic paper contracts and their validations.</p><p>Notice that like any other, a Tezos smart contract can only run on and interact with the blockchain it&#x27;s stored in (Bitcoin&#x27;s smart contracts are exceptions here). It can&#x27;t interact with the outside world. That&#x27;s where <em>decentralized applications</em> or &quot;<em>Dapps</em>&quot; come in because they provide interfaces for the outside world.</p><p>To build your own Dapp, please refer to the <a href="/dapp"><em>Build a Dapp</em></a> module.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lifecycle-of-a-tezos-smart-contract"></a>Lifecycle of a Tezos smart contract<a class="hash-link" href="#lifecycle-of-a-tezos-smart-contract" title="Direct link to heading">#</a></h2><p>As we saw, a smart contract can only be deployed once but can be called many times. The Tezos smart contract lifecycle steps are two:</p><ol><li>Deployment</li><li>Interactions through calls</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deployment-of-a-tezos-smart-contract"></a>Deployment of a Tezos smart contract<a class="hash-link" href="#deployment-of-a-tezos-smart-contract" title="Direct link to heading">#</a></h3><p>The deployment of a Tezos smart contract is named &quot;<strong>origination</strong>&quot;.</p><p>When a smart contract is deployed, an <strong>address</strong> and a corresponding <em>persistent space</em> called &quot;<strong>storage</strong>&quot; are allocated to this smart contract. The smart contract address is like its <em>identity</em> and <em>where</em> it lives on the ledger. Its storage is its <em>usable space</em> inside itself. The smart contract is inside the blockchain. The storage is inside the smart contract.</p><p>A smart contract deployment also defines its <em>entrypoints</em>. These are special functions used to dispatch invocations of the smart contract. Each entrypoint is in charge of triggering an instruction (see below &quot;<em>Call of a Tezos smart contract</em>&quot;).</p><p>Once deployed, anyone or <em>anything</em> can call the smart contract (e.g. other contracts) with a transaction sent to its address and entrypoints. This call triggers the execution of the set of pre-defined instructions (promises).</p><p>The origination of a Tezos smart contract must define its:</p><ul><li><strong>Entrypoints</strong> (functions where it receives calls)</li><li><strong>Storage</strong></li><li><strong>Set of instructions</strong> in the low-level <em>Michelson</em> language</li></ul><p><img src="/assets/images/tezos_smart_contract_content-388d361b32664a5a39d8839a1de659f9.svg"></p><small class="figure">FIGURE 1: Content of a Tezos smart contract</small><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="code-of-a-tezos-smart-contract"></a>Code of a Tezos smart contract<a class="hash-link" href="#code-of-a-tezos-smart-contract" title="Direct link to heading">#</a></h3><p>The code of a smart contract is a sequence of Michelson instructions. Calls to the smart contract execute these instructions.</p><p>The execution of this sequence of instructions results in a modification of the <em>storage</em> content, or storage &quot;<strong>state</strong>&quot;. The sequence defines how to modify this state.</p><p>You can find the full description of the Michelson language in the <a href="/michelson">Michelson module</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="storage-of-a-tezos-smart-contract"></a>Storage of a Tezos smart contract<a class="hash-link" href="#storage-of-a-tezos-smart-contract" title="Direct link to heading">#</a></h3><p>During the origination, the process must specify the storage <strong>initial state</strong>.
If needed for operations, calling transactions&#x27; fees pay for the allocation of extra storage space.</p><p>For more details, check out the <a href="/tezos-basics/economics_and_reward">&quot;<em>Fees and Rewards</em>&quot;</a> chapter.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="call-of-a-tezos-smart-contract"></a>Call of a Tezos smart contract<a class="hash-link" href="#call-of-a-tezos-smart-contract" title="Direct link to heading">#</a></h3><p>A smart contract can be called by a classic account whose address starts with &quot;<strong>tz1</strong>&quot; or by a smart contract&#x27;s account whose address begins with &quot;<strong>KT1</strong>&quot;. The transaction specifies <em>arguments</em> and to which <em>entrypoint</em> they are sent.</p><p><img src="/assets/images/invoke_smart_contract-f461140ff3d61551f78612d61103154a.svg"></p><small class="figure">FIGURE 2: Call of a smart contract triggering its code and modifying its storage&#x27;s state</small><p>One can use the Command Line Interface (CLI) provided by Tezos to interact with a node and make calls. The &quot;<code>tezos-client</code>&quot; application allows anyone to deploy and call Tezos smart contracts.</p><p>The Remote Procedure Call (RPC) also provides ways to send requests to a Tezos node via HTTP (more details in <a href="/tezos-basics/introduction_to_cli_and_rpc">&quot;<em>RPC and CLI</em>&quot;</a> chapter).</p><p>The CLI command &quot;<code>tezos-client originate</code>&quot; is used to deploy a Tezos smart contract. Arguments are the following:</p><ul><li>Name of the smart contract</li><li>Michelson script containing: <ul><li>Entrypoints</li><li>Storage type</li><li>Set of instructions</li></ul></li><li>Initial storage value</li><li>Amount of tez sent to the smart contract</li><li>(optional) Address of a delegate</li></ul><p>The command returns the newly deployed contract&#x27;s address (more detail in the <a href="/tezos-basics/introduction_to_cli_and_rpc">&quot;<em>RPC and CLI</em>&quot;</a> chapter).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="high-level-languages-for-tezos-smart-contracts-implementations"></a>High-level languages for Tezos smart contracts implementations<a class="hash-link" href="#high-level-languages-for-tezos-smart-contracts-implementations" title="Direct link to heading">#</a></h2><p>Michelson is a low-level stack-based language. Therefore its adoption is quite limited because most developers won&#x27;t take time to learn it. Many Michelson <em>compilers</em> have been developed to avoid this friction and led to many high-level languages closer to developers habits: <a href="/smartpy"><em>SmartPy</em></a> (inspired by <em>Python</em>); <a href="/ligo"><em>LIGO</em></a> (inspired by <em>Camel</em> and <em>Pascal</em>); or <a href="https://serokell.io/project-morley" target="_blank" rel="noopener noreferrer"><em>Morley</em></a> (framework).</p><p><img src="/assets/images/tezos_smart_contract_deploy_invoke-151757f8a061aadda93b98a10d3006ae.svg"></p><small class="figure">FIGURE 3: Deployment and call of a Tezos smart contract with high-level languages.</small><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="smart-contracts-versioning"></a>Smart contracts versioning<a class="hash-link" href="#smart-contracts-versioning" title="Direct link to heading">#</a></h2><p>You need to remember the code of a smart contract is <strong>immutable</strong>. Only evolve the storage size and state. Hence, to handle smart contracts versioning, you should keep in mind <strong>implementations structures</strong> allowing transfer of information <strong>from old contracts to new contracts</strong>.</p><p>Hopefully, the above high-level languages make this kind of complex implementation easier. We will present to you three patterns to build evolutive smart contracts or <em>Dapps</em>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="map-pattern"></a>Map pattern<a class="hash-link" href="#map-pattern" title="Direct link to heading">#</a></h3><p>The idea of this pattern is to make a smart contract storage more dynamic. We put key data inside a table or &quot;data mapping&quot;. This mapping or &quot;map&quot; makes a classic &quot;Key / Value&quot; association between two data types. What&#x27;s interesting here, like in an <em>array</em>, is that it&#x27;s evolutive, even in the storage. Of course, the data types are fixed, but it is possible to add or remove pairs or change a <em>value</em> associated with the same <em>key</em>.</p><p>For example, it is common to define a <em>map</em> of users in a DAO, so the users&#x27; list can change following various organization&#x27;s rules. The same users aren&#x27;t carved in stone forever.</p><p>Note that even if a value or pair is deleted from a map, the blockchain ledger keeps the complete history of its state.<br>
In the DAO example, a user would be able to quit but you&#x27;d still find his trace exploring the past blocks.</p><p><img src="/assets/images/map-pattern-ac203fb6e0d74fea90c3e7e1af34e5e0.svg">  </p><small class="figure">FIGURE 4: <i>Map pattern</i> illustration.</small><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lambda-pattern"></a>Lambda pattern<a class="hash-link" href="#lambda-pattern" title="Direct link to heading">#</a></h3><p>The Lambda pattern is based on <em>lambda functions</em>. These anonymous functions only have a mandatory <em>type</em> (function!); non-mandatory <em>parameters</em>; and non-mandatory <em>return values</em>. The idea is to exchange the <strong>body</strong> of a classic function with a <strong>lambda function</strong>. While the classic function is immutable, the lambda function is stored in the storage, therefore mutable.</p><p>Instead of simply sealing the classic function&#x27;s body as an immutable structure, you make it a mutable <em>variable</em> of the storage.<br>
In an <strong>imaginary</strong> high-level language syntax:</p><ul><li><em>An entrypoint</em></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly d"><div tabindex="0" class="prism-code language-d codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Entrypoint_for_doSomething(p1, ... , pP) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    doSomething(p1, ... , pP);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><em>The corresponding immutable function</em></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly d"><div tabindex="0" class="prism-code language-d codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">function doSomething(p1, ... , pP) return (v1, ... , vR) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    storage.lambdaFunction();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><em>The lambda function in the storage as a variable</em></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly d"><div tabindex="0" class="prism-code language-d codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">lambdaFunction = function (p1, ... , pP) return (v1, ... , vR) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    actual_instructions;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Warnings</strong>:<br>
In this algorithmic example, almost all types are implicit, which limits syntax length. Furthermore, the syntax isn&#x27;t as functional as in languages used for Tezos smart contracts (e.g. <em>LIGO</em>).</p><p><img src="/assets/images/lambda-pattern-3ccf88aee6cf480fd8fce045a0c3162e.svg">  </p><small class="figure">FIGURE 5: <i>Lambda pattern</i> illustration.</small><p>You could use a <em>map pattern</em> aswell. Inside the map, you can store each lambda function as a <em>value</em>. To be executed, the code would find the correct lambda function at the corresponding <em>key</em>.</p><p>Later, in an upgrading process, it would be possible to <strong>modify the lambda function</strong> in <strong>just changing</strong> the <strong><em>value</em></strong> in the <em>map</em> for the <strong><em>same key</em></strong>. It would also be possible to <strong>batch changes on the whole <em>map</em></strong>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-proxy-pattern"></a>Data-Proxy pattern<a class="hash-link" href="#data-proxy-pattern" title="Direct link to heading">#</a></h3><p>The idea of the &quot;<em>Data-Proxy</em>&quot; pattern is pretty simple: separate the logic from the data into different smart contracts. Instead of duplicating and transfering the data into a new smart contract, we only update the logic smart contract.</p><p>The first smart contract is the Data smart contract. It stores important data, including the address and entrypoints of the Logic smart contract. It also plays a proxy role as any request always goes through it first. It usually doesn&#x27;t have a lot of functions. The mandatory functions set and retrieve its storage data (including new addresses for the new logic smart contracts).</p><p>When you need to update the logic (e.g. new features; corrections...) you only deploy a new logic smart contract and update the Data smart contract storage with the new address. See below fig. 6 for an update of the Logic smart contract from version 1.0 to 2.1.:</p><p><img src="/assets/images/data-proxy-f9f78c05148a91de1c7e1b8320e7dc25.svg">  </p><small class="figure">FIGURE 6: <i>Data-Proxy</i> pattern illustration.</small><p>Once the Data-Proxy architecture is in place, we can make the Data smart contract more dynamic with a Map pattern and the Logic smart contract upgradable with a Lambda pattern.</p><p>The idea we discribed is actually a basic form of <a href="https://en.wikipedia.org/wiki/Modular_programming" target="_blank" rel="noopener noreferrer">modular programming</a>.</p><p>This pattern isn&#x27;t limited to 2 smart contracts only. You can imagine various architectures combining various patterns. For instance, you can imagine a central Data smart contract and multiple upgradable other smart contracts revolving around it. This example implies a single point of failure in the Data smart contract, but there are other questions you should keep in mind, like access rights (to get and set data, to upgrade logic, etc.).</p><p>These patterns aren&#x27;t magical and just allow more flexibility. You still need to think about the best architecture for your <em>dapp</em>. Patterns can notably increase the deployment and <em>gaz</em> using fees.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-have-we-learned-so-far"></a>What have we learned so far?<a class="hash-link" href="#what-have-we-learned-so-far" title="Direct link to heading">#</a></h2><p>In this chapter, we described the Tezos smart contract&#x27;s main components and properties. We also described its lifecycle. We explained how to construct Tezos smart contracts using different patterns to make evolving <em>dapps</em> and handle efficient <em>versioning</em>.</p><p>In the next chapter, we will detail the Tezos consensus &quot;<em>Liquid Proof-of-Stake</em>&quot;.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/octo-technology/OpenTezos/tree/main/docs/tezos-basics/smart-contracts.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-05-07T19:10:26.000Z" class="lastUpdatedDate_1WI_">5/7/2021</time> by <strong>ThomasZoughebi</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/tezos-basics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/tezos-basics/liquid-proof-of-stake"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Liquid Proof-of-Stake ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#general-definition-of-a-tezos-smart-contract" class="table-of-contents__link">General definition of a Tezos smart contract</a></li><li><a href="#lifecycle-of-a-tezos-smart-contract" class="table-of-contents__link">Lifecycle of a Tezos smart contract</a><ul><li><a href="#deployment-of-a-tezos-smart-contract" class="table-of-contents__link">Deployment of a Tezos smart contract</a></li><li><a href="#code-of-a-tezos-smart-contract" class="table-of-contents__link">Code of a Tezos smart contract</a></li><li><a href="#storage-of-a-tezos-smart-contract" class="table-of-contents__link">Storage of a Tezos smart contract</a></li><li><a href="#call-of-a-tezos-smart-contract" class="table-of-contents__link">Call of a Tezos smart contract</a></li></ul></li><li><a href="#high-level-languages-for-tezos-smart-contracts-implementations" class="table-of-contents__link">High-level languages for Tezos smart contracts implementations</a></li><li><a href="#smart-contracts-versioning" class="table-of-contents__link">Smart contracts versioning</a><ul><li><a href="#map-pattern" class="table-of-contents__link">Map pattern</a></li><li><a href="#lambda-pattern" class="table-of-contents__link">Lambda pattern</a></li><li><a href="#data-proxy-pattern" class="table-of-contents__link">Data-Proxy pattern</a></li></ul></li><li><a href="#what-have-we-learned-so-far" class="table-of-contents__link">What have we learned so far?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 OpenTezos.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e4f1d814.js"></script>
<script src="/assets/js/main.cec49b6e.js"></script>
</body>
</html>