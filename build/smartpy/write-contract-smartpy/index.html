<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenTezos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenTezos Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Smart contract development with SmartPy | OpenTezos</title><meta data-react-helmet="true" property="og:url" content="https://opentezos.com/smartpy/write-contract-smartpy"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Smart contract development with SmartPy | OpenTezos"><meta data-react-helmet="true" name="description" content="In this chapter, we will use SmartPy to develop a smart contract based Raffle and cover the most important aspects of the framework. We will use this opportunity to introduce new notions as they appear. For a complete reference of SmartPy, please refer to the Reference Manual."><meta data-react-helmet="true" property="og:description" content="In this chapter, we will use SmartPy to develop a smart contract based Raffle and cover the most important aspects of the framework. We will use this opportunity to introduce new notions as they appear. For a complete reference of SmartPy, please refer to the Reference Manual."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://opentezos.com/smartpy/write-contract-smartpy"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/smartpy/write-contract-smartpy" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/smartpy/write-contract-smartpy" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.60c2ec83.css">
<link rel="preload" href="/assets/js/runtime~main.972b4ff9.js" as="script">
<link rel="preload" href="/assets/js/main.6ca66676.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT" style="margin-left:2px">üåô</span></div><div class="react-toggle-track-x"><span class="toggle_71bT" style="margin-left:1px">‚òÄÔ∏è</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Welcome</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/paths">Paths</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Blockchain Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/main-properties">Main properties of the first &quot;blockchain&quot;</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/proof-of-work">Proof-of-work</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/other-consensuses">Introduction to other consensus algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tezos Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/smart-contracts">Smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/liquid-proof-of-stake">Liquid Proof-of-Stake</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/operations">Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/cli-and-rpc">CLI and RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/governance-on-chain">Governance on-chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/history-of-amendments">History of amendments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/economics-and-rewards">Economics and rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy a node</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/set-up-a-node">Set-up a node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/networks">What about networks?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/to-go-further">To go further</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to use an Explorer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/indexer-explained">How Indexers Work?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/available-tezos-indexers">Available Tezos Explorers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-main-features">How to use the tzStats blockchain explorer?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-smart-contract">Checkout your smart contract on TzStats</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/private-indexer">Private indexer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/exam">Exam</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">SmartPy</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/smartpy">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/smartpy/installation">Installation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/smartpy/write-contract-smartpy">Smart contract development with SmartPy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/smartpy/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">LIGO</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/write-contracts-ligo">Smart contract development in PascaLIGO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/language-basics">Language basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/deploy-a-contract">Smart Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/unit-testing">Unit Testing with PyTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/take-away">Take Away</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Michelson</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/tutorial">Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/instructions-reference">Instructions Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/take-away">Take away</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Build a Dapp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/truffle_compilation_migration">Smart contract deployment with Truffle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/taquito">Taquito</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/temple">Temple Wallet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/basics">Build a dapp - basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/front_user_experience">Build a dapp - User Experience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Baking</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/baking_explained">How baking works?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/reward">Rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/bakers_list">List of bakers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy Bakers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/cli-baker">CLI to become a baker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/delegating">Delegating</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/voting">Voting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DeFi</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/token-standards">Token Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/dexs">Decentralized Exchanges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/wrapped-assets">Wrapped Assets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/cross-chain-swaps">Cross-chain Swaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/oracles">On-chain Oracles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/stablecoins">Stablecoins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/synthetics">Synthetics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/lending">Lending and Flash Loans</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Formal Verification</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/gadt-coq">Coq, GADT and Mi-Cho-Coq</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/modeling-theorem">Formal verification on smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Private Blockchain</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/report-issue">Report an issue</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/opentezos">Contribute to OpenTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/tezos-core">Contribute to the Tezos Core Protocol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/grant">Receive a grant</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/baker">Become a baker or a delegator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/exam">Exam</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Smart contract development with SmartPy</h1></header><div class="markdown"><p>In this chapter, we will use <em>SmartPy</em> to develop a smart contract based Raffle and cover the most important aspects of the framework. We will use this opportunity to introduce new notions as they appear. For a complete reference of <em>SmartPy</em>, please refer to the <a href="https://smartpy.io/reference.html" target="_blank" rel="noopener noreferrer">Reference Manual</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="about-the-raffle-contract"></a>About the raffle contract<a class="hash-link" href="#about-the-raffle-contract" title="Direct link to heading">#</a></h2><p>A raffle is a game of chance that distributes a winning prize.</p><p>The organizer is in charge of defining a jackpot and selling tickets that will either be winners or losers. In the case of our example, we will only have one winning ticket.</p><p>Fig.3 represents our smart contract.</p><p><img src="/assets/images/raffle_schema-3366ccd4b3a5b3414069eccdebb0a6fc.svg"></p><small class="figure">FIGURE 3: Raffle contract</small><p>Three entrypoints allow interaction with the contract:</p><ul><li><strong>open_raffle</strong> can only be called by the administrator. During this call, he sends the tez amount of the jackpot to the contract, defines a closing date, indicates the number/identity of the winning ticket (in an encrypted way), and declares the raffle open.</li><li><strong>buy_ticket</strong> allows anyone to buy a ticket for 1 tez and take part in the raffle.</li><li><strong>close_raffle</strong> can only be called by the administrator. It closes the raffle and sends the jackpot to the winner.</li></ul><blockquote><p>Note that this is a simplified conception of what a raffle is. Here the jackpot is fixed by the administrator, but it is possible to make a contract where the jackpot depends on the number of sold tickets.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="get-started"></a>Get started<a class="hash-link" href="#get-started" title="Direct link to heading">#</a></h3><p>This section illustrates the coding of the smart contract in the <a href="https://smartpy.io/ide" target="_blank" rel="noopener noreferrer">online editor</a> proposed by <em>SmartPy</em>. You can however also use your favourite IDE instead, as described previously.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="create-your-contract"></a>Create your contract<a class="hash-link" href="#create-your-contract" title="Direct link to heading">#</a></h4><p>To start, create a new contract in the online editor and name it <em>Raffle Contract</em>.</p><p><img src="/assets/images/online_editor_create_contract-93430991cb12bdaf51a7fe53344edc1c.png"></p><small class="figure">FIGURE 4: Online Editor Create Contract</small><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="template"></a>Template<a class="hash-link" href="#template" title="Direct link to heading">#</a></h4><p>Copy/paste the template below to get started:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)"># Raffle Contract - Example for illustrative purposes only.</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> smartpy </span><span class="token keyword" style="color:#e3116c">as</span><span class="token plain"> sp</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">Contract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">__init__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token keyword" style="color:#e3116c">pass</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token string">&quot;templates&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">not</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">in</span><span class="token plain"> __name__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">add_test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        r </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_compilation_target</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle_comp&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="a-few-concepts-first"></a>A few concepts first<a class="hash-link" href="#a-few-concepts-first" title="Direct link to heading">#</a></h4><p><strong>A <em>SmartPy</em> contract</strong> consists of a storage with one or several entry points. It is a class definition that inherits from the <code>sp.Contract</code>.</p><blockquote><p><strong>A class</strong> is a code template for creating objects. Objects have member variables and have a behaviour associated with them. In python a class is created by the keyword <code>class</code>.<br>
<strong>Inheritance</strong> allows us to define a class that can inherit all the methods and properties of another class.</p></blockquote><ul><li><p><strong>The <em>SmartPy</em> storage</strong> is defined into the constructor <code>__init__</code> which makes a call to <code>self.init()</code> that initializes the fields and sets up the storage.</p></li><li><p><strong>Entrypoints</strong> are a type of contract class that can be called on from the outside. Entrypoints need to be marked with the <code>@sp.entry_point</code> decorator.</p><blockquote><p><strong>Decorators</strong> are functions that modify the functionality of other functions. They are introduced by <code>@</code> and are placed before the function.</p></blockquote></li></ul><p><strong>Test Scenarios</strong> are good tools to make sure our smart contracts are working correctly.</p><ul><li>A new test is a method marked with the <code>sp.add_test</code> decorator.</li><li>A new scenario is instantiated by <code>sp.test_scenario</code>.</li><li>Scenarios describe a sequence of actions: originating contracts, computing expressions or calling entry points, etc.</li><li>In the online editor of SmartPy.io, the scenario is computed and then displayed as an HTML document on the output panel.</li></ul><blockquote><p>Note that there is a difference between <strong>Test Case</strong> which is a set of actions executed to verify particular features or functionality and <strong>Test Scenario</strong> which includes an end to end functionality to be tested.</p></blockquote><p>We will explain in more details the use of all these concepts in the next sections.</p><p>Our code doesn&#x27;t do much for now, but it can already be compiled by pressing the <em>run</em> button. If there is no error, you should be able to visualize the generated Michelson code in the <em>Deploy Michelson Contract</em> tab.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token function" style="color:rgb(111, 66, 193)">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">unit </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage   unit</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> open_raffle </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> # @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # list operation </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">list operation</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-open_raffle-entrypoint"></a>The <em>open_raffle</em> entrypoint<a class="hash-link" href="#the-open_raffle-entrypoint" title="Direct link to heading">#</a></h3><p><code>open_raffle</code> is the entrypoint that only the administrator can call. If the invocation is successful, then the raffle will open, and the smart contract&#x27;s storage will be updated with the chosen amount and the hash of the winning ticket number.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="link-to-referential-manual"></a>Link to referential manual<a class="hash-link" href="#link-to-referential-manual" title="Direct link to heading">#</a></h4><ul><li><a href="https://smartpy.io/reference.html#_contracts" target="_blank" rel="noopener noreferrer">Init</a></li><li><a href="https://smartpy.io/reference.html#_entry_points" target="_blank" rel="noopener noreferrer">Entrypoints</a></li><li><a href="https://smartpy.io/reference.html#_checking_a_condition" target="_blank" rel="noopener noreferrer">Checking a Condition</a></li><li><a href="https://smartpy.io/reference.html#_timestamps" target="_blank" rel="noopener noreferrer">Timestamps</a></li><li><a href="https://smartpy.io/reference.html#_tests_and_scenarios" target="_blank" rel="noopener noreferrer">Test and Scenario</a></li><li><a href="https://smartpy.io/reference.html#_typing" target="_blank" rel="noopener noreferrer">Typing</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="code"></a>Code<a class="hash-link" href="#code" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)"># Raffle Contract - Example for illustrative purposes only.</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> smartpy </span><span class="token keyword" style="color:#e3116c">as</span><span class="token plain"> sp</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">Contract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">__init__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  jackpot</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  raffle_is_open</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">bytes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;0x&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">~</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;A raffle is already open.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">amount </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;=</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The administrator does not own enough tz.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        today </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">now</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        in_7_day </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> today</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> in_7_day</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle must remain open for at least 7 days.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> close_date</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> jackpot_amount</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">hash_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> hash_winning_ticket</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">True</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token string">&quot;templates&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">not</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">in</span><span class="token plain"> __name__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    alice </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    admin </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Administrator&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">add_test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">name</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        r </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Test open_raffle entrypoint&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        jackpot_amount </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        number_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">345</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        bytes_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">pack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">number_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        hash_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sha256</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;The unauthorized user Alice unsuccessfully call open_raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call open_raffle with wrong close_date&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call open_raffle by sending not enough tez to the contract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin successfully call open_raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call open_raffle because a raffle is already open&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_compilation_target</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle_comp&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="storage-definition"></a>Storage definition<a class="hash-link" href="#storage-definition" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">__init__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              jackpot</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              raffle_is_open</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">bytes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;0x&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The definition of the storage is done in the constructor <code>__init__</code> and the different fields of the storage are stated as follows:<br>
<code>self.init( field1=value1, field2=value2, field3=value3)</code></p><p>where:</p><ul><li><code>field1</code>, <code>field2</code>, <code>field3</code> are the names of the variables and are accessible via <code>self.data</code> (e.g. <code>self.data.field1</code>)</li><li><code>value1</code>, <code>value2</code>, <code>value3</code> are initial values or variables passed as constructors like <code>__init__(self, value1)</code> as we did above for the <code>admin=address</code> field. (This can be useful if you want to initialize the storage with some specific values)</li></ul><div class="root_2W3B"><p></p><p>SmartPy types are all of the form <code>sp.T&lt;TypeName&gt;</code>. Check out <a href="https://smartpy.io/reference.html#_primitive_data_types_overview" target="_blank" rel="noopener noreferrer">Typing</a>.
For examples:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">sp.TUnit</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">sp.TBool</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">sp.TInt</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">sp.TNat</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">sp.TString</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Types are usually automatically inferred and not explicitly needed. However, it is still possible to add constraints on types, e.g. check out <a href="https://smartpy.io/reference.html#_setting_a_type_constraint_in_smartpy" target="_blank" rel="noopener noreferrer">Setting a type of constraint in SmartPy</a>.</p><p></p></div><p>For the storage of the raffle contract, we have defined five fields for the moment:</p><ul><li><strong>admin</strong> is the only authorized <code>address</code> to call the two entrypoints <em>open_raffle</em> and <em>close_raffle</em>.</li><li><strong>close_date</strong> is a <code>timestamp</code> to indicate the closing date of the raffle. The raffle must remain open for at least seven days.</li><li><strong>jackpot</strong> is the amount in <code>tez</code> that will be distributed to the winner.</li><li><strong>raffle_is_open</strong> is a <code>boolean</code> to indicate if the raffle is open or not.</li><li><strong>hash_winning_ticket</strong> is the hash of the winning ticket indicated by the admin.</li></ul><div class="root_2W3B"><p>It&#x27;s not possible to generate a truly random number from a smart contract, so an easy alternative is to use a hash. This example is for educational purposes and is not intended to be deployed on the real Tezos network.</p></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="entrypoint-implementation"></a>Entrypoint implementation<a class="hash-link" href="#entrypoint-implementation" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">~</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;A raffle is already open.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">amount </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;=</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The administrator does not own enough tz.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    today </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">now</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    in_7_day </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> today</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> in_7_day</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle must remain open for at least 7 days.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> close_date</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> jackpot_amount</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">hash_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> hash_winning_ticket</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">True</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>An entrypoint is a method of the contract class and is always preceded by the keyword <code>@sp.entry_point</code>. It can take on several parameters. In our case, the first entrypoint we use, is called <code>open_raffle</code> and does the following:</p><ul><li><p>With <code>sp.verify()</code> or <code>sp.verify_equal()</code> we check that a statement is true or if it return an error message (more info at <a href="https://smartpy.io/reference.html#_checking_a_condition" target="_blank" rel="noopener noreferrer">Checking a Condition</a>). Here we check four statements :</p><ol><li><p>The address that calls the entrypoint must be the administrator one indicated in the storage. We compare here <code>sp.source</code> and <code>self.data.admin</code>.</p><blockquote><p><code>sp.sender</code> is the address that calls the current entrypoint.<br>
<code>sp.source</code> is the address that initiates the current transaction. It may or may not be equal to <code>sp.sender</code>, but in our case, it is.</p></blockquote></li><li><p>No raffle must be open. For this, we use the boolean <code>raffle_is_open</code> defined in the storage.</p><blockquote><p>Note that <code>~</code> is the symbol used for logical negation.</p></blockquote></li><li><p>The amount <code>sp.amount</code> sent to the contract by the administrator during the transaction must be at least greater than the value specified in the <code>jackpot_amount</code> argument.</p></li><li><p>The closing date <code>close_date</code> passed as a parameter must be at least seven days in the future (more info on <a href="https://smartpy.io/reference.html#_timestamps" target="_blank" rel="noopener noreferrer">Timestamps</a>).</p></li></ol></li><li><p>Once all the conditions are passed we update the storage as follows:</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> close_date</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> jackpot_amount</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">hash_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> hash_winning_ticket</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">True</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test-scenario"></a>Test Scenario<a class="hash-link" href="#test-scenario" title="Direct link to heading">#</a></h4><p>The purpose of the test scenario is to ensure that the smart contract functions properly by triggering the conditions and checking the changes made to the storage.</p><p>On <em>SmartPy</em>, a test is a method of the contract class, preceded by <code>@sp.add_test</code>.</p><p>Inside this method, you need to instantiate your contract class and your scenarios, to which you will add the contract instance and all the calls related that you want to test. For instance:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">add_test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">name</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    r </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Note that you can also organize your scenarios by adding titles with <code>scenario.h1(&quot;My title&quot;)</code>, <code>scenario.h2(&quot;My subtitle&quot;)</code>, etc.</p><p>An interesting capacity is to define test accounts for our scenarios:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">alice </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">admin </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Administrator&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Test accounts can be defined through calling <code>sp.test_account(seed)</code>, where <em>seed</em> is a string.
A test account contains a few fields: <code>account.address</code>, <code>account.public_key_hash</code>, <code>account.public_key</code>, and <code>account.secret_key</code>.</p><p>You can then simulate the calls to the entrypoints by specifying the different arguments as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;The unauthorized user Alice unsuccessfully call open_raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                          hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">         valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The run method accepts optional parameters that can help to setup a relevant context for the entrypoint call. You can specify the <code>source</code> of the transaction, the <code>amount</code> of tez sent, the transaction date using <code>now</code> etc.</p><blockquote><p>Note that the option <code>valid=False</code> allows you to indicate that the transaction is expected to fail here because Alice is not the administrator.</p></blockquote><p>The result is displayed in an HTML document in the output panel of the online editor.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="run-and-watch-the-output"></a>Run and watch the output<a class="hash-link" href="#run-and-watch-the-output" title="Direct link to heading">#</a></h4><p>Let&#x27;s run our code:</p><p><img src="/assets/images/online_editor_summary_contract-a314f7400b3a35a2c0046d2854a792a6.png"></p><small class="figure">FIGURE 4: Online Editor Contract Summary</small><p>You can see a summary of our smart contract with the following information:</p><ul><li>Address of the contract</li><li>Balance in tez</li><li>Storage</li><li>Entry points</li></ul><p>By clicking on the <em>Types</em> tab, we have access to the types of the storage elements and the parameters of the entrypoints.</p><p><img src="/assets/images/online_editor_Types-d267721a3a512b12841cfea25d9f5070.png"></p><small class="figure">FIGURE 5: Online Editor Types</small><blockquote><p>As with Python, most of the time, it is not necessary to specify the type of an object in <em>SmartPy</em>.<br>
But because the target language of SmartPy, Michelson, requires types.<br>
Each <em>SmartPy</em> expression, however, needs a type. This is why <em>SmartPy</em> uses type inference to determine the type of each expression.<br>
See doc <a href="https://smartpy.io/reference.html#_typing" target="_blank" rel="noopener noreferrer">Typing</a>.</p></blockquote><p>By clicking on the <em>Deploy Michelson Contract</em> tab, we have access to the codes compiled in Michelson for the storage (<em>Storage</em> tab) and the smart contract (<em>Code</em> tab).</p><p>The michelson code of our smart contract is for now, the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token function" style="color:rgb(111, 66, 193)">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token function" style="color:rgb(111, 66, 193)">open_raffle</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">storage</span><span class="token plain">   </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">address </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">UNPAIR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">     # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> open_raffle </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">pack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">set_type_expr</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">source</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access maybe-class-name" style="color:rgb(111, 66, 193)">TAddress</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">pack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">set_type_expr</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access maybe-class-name" style="color:rgb(111, 66, 193)">TAddress</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&#x27;Administrator not recognized.&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUG</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">      # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">address </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # address </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PACK</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">SOURCE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">     # @source </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PACK</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">COMPARE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">    # int </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">EQ</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">         # bool </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">IF</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> string </span><span class="token string">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # string </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILWITH</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">   # </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILED</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">~</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&#x27;A raffle is already open.&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUG</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">      # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">GET</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">      # bool </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">IF</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> string </span><span class="token string">&quot;A raffle is already open.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # string </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILWITH</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">   # </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILED</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">amount</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;=</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&#x27;The administrator does not own enough tz.&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">GET</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">      # mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">AMOUNT</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">     # @amount </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">COMPARE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">    # int </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">GE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">         # bool </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">IF</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> string </span><span class="token string">&quot;The administrator does not own enough tz.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # string </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILWITH</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">   # </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILED</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">close_date</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">add_seconds</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">604800</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&#x27;The raffle must remain open for at least 7 days.&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">NOW</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # @now </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">604800</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # int </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @now </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUG</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">      # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">COMPARE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">    # int </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">GT</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">         # bool </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">IF</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> string </span><span class="token string">&quot;The raffle must remain open for at least 7 days.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # string </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILWITH</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">   # </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILED</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">close_date</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">close_date</span><span class="token plain"> # @storage </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">UNPAIR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">     # </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">address </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # address </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">      # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> address </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> address </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # address </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # pair address timestamp </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">jackpot</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">jackpot_amount</span><span class="token plain"> # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">        # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">DUG</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">      # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">GET</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">      # mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">UPDATE</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">   # </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> @parameter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">hash_winning_ticket</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">hash_winning_ticket</span><span class="token plain"> # @parameter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">GET</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">      # bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">UPDATE</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">   # </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    # self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">raffle_is_open</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token maybe-class-name">True</span><span class="token plain"> # </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> bool </span><span class="token maybe-class-name">True</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # bool </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">UPDATE</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">   # </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> # list operation </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       # </span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">list operation</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair address timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">mutez </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bool </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>By scrolling down a little, we have access to the results of the test scenario, with within each step a summary of the contract.</p><p><img src="/assets/images/online_editor_scenario_output-e7762a6bedb7728791e324fa3ffb0021.png"></p><small class="figure">FIGURE 4: Online Editor Scenario Output</small><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="buy_ticket-entrypoint"></a>buy_ticket entrypoint<a class="hash-link" href="#buy_ticket-entrypoint" title="Direct link to heading">#</a></h3><p><code>buy_ticket</code> is an entrypoint that can be called on by everyone who wants to participate in the raffle.
If the invocation is successful, the address of the sender will be added to the storage, and the player will be eligible to win the jackpot</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="link-to-referential-manual-1"></a>Link to referential manual<a class="hash-link" href="#link-to-referential-manual-1" title="Direct link to heading">#</a></h4><ul><li><a href="https://smartpy.io/reference.html#_sets" target="_blank" rel="noopener noreferrer">Sets</a></li><li><a href="https://smartpy.io/reference.html#_maps_and_big_maps" target="_blank" rel="noopener noreferrer">Maps</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="code-1"></a>Code<a class="hash-link" href="#code-1" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)"># Raffle Contract - Example for illustrative purposes only.</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> smartpy </span><span class="token keyword" style="color:#e3116c">as</span><span class="token plain"> sp</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">Contract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">__init__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  jackpot</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  raffle_is_open</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  players</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  sold_tickets</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">map</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">bytes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;0x&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">~</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;A raffle is already open.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">amount </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;=</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The administrator does not own enough tz.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        today </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">now</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        in_7_day </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> today</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> in_7_day</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle must remain open for at least 7 days.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> close_date</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> jackpot_amount</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">hash_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> hash_winning_ticket</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">True</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        ticket_price </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        current_player </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sender</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle is closed.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">amount </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> ticket_price</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The sender did not send the right tez amount (Ticket price = 1tz).&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">~</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">current_player</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Each player can participate only once.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">current_player</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        ticket_id </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token builtin" style="color:#e3116c">abs</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">len</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> current_player</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token string">&quot;templates&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">not</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">in</span><span class="token plain"> __name__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    alice </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    jack </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    admin </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Administrator&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">add_test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">name</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        r </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Test open_raffle entrypoint&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        jackpot_amount </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        number_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">345</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        bytes_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">pack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">number_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        hash_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sha256</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;The unauthorized user Alice unsuccessfully call open_raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call open_raffle with wrong close_date&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call open_raffle by sending not enough tez to the contract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin successfully call open_raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call open_raffle because a raffle is already open&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Test buy_ticket entrypoint (at this point a raffle is open)&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice unsuccessfully call buy_ticket by sending a wrong amount of tez&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice successfully call buy_ticket&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        alice_ticket_id </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">alice_ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice unsuccessfully call buy_ticket because she has already buy one&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Jack successfully call buy_ticket&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        jack_ticket_id </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">jack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">alice_ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">jack_ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_compilation_target</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle_comp&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="storage-definition-1"></a>Storage definition<a class="hash-link" href="#storage-definition-1" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">__init__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              jackpot</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              raffle_is_open</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              players</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              sold_tickets</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">map</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">bytes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;0x&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>With the addition of this entrypoint we have defined two new fields in the storage:</p><ul><li><strong>players</strong>, is a <code>set</code> that receives the addresses of each new player who bought a raffle ticket.</li><li><strong>sold_tickets</strong>, is a <code>map</code> that associates each player&#x27;s address with a ticket number.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="entrypoint-implementation-1"></a>Entrypoint implementation<a class="hash-link" href="#entrypoint-implementation-1" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    ticket_price </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    current_player </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sender</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle is closed.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">amount </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> ticket_price</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The sender did not send the right tez amount (Ticket price = 1tz).&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">~</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">current_player</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Each player can participate only once.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">current_player</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    ticket_id </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token builtin" style="color:#e3116c">abs</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">len</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> current_player</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Three assertions are tested for this entrypoint to work:</p><ol><li>The raffle must be open.</li><li>The amount of tez sent to the contract during the transaction must be equal to the ticket price (<code>1tez</code>).</li><li>Each player is allowed to buy only one ticket.</li></ol><p>If the conditions are met, then the storage is updated:</p><ul><li>The address of the player is added to the set <code>self.data.players</code>.</li><li>The ticket identification (id) is associated with the player&#x27;s address in the map <code>self.data.sold_tickets</code>.<blockquote><p>In <code>ticket_id = abs(sp.len(self.data.players) - 1)</code>, the ticket id is incremented for each new participant. The <code>abs()</code> function, which designates the absolute value, is used to ensure that the <code>ticket_id</code> is of type <code>sp.TNat</code>.</p></blockquote></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="close_raffle-entrypoint"></a><em>close_raffle</em> entrypoint<a class="hash-link" href="#close_raffle-entrypoint" title="Direct link to heading">#</a></h3><p>Only the administrator can call on the entrypoint <code>close_raffle</code>. If the invocation is successful, the raffle is closed, the jackpot amount is sent to the winner, and the storage is reset to a default value.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="link-to-referential-manual-2"></a>Link to referential manual<a class="hash-link" href="#link-to-referential-manual-2" title="Direct link to heading">#</a></h4><ul><li><a href="https://smartpy.io/reference.html#_bytes" target="_blank" rel="noopener noreferrer">Bytes</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="full-code"></a>Full code<a class="hash-link" href="#full-code" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)"># Raffle Contract - Example for illustrative purposes only.</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> smartpy </span><span class="token keyword" style="color:#e3116c">as</span><span class="token plain"> sp</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">Contract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">__init__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  jackpot</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  raffle_is_open</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  players</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  sold_tickets</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">map</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">bytes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;0x&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">~</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;A raffle is already open.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">amount </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;=</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The administrator does not own enough tz.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        today </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">now</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        in_7_day </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> today</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> in_7_day</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle must remain open for at least 7 days.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> close_date</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> jackpot_amount</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">hash_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> hash_winning_ticket</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">True</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        ticket_price </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        current_player </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sender</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle is closed.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">amount </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> ticket_price</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The sender did not send the right tez amount (Ticket price = 1tz).&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">~</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">current_player</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Each player can participate only once.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">current_player</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        ticket_id </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token builtin" style="color:#e3116c">abs</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">len</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> current_player</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">close_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle is closed.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">now </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle must remain open for at least 7 days.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        bytes_selected_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">pack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        hash_selected_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sha256</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes_selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">hash_selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                        message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The hash does not match the hash of the winning ticket&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        number_of_players </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">len</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        selected_ticket_id </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> selected_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain"> number_of_players</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        winner </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">selected_ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">winner</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;winner contract not found.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">map</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token string">&quot;templates&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">not</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">in</span><span class="token plain"> __name__</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    alice </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    jack </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    admin </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Administrator&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">add_test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">name</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        r </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">test_scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Test open_raffle entrypoint&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        jackpot_amount </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        number_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">345</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        bytes_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">pack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">number_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        hash_winning_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sha256</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;The unauthorized user Alice unsuccessfully call open_raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call open_raffle with wrong close_date&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call open_raffle by sending not enough tez to the contract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_days</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin successfully call open_raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">==</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call open_raffle because a raffle is already open&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">open_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">close_date</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jackpot_amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jackpot_amount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                                  hash_winning_ticket</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                 valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Test buy_ticket entrypoint (at this point a raffle is open)&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice unsuccessfully call buy_ticket by sending a wrong amount of tez&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice successfully call buy_ticket&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        alice_ticket_id </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">alice_ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice unsuccessfully call buy_ticket because she has already buy one&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Jack successfully call buy_ticket&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">jack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        jack_ticket_id </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">jack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">contains</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">alice_ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">jack_ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> jack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Test close_raffle entrypoint (at this point a raffle is open and two players participated)&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        selected_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">345</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;The unauthorized user Alice unsuccessfully call close_raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call close_raffle because it was before the close_date&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain">\</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp_from_utc_now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin unsuccessfully call close_raffle because the hash of the selected ticket does not match with the winning one&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        selected_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1234</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain">\</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Admin successfully call close_raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        selected_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">345</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> now</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">map</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">~</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">h3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Alice unsuccessfully call buy_ticket because the raffle is closed&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        scenario </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">buy_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sender</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> amount</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> valid</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">add_compilation_target</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle_comp&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="entrypoint-implementation-2"></a>Entrypoint implementation<a class="hash-link" href="#entrypoint-implementation-2" title="Direct link to heading">#</a></h3><p>The storage definition has not been modified by the addition of this entrypoint, so we can directly explain its implementation.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@sp</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">entry_point</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">close_raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">source</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle is closed.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">now </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The raffle must remain open for at least 7 days.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    bytes_selected_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">pack</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    hash_selected_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sha256</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bytes_selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">verify_equal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">hash_selected_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">hash_winning_ticket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                    message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;The hash does not match the hash of the winning ticket&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    number_of_players </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">len</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    selected_ticket_id </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> selected_ticket </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain"> number_of_players</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    winner </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">selected_ticket_id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">send</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">winner</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> message</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token string">&quot;winner contract not found.&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">tez</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">close_date </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">players </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">sold_tickets </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token builtin" style="color:#e3116c">map</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">raffle_is_open </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">False</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Four assertions are checked in this entrypoint:</p><ol><li>The caller must be the admin of the contract.</li><li>The raffle must be open.</li><li>The closing date must be greater than or equal to the closing date indicated in the storage.</li><li>The hash of the ticket used as a parameter, must be equal to the hash of the ticket indicated in the storage.<blockquote><p>The administrator provides as parameter a <code>sp.nat()</code> which must correspond to the number of the winning ticket, afterwards this natural integer is converted into <code>byte</code> and hashed using the <code>sha256</code> algorithm.</p></blockquote></li></ol><p>If the conditions are met, then:</p><ul><li>The jackpot is sent to the winner&#x27;s address.</li><li>The storage is reset to the default values.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="run-and-watch-the-output-1"></a>Run and watch the output<a class="hash-link" href="#run-and-watch-the-output-1" title="Direct link to heading">#</a></h3><p>We are getting to the end of our smart contract. Run it one last time and explore the result. Don&#x27;t hesitate to read the test scenario, to make sure your smart contract is working correctly. You can, of course, modify the scenarios or create new ones.</p><p>Check out the final Michelson code generated by SmartPy for this smart contract. Note that you can use this <em>Michelson</em> code to create additional tests with <em>PyTezos</em> as described in the <a href="/ligo/unit-testing">LIGO Module</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>SmartPy is meant for smart contract development and it always yields Michelson code.
The method for developing such smart contracts is pretty much always the same.</p><ol><li>the <strong>smart contract</strong> is a class definition that inherits from <code>sp.Contract</code>.</li><li>the <strong>storage</strong> is defined in the constructor of this class.</li><li>the <strong>entrypoints</strong> are defined as a method of the contract class and are marked with the <code>@sp.entry_point</code> decorator.</li></ol><p>There is no need for a <strong>main</strong> function like <a href="/ligo">LIGO</a> which dispatches the actions of the smart contract. The code can be compiled directly.</p><p>SmartPy was designed to help developers build smart contracts by providing them with a syntax familiar to them and a powerful analysis tool.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="to-go-further"></a>To go further<a class="hash-link" href="#to-go-further" title="Direct link to heading">#</a></h2><ul><li><p>You can explore contract examples and train yourself on <a href="https://smartpy.io/ide" target="_blank" rel="noopener noreferrer">the online editor</a>.</p></li><li><p>You can go to <a href="https://cryptocodeschool.in/tezos" target="_blank" rel="noopener noreferrer">Cryptocodeschool.in</a>
which is a fun platform that teaches how to code decentralized apps on the Tezos blockchain using SmartPy, and more.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="references"></a>References<a class="hash-link" href="#references" title="Direct link to heading">#</a></h2><p>[1] <a href="https://smartpy.io/reference.html" target="_blank" rel="noopener noreferrer">https://smartpy.io/reference.html</a></p><p>[2] <a href="https://smartpy.io/ide" target="_blank" rel="noopener noreferrer">https://smartpy.io/ide</a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/octo-technology/OpenTezos/tree/main/docs/smartpy/write-contract-smartpy.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-05-31T20:29:49.000Z" class="lastUpdatedDate_1WI_">5/31/2021</time> by <strong>Aymeric BETHENCOURT</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/smartpy/installation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Installation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/smartpy/exam"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Exam ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-the-raffle-contract" class="table-of-contents__link">About the raffle contract</a><ul><li><a href="#get-started" class="table-of-contents__link">Get started</a></li><li><a href="#the-open_raffle-entrypoint" class="table-of-contents__link">The <em>open_raffle</em> entrypoint</a></li><li><a href="#buy_ticket-entrypoint" class="table-of-contents__link">buy_ticket entrypoint</a></li><li><a href="#close_raffle-entrypoint" class="table-of-contents__link"><em>close_raffle</em> entrypoint</a></li><li><a href="#full-code" class="table-of-contents__link">Full code</a></li><li><a href="#entrypoint-implementation-2" class="table-of-contents__link">Entrypoint implementation</a></li><li><a href="#run-and-watch-the-output-1" class="table-of-contents__link">Run and watch the output</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li><li><a href="#to-go-further" class="table-of-contents__link">To go further</a></li><li><a href="#references" class="table-of-contents__link">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 OpenTezos.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.972b4ff9.js"></script>
<script src="/assets/js/main.6ca66676.js"></script>
</body>
</html>