<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenTezos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenTezos Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Smart contract deployment with Truffle | OpenTezos</title><meta data-react-helmet="true" property="og:url" content="https://opentezos.com/dapp/truffle_compilation_migration"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Smart contract deployment with Truffle | OpenTezos"><meta data-react-helmet="true" name="description" content="The first step to creating a Dapp is to deploy a smart contract onto a Tezos network, whether for testing or real-life use. There are several ways to do this, like using the Tezos cli."><meta data-react-helmet="true" property="og:description" content="The first step to creating a Dapp is to deploy a smart contract onto a Tezos network, whether for testing or real-life use. There are several ways to do this, like using the Tezos cli."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://opentezos.com/dapp/truffle_compilation_migration"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/dapp/truffle_compilation_migration" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/dapp/truffle_compilation_migration" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.60c2ec83.css">
<link rel="preload" href="/assets/js/runtime~main.972b4ff9.js" as="script">
<link rel="preload" href="/assets/js/main.6ca66676.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT" style="margin-left:2px">üåô</span></div><div class="react-toggle-track-x"><span class="toggle_71bT" style="margin-left:1px">‚òÄÔ∏è</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Welcome</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/paths">Paths</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Blockchain Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/main-properties">Main properties of the first &quot;blockchain&quot;</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/proof-of-work">Proof-of-work</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/other-consensuses">Introduction to other consensus algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tezos Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/smart-contracts">Smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/liquid-proof-of-stake">Liquid Proof-of-Stake</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/operations">Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/cli-and-rpc">CLI and RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/governance-on-chain">Governance on-chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/history-of-amendments">History of amendments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/economics-and-rewards">Economics and rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy a node</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/set-up-a-node">Set-up a node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/networks">What about networks?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/to-go-further">To go further</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to use an Explorer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/indexer-explained">How Indexers Work?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/available-tezos-indexers">Available Tezos Explorers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-main-features">How to use the tzStats blockchain explorer?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-smart-contract">Checkout your smart contract on TzStats</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/private-indexer">Private indexer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SmartPy</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/write-contract-smartpy">Smart contract development with SmartPy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">LIGO</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/write-contracts-ligo">Smart contract development in PascaLIGO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/language-basics">Language basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/deploy-a-contract">Smart Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/unit-testing">Unit Testing with PyTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/take-away">Take Away</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Michelson</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/tutorial">Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/instructions-reference">Instructions Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/take-away">Take away</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Build a Dapp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dapp">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/dapp/truffle_compilation_migration">Smart contract deployment with Truffle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dapp/taquito">Taquito</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dapp/temple">Temple Wallet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dapp/basics">Build a dapp - basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dapp/front_user_experience">Build a dapp - User Experience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dapp/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Baking</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/baking_explained">How baking works?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/reward">Rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/bakers_list">List of bakers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy Bakers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/cli-baker">CLI to become a baker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/delegating">Delegating</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/voting">Voting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DeFi</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/token-standards">Token Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/dexs">Decentralized Exchanges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/wrapped-assets">Wrapped Assets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/cross-chain-swaps">Cross-chain Swaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/oracles">On-chain Oracles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/stablecoins">Stablecoins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/synthetics">Synthetics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/lending">Lending and Flash Loans</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Formal Verification</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/gadt-coq">Coq, GADT and Mi-Cho-Coq</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/modeling-theorem">Formal verification on smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Private Blockchain</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/report-issue">Report an issue</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/opentezos">Contribute to OpenTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/tezos-core">Contribute to the Tezos Core Protocol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/grant">Receive a grant</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/baker">Become a baker or a delegator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/exam">Exam</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Smart contract deployment with Truffle</h1></header><div class="markdown"><p>The first step to creating a Dapp is to deploy a smart contract onto a Tezos network, whether for testing or real-life use. There are several ways to do this, like using the Tezos cli.  </p><p>However, during development, the smart contracts and the associated storage are likely to change: new field, field removal, structure change. For each change, a new deployment must be done. </p><p>Thus, the way that the contract is deployed will change accordingly, especially the initial storage. A minimal change in the storage definition can make the next deployment extremely tiresome when using Tezos cli.</p><p><em>Truffle</em> solves this difficulty. This tool uses scripts to perform smart contract deployments: thanks to a cli and a few configuration files, they are easier
and faster.</p><p>In this chapter, we will deploy the Raffle smart contract, written in LIGO, onto a testnet, with the use of <em>Truffle</em>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="about-the-truffle-suite"></a>About The <em>Truffle</em> Suite<a class="hash-link" href="#about-the-truffle-suite" title="Direct link to heading">#</a></h1><p><em>Truffle</em> is part of a suite of tools that make it easier to deploy written smart contracts onto a blockchain,
called <em>The Truffle Suite</em>.</p><ul><li><strong>Truffle</strong>: smart contract compilation and deployment onto a network</li><li><strong>Ganache</strong>: easy blockchain network setup and configuration</li><li><strong>drizzle</strong>: is used to easily write front-end applications, which interact with a deployed smart contract.</li><li><strong>Truffle teams</strong>: is an integration and smart contracts monitoring tool</li></ul><p>The <em>Truffle</em> Suite is not available for all blockchains. It supports:</p><ul><li>Ethereum</li><li>Tezos</li><li>Corda</li><li>Quorum</li><li>Hyperledger Fabric</li></ul><p>Only <em>Truffle</em> and <em>Ganache</em> (still in beta) are available for Tezos.</p><p><em>Truffle</em> takes Ligo files, compiles them and deploys them on any Tezos network with a single command. It
does not support Smartpy scripts nor Morlaix scripts.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="truffle-installation"></a><em>Truffle</em> Installation<a class="hash-link" href="#truffle-installation" title="Direct link to heading">#</a></h1><p><em>Truffle</em> can be installed with a docker or npm. The easiest way is to use <em>Truffle</em> from the npm package.</p><p>You&#x27;ll need to have NodeJS v8.9.4 or later on your machine.</p><p>Open a terminal and run:</p><p><code>$ npm install -g truffle@tezos</code></p><p><em>Truffle</em> will be installed globally (-g option).</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up-a-truffle-project"></a>Setting-up a <em>Truffle</em> project<a class="hash-link" href="#setting-up-a-truffle-project" title="Direct link to heading">#</a></h1><p>As described below, <em>Truffle</em> is working with configuration files and scripts, which must be located in specific repositories.
You can set up your <em>Truffle</em> project from scratch, but it is easier to use one of the two ways provided by <em>Truffle</em>:</p><ol><li>Initializing an empty project</li><li>Using a <em>Truffle</em> Box</li></ol><p>These two methods generate the project structure and the configuration files (with predefined settings like accounts, networks...): the <em>Truffle</em> box comes with three smart contract examples.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initializing-an-empty-project"></a>Initializing an empty project<a class="hash-link" href="#initializing-an-empty-project" title="Direct link to heading">#</a></h2><p>Create a folder for your <em>Truffle</em> project, and run:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ </span><span class="token function" style="color:rgb(111, 66, 193)">mkdir</span><span class="token plain"> tezos-example</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(227, 98, 9)">cd</span><span class="token plain"> tezos-example</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ truffle init</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-a-truffle-box"></a>Using a <em>Truffle</em> Box<a class="hash-link" href="#using-a-truffle-box" title="Direct link to heading">#</a></h2><p>A <em>Truffle</em> box is a project already set up, easily and quickly adjustable to the specific needs of a project.
They can be launched instantly and modified with little work. <em>Truffle</em> provides users with a global boxes repository:
[https://www.trufflesuite.com/boxes]</p><p>A Tezos box is available here:
[https://www.trufflesuite.com/boxes/tezos-example]</p><p>The <code>tezos-example</code> box is useful for the deployment of a decentralized application (dapp).</p><p>You can download this box with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ </span><span class="token function" style="color:rgb(111, 66, 193)">mkdir</span><span class="token plain"> tezos-example</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(227, 98, 9)">cd</span><span class="token plain"> tezos-example</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ truffle unbox tezos-example</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <em>Truffle</em> unbox command will not create a new tezos-example folder, but will unpack all the content in the current folder.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-truffle"></a>Using <em>Truffle</em><a class="hash-link" href="#using-truffle" title="Direct link to heading">#</a></h1><p>Using <em>Truffle</em> can be divided into two steps:</p><ol><li>Configuration: modifying scripts to define the way smart contracts are deployed.</li><li>Compilation and deployment, with the <em>Truffle Cli</em></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="project-structure-overview"></a>Project Structure overview<a class="hash-link" href="#project-structure-overview" title="Direct link to heading">#</a></h2><p>A <em>Truffle</em> follows this structure:</p><ul><li><strong>build</strong> (not present at the unpacking of the box): the folder containing the Michelson code, compiled by <em>Truffle</em>
and used for the contract deployments</li><li><strong>contract</strong>: the folder containing all the Ligo smart contracts that <em>Truffle</em> has to compile.</li><li><strong>migrations</strong>: the folder containing the <em>Truffle</em> migration scripts for the deployment of the contracts</li><li><strong>node_modules</strong>: the node modules used by the <em>Truffle</em> project</li><li><strong>package.json</strong>: contains a script command, which launches a sandbox with ganache</li><li><strong>scripts</strong>:<ul><li>sandbox: contains two accounts to use on a sandbox environment.</li></ul></li><li><strong>test</strong>: the folder containing Javascript tests</li><li><strong>truffle-config.js</strong>: configuration file which defines networks and accounts used for the deployment</li></ul><p>The build folder will be created or compiled after any compilation command.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="main-truffle-commands"></a>Main <em>Truffle</em> commands<a class="hash-link" href="#main-truffle-commands" title="Direct link to heading">#</a></h2><p>The <em>Truffle</em> Cli provides various commands, that can be displayed with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ truffle --help</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The main commands are:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">compile   Compile contract source files</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">init      Initialize new and empty project</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">migrate   Run migrations to deploy contracts</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">networks  Show addresses for deployed contracts on each network</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">test      Run JavaScript and Solidity tests</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="compiling-smart-contracts-with-truffle"></a>Compiling smart contracts with <em>Truffle</em><a class="hash-link" href="#compiling-smart-contracts-with-truffle" title="Direct link to heading">#</a></h2><p>In this part, the <code>tezos-example</code> box is used as an example.</p><p><em>Truffle</em> is mainly used for smart contract compilation and deployment. It can also launch tests, but other tools such as <em>pytezos</em> can be used for that.</p><p>Compiling smart contracts can be done with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ truffle compile</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Input: valid smart contracts (i.e compiling smart contracts), located in <code>contract</code> directory </p><p>Output: <em>Truffle</em> artifacts, stored into the build/contracts directory.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="about-ligo-smart-contracts"></a>About ligo smart contracts<a class="hash-link" href="#about-ligo-smart-contracts" title="Direct link to heading">#</a></h3><p><em>Truffle</em> can compile LIGO smart contracts (PascaLigo, Cameligo, ReasonLigo). But they MUST be stored in the <em>contract</em> folder.
<em>Truffle</em> considers each ligo file as an independent smart contract. Thus, if a smart contract is split into several ligo files, <em>Truffle</em> will try to compile each file as a separate smart contract, resulting in a failed compilation. But there is a workaround for this behaviour:</p><ol><li>Create a new folder in the project root directory, called <code>src</code> for instance.</li><li>Move all your smart contracts files into <code>src/</code></li><li>Create a ligo file, importing the main file from <code>src/</code></li></ol><p><em>Truffle</em> will successfully compile your smart contract.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="truffle-artifacts"></a><em>Truffle</em> artifacts<a class="hash-link" href="#truffle-artifacts" title="Direct link to heading">#</a></h3><p>For each ligo file found in the contract, <em>Truffle</em> will yield an artifact in build/contracts.</p><p>An artifact is a json file, containing the compiled smart contract, the ligo source code, the deployment information...
This example is the artifact yielded for the <code>Counter.ligo</code> file:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json5"><div tabindex="0" class="prism-code language-json5 codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">{</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  &quot;contractName&quot;: &quot;Counter&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  &quot;abi&quot;: [],</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  &quot;michelson&quot;: &quot;&lt;Michelson code as json&gt;&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  &quot;source&quot;: &quot;&lt;Content of the ligo file from contract&gt;&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  &quot;sourcePath&quot;: &quot;path/to/truffle-example/contracts/Counter.ligo&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  &quot;compiler&quot;: {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &quot;name&quot;: &quot;ligo&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &quot;version&quot;: &quot;next&quot;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  },</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  &quot;networks&quot;: {},</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  &quot;schemaVersion&quot;: &quot;3.2.0-tezos.1&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  &quot;updatedAt&quot;: &quot;2021-03-19T14:27:16.197Z&quot;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>These artifacts are then used in the deployment scripts.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hand-ons"></a>Hand-ons:<a class="hash-link" href="#hand-ons" title="Direct link to heading">#</a></h3><p>Let&#x27;s create a truffle project for the Raffle Smart contract, and compile the ligo code into a Michelson code, with <em>Truffle</em>.
First, we will download the <code>tezos-example</code> box and then remove the example contracts.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ </span><span class="token function" style="color:rgb(111, 66, 193)">mkdir</span><span class="token plain"> truffle-raffle</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(227, 98, 9)">cd</span><span class="token plain"> truffle-raffle</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ truffle unbox tezos-example</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ </span><span class="token function" style="color:rgb(111, 66, 193)">rm</span><span class="token plain"> -rf contracts/* migrations/*</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Let&#x27;s put the <a href="/ligo/write-contracts-ligo#refactoring-the-closeraffle-entrypoint">Raffle smart contract</a> into our Truffle project:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ </span><span class="token function" style="color:rgb(111, 66, 193)">touch</span><span class="token plain"> contracts/Raffle.ligo</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Let&#x27;s copy and paste the ligo code into this file.</p><p>Everything is ready for the compilation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ truffle compile</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>A new json file has been created in the <code>build/contracts/</code> directory.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deploying-smart-contracts-with-truffle"></a>Deploying smart contracts with <em>Truffle</em><a class="hash-link" href="#deploying-smart-contracts-with-truffle" title="Direct link to heading">#</a></h2><p>At this point, the smart contract is compiled and ready to be deployed. However, <em>Truffle</em> needs to be configured: deployment on a given network,
with a given account, a given initial storage ect...</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-an-account-for-the-deployment"></a>Using an account for the deployment<a class="hash-link" href="#using-an-account-for-the-deployment" title="Direct link to heading">#</a></h3><p>Originating a contract costs some tz. Thus, an account holding funds is necessary. Accounts with funds on testnets (
delphinet, edonet...) can freely be retrieved as a json file here:
[https://faucet.tzalpha.net/]</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="adding-a-network"></a>Adding a network<a class="hash-link" href="#adding-a-network" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-accounts"></a>Defining accounts<a class="hash-link" href="#defining-accounts" title="Direct link to heading">#</a></h4><p>The network configuration is handled in the <code>truffle-config.js</code> file. It can execute any javascript code needed for the configuration. Some networks are already defined (mainnet, localhost). However, as the tezos protocol is likely to evolve, new networks will probably have to be added. Each network is associated with an account.</p><p>There are two ways of importing an account:</p><ul><li>Importing an account into the <code>truffle-config.js</code> file:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">mnemonic</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> secret</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> password</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> email</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;/path/to/faucet.json&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><em>Truffle</em> will activate this account before the contract origination.</p><ul><li>Setting <strong>already activated</strong> accounts in the scripts folder:
Accounts can be defined according to the network. By default, a <em>sandbox</em> folder is present, with two defined acocunts (
these two accounts are found in any sandbox). New accounts can be defined by creating a new folder, named after the
network name (convention), with an <code>accounts.js</code> file:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    account_name</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        pkh</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;&lt;pkh&gt;&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        sk</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;&lt;sk&gt;&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        pk</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;&lt;pk&gt;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token spread operator" style="color:rgb(0, 92, 197)">...</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Of course, the faucet can be imported into the <code>accounts.js</code> file.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-networks"></a>Defining networks<a class="hash-link" href="#defining-networks" title="Direct link to heading">#</a></h4><p>The networks are defined in the <code>truffle-config.js</code> file. It exports an object that defines networks.
Each key in <em>networks</em> sets a network, which requires:</p><ul><li>a host: An RPC node ([https://tezostaquito.io/docs/rpc_nodes/]) or a local node (as shown in the development network)</li><li>a port: running node port</li><li>network_id: <code>*</code> by default to match any network</li><li>type: network type</li><li>A way to create transaction:<ul><li>secretKey</li><li>secret, mnemonic, password, email</li></ul></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// see &lt;http://truffleframework.com/docs/advanced/configuration&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// for more details on how to specify configuration options!</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  networks</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      development</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          host</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;http://localhost&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          port</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">8732</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          network_id</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;*&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          secretKey</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">sk</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          type</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;tezos&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hand-ons-1"></a>Hand-ons<a class="hash-link" href="#hand-ons-1" title="Direct link to heading">#</a></h4><p>We will deploy our raffle smart contract onto edonet. We&#x27;ll need to add this network into the <code>truffle-config.js</code> file.
First, we need a faucet account.
Let&#x27;s download a faucet from <a href="https://faucet.tzalpha.net/" target="_blank" rel="noopener noreferrer">https://faucet.tzalpha.net/</a> into our root project folder.</p><p>Let&#x27;s define an &quot;edonet&quot; network, that will use  this faucet:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;./scripts/sandbox/accounts&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">mnemonic</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> secret</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> password</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> email</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;./faucet.json&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    networks</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        development</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            host</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;http://localhost&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            port</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">8732</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            network_id</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;*&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            secretKey</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">sk</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            type</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;tezos&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        edonet</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            host</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;https://edonet-tezos.giganode.io&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            port</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">443</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            network_id</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;*&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            secret</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            mnemonic</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            password</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            email</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            type</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;tezos&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token spread operator" style="color:rgb(0, 92, 197)">...</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="writing-the-migration-scripts"></a>Writing the migration scripts<a class="hash-link" href="#writing-the-migration-scripts" title="Direct link to heading">#</a></h3><p>The smart contracts are ready, the network where it has to be deployed too, the next step is to write the deployment script (also called a migration). These scripts are located in the <em>migrations</em> directory. </p><p>Each migration is a javascript file, defining the deployment tasks. It can execute any javascript code. Each migration starts with a number, followed by a title: <em>Truffle</em> will run the migrations in an ascending order.
For instance, the <code>tezos-example</code> box comes with tree migrations:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">1_initial_migration.js</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">2_deploy_simple_storage.js</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">3_deploy_counter.js</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>A migration defines:</p><ul><li>the initial storage</li><li>the contract deployment steps: order, networks, accounts</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="importing-the-smart-contract-to-deploy"></a>Importing the smart contract to deploy<a class="hash-link" href="#importing-the-smart-contract-to-deploy" title="Direct link to heading">#</a></h4><p>The first step is to specify which smart contract is to be deployed:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> myContract </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;MyContract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><em>Truffle</em> will look for a <em>MyContract.ligo</em> file in the <em>contract</em> directory. Thus, to import a contract, the filename of the contract (without the extension) is used (<code>artifacts</code> is a <em>Truffle</em> keyword). It is here possible to import several smart contracts:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> firstContract </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;FirstContract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> secondContract </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;SecondContract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-the-initial-storage"></a>Defining the initial storage<a class="hash-link" href="#defining-the-initial-storage" title="Direct link to heading">#</a></h4><p>A smart contract defines a storage. When originated, the initial storage must be set and the storage must
be compliant with the structure defined in the smart contract to be deployed: the names and types must be respected. The
initial storage is declared with a Javascript syntax. Two modules can come in handy:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token maybe-class-name">MichelsonMap</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;@taquito/taquito&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// for Michelson maps</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> web3 </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;web3&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// for bytes</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Below is the matching table between Javascript and Ligo.</p><table><thead><tr><th>Ligo</th><th>Javascript</th></tr></thead><tbody><tr><td>List, Tuple</td><td>[ ]</td></tr><tr><td>Big_map, Map</td><td>const bigMap = new MichelsonMap() <br> bigMap.set(key, values) <br> <em>(from taquito module)</em></td></tr><tr><td>string, address</td><td>string</td></tr><tr><td>bytes</td><td><code>web3.utils.asciiToHex(string_to_convert).slice(2)</code></td></tr><tr><td>int, nat, mutez</td><td>number</td></tr><tr><td>record</td><td>Object { }</td></tr><tr><td>timestamp</td><td>Date.now()</td></tr></tbody></table><p>Here is a migration example, defining a storage with essential types:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)">// modules import</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token maybe-class-name">MichelsonMap</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;@taquito/taquito&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// used for big maps</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> web3 </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;web3&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// used for bytes</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// contract to deploy</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> </span><span class="token maybe-class-name">MyContract</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;MyContract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// initial storage definition</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> admin </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;tz1ibMpWS6n6MJn73nQHtK5f4ogyYC1z9T9z&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">//address</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> emptyBigMap </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">MichelsonMap</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// empty big map</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> bigMapWithAnElement </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">MichelsonMap</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// empty big map</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">bigMapWithAnElement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        param1</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        param2</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;second param&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// previous big map with a object (record in ligo) as value, and an int as key</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> emptySet </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// empty set</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> myBytes </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> web3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">utils</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">asciiToHex</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;string to convert into bytes&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">slice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// bytes</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> counter </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// int</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> initialStorage </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;contractAdmin&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;contractFirstBigMap&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> emptyBigMap</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;contractSecondBigMap&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> bigMapWithAnElement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;contractSet&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> emptySet</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;contractCounter&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> metadata</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Any type and structure change in the Ligo smart contract storage must be mirrored here, in the <code>initialStorage</code> variable.
This way, the evolution of the storage used can be versioned.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deployment"></a>Deployment<a class="hash-link" href="#deployment" title="Direct link to heading">#</a></h4><p>The last step of the migration is the deployment definition. It&#x27;s a function export, which defines how the contract(s)
should be deployed. This function takes three arguments:</p><ul><li><code>deployer</code>: truffle object which deploys a contract</li><li><code>network</code>: the network used</li><li><code>account</code>: the account used</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deployer"></a>Deployer<a class="hash-link" href="#deployer" title="Direct link to heading">#</a></h5><p>The <code>deployer</code> object deploys the code on the specified <em>network</em>. The deployer takes the <code>initialStorage</code> object (
and a few options) as input.</p><p>A minimal viable migration could be:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> </span><span class="token maybe-class-name">MyContract</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;MyContract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> initialStorage </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(111, 66, 193)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">deployer</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> network</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// deployment steps</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    deployer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">deploy</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token maybe-class-name">MyContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> initialStorage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The execution returns some pieces of information (such as the contract address, the cost ...)</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="network"></a>Network<a class="hash-link" href="#network" title="Direct link to heading">#</a></h5><p>It can be useful to deploy a smart contract differently according to the network.
For instance, if the storage holds an administator address, it&#x27;s likely to be different on the mainnet and on testnet
The migration can be branched according to the network, like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> </span><span class="token maybe-class-name">MyContract</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;MyContract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> edonetInitialStorage </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> mainnetInitialStorage </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(111, 66, 193)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">deployer</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> network</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">network </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token string">&quot;edonet&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        deployer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">deploy</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token maybe-class-name">MyContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> edonetInitialStorage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        deployer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">deploy</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token maybe-class-name">MyContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> mainnetInitialStorage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The deployment changes according to the network used. Here, the storage is not the same.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="account"></a>Account<a class="hash-link" href="#account" title="Direct link to heading">#</a></h5><p>The account used for the migration can be handled during the migration.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> </span><span class="token maybe-class-name">MyContract</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;MyContract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> initialStorage </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">admin</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;tz1ibMpWS6n6MJn73nQHtK5f4ogyYC1z9T9z&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(111, 66, 193)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">deployer</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> network</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    deployer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">deploy</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token maybe-class-name">MyContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token spread operator" style="color:rgb(0, 92, 197)">...</span><span class="token plain">initialStorage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> admin</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This example sets the migration account as the contract administrator.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="migrating-several-contracts"></a>Migrating several contracts<a class="hash-link" href="#migrating-several-contracts" title="Direct link to heading">#</a></h5><p>A migration can deploy several contracts at the same time. This is useful when the migration data have to be used for the deployment of another contract.
Below, is an example with two contracts. The second contract needs to call on the first and with its address.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> firstContract </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;firstContract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> secondContract </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;secondContract&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> initialStorage </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">admin</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;tz1ibMpWS6n6MJn73nQHtK5f4ogyYC1z9T9z&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> contractToCall</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(111, 66, 193)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">deployer</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> network</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    deployer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">deploy</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">firstContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">then</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> deployer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">deploy</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">secondContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                </span><span class="token spread operator" style="color:rgb(0, 92, 197)">...</span><span class="token plain">initialStorage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                contractToCall</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> firstContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">address</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hand-ons-2"></a>Hand-ons<a class="hash-link" href="#hand-ons-2" title="Direct link to heading">#</a></h3><p>Let&#x27;s create the migration file for our raffle contract: <code>1_deploy_raffle.js</code></p><p>First, we need to import the contract (Step 1)</p><p>Second, we need to define the initial storage, which should have the following fields:</p><ul><li>admin: <code>address</code></li><li>close_date: <code>timestamp</code></li><li>jackpot: <code>mutez</code></li><li>description: <code>string</code></li><li>players: <code>address list</code></li><li>sold_tickets: <code>nat address big_map</code></li><li>raffle_is_open: <code>boolean</code></li><li>winning_ticket_number_hash: <code>bytes</code></li></ul><p><code>taquito</code> and <code>web3</code> will be used for the <code>bytes</code> and <code>big_map</code> types.
The initial storage that is defined contains an open raffle. (Step 2)</p><p>Finally, the deployment must be defined: the admin of the contract is the address used for the deployment (step 3).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token maybe-class-name">Raffle</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Raffle&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// step 1</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// step 2</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token maybe-class-name">MichelsonMap</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;@taquito/taquito&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> web3 </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">require</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;web3&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> admin </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> closeDate </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Date</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">now</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> jackpot </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">100</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> description </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> players </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> soldTickets </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">MichelsonMap</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> raffleIsOpen </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> winningTicketHash </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> web3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">utils</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">asciiToHex</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;ec85151eb06e201cebfbb06d43daa1093cb4731285466eeb8ba1e79e7ee3fae3&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">slice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> initialStorage </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;admin&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> admin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;close_date&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> closeDate</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">toString</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;jackpot&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> jackpot</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;description&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> description</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;players&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> players</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;sold_tickets&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> soldTickets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;raffle_is_open&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> raffleIsOpen</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token string">&quot;winning_ticket_number_hash&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> winningTicketHash</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// step 3</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(111, 66, 193)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">deployer</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> network</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    deployer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">deploy</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token maybe-class-name">Raffle</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token spread operator" style="color:rgb(0, 92, 197)">...</span><span class="token plain">initialStorage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> admin</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="running-a-migration"></a>Running a migration<a class="hash-link" href="#running-a-migration" title="Direct link to heading">#</a></h3><p>Everything is now ready for deployment: the network and the migration account are set, the initial storage and the deployment step are defined.
From the project directory, you can run:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ truffle migrate --network &lt;network_name&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This command is broken down into two steps:</p><ol><li>Verifying that the smart contracts are compiled. If they are not, it will launch a compilation</li><li>Deploying the smart contracts, following the migration scripts under the <em>migration</em> folder. Before the deployment, <em>Truffle</em> checks if the initial storage is compliant with its Michelson definition. If not, it will raise an exception.</li></ol><p>Each migration generally takes up to 30 seconds. In the end, several pieces of information are displayed.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">1_deploy_raffle.js</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">==================</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   Replacing &#x27;Raffle&#x27;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   ------------------</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; operation hash:      onoMN7C2YNwJPeXtkXFwTrcitD9udgEQNdBGTaZD2CHVjpNsTBQ</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; Blocks: 0            Seconds: 4</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; contract address:    KT1N3WFAwMUvqnKMJkNrLCnWBRkLTFvRw7Vk</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; block number:        206080</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; block timestamp:     2021-04-26T14:38:53Z</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; account:             tz1cGftgD3FuBmBhcwY24RaMm5D2UXLr5LHW</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; balance:             28390.642777</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; gas used:            11056</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; storage used:        2101 bytes</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; fee spent:           3.477 mtz</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; burn cost:           0.5895 tez</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; value sent:          0 XTZ</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; total cost:          0.592977 XTZ</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; Saving artifacts</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   -------------------------------------</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   &gt; Total cost:            0.592977 XTZ</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Summary</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">=======</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&gt; Total deployments:   1</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&gt; Final cost:          0.592977 XTZ</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The most useful piece of information are the contract address (to interact with it) and the transaction hash (which refers to the origination on the blockchain). </p><p>Some of these pieces of information can be found in the json file under the <code>build/contracts</code> folder:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">{</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;contractName&quot;: &quot;Raffle&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;abi&quot;: [],</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;michelson&quot;: &quot;&lt;michelson_code&gt;&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;source&quot;: &quot;&lt;ligo_code&gt;&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;sourcePath&quot;: &quot;/path/to/contracts/Raffle.ligo&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;compiler&quot;: {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;name&quot;: &quot;ligo&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;version&quot;: &quot;next&quot;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">},</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;networks&quot;: {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;NetXSgo1ZT2DRUG&quot;: {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;events&quot;: {},</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;links&quot;: {},</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;address&quot;: &quot;KT18uWmKP5gTVh7FKHwRRwjE6XVAsm7WLHSF&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;transactionHash&quot;: &quot;ooWVHFdjJbvGYDp9CUhUzonRfobvnHExzqsZBQmbEHpmcuveh6Q&quot;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">},</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;schemaVersion&quot;: &quot;3.2.0-tezos.1&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;updatedAt&quot;: &quot;2021-04-02T08:29:37.743Z&quot;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&quot;networkType&quot;: &quot;tezos&quot;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="interacting-with-a-deployed-contract"></a>Interacting with a deployed contract<a class="hash-link" href="#interacting-with-a-deployed-contract" title="Direct link to heading">#</a></h2><p>Once the migration is done, it can be convenient to quickly verify that the contract is deployed.
There are many tools for this: cli, libraries, GUI... In this section, we&#x27;ll keep it simple with a GUI. </p><p><a href="https://tzstats.com/" target="_blank" rel="noopener noreferrer">tzstats.com</a> provides information about any public Tezos network: transactions, accounts, contracts (origination, storage, entrypoints)...</p><p>Once a contract is deployed, it can be checked here (on edonet): <a href="https://edo.tzstats.com/" target="_blank" rel="noopener noreferrer">https://edo.tzstats.com/</a>&lt;contract_address&gt;.
You should see a &quot;New Smart contract created by ...&quot; line in the <em>Calls</em> section. The contract storage can also be inspected.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h1><p>The first step in developing a Dapp is to deploy the smart contracts. <em>Truffle</em> takes ligo code, compiles it into Michelson code and deploys it onto any public or private network. </p><p>Each migration needs an initial storage, that should be compliant with the storage section of the Michelson code. </p><p>Thanks to its configuration and easily readable and versioned migration files, <em>Truflle</em> is an essential tool throughout the development and deployment of a dapp.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/octo-technology/OpenTezos/tree/main/docs/dapp/truffle_compilation_migration.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-06-14T09:08:28.000Z" class="lastUpdatedDate_1WI_">6/14/2021</time> by <strong>Theotime-Akeare</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dapp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dapp/taquito"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Taquito ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#initializing-an-empty-project" class="table-of-contents__link">Initializing an empty project</a></li><li><a href="#using-a-truffle-box" class="table-of-contents__link">Using a <em>Truffle</em> Box</a></li><li><a href="#project-structure-overview" class="table-of-contents__link">Project Structure overview</a></li><li><a href="#main-truffle-commands" class="table-of-contents__link">Main <em>Truffle</em> commands</a></li><li><a href="#compiling-smart-contracts-with-truffle" class="table-of-contents__link">Compiling smart contracts with <em>Truffle</em></a><ul><li><a href="#about-ligo-smart-contracts" class="table-of-contents__link">About ligo smart contracts</a></li><li><a href="#truffle-artifacts" class="table-of-contents__link"><em>Truffle</em> artifacts</a></li><li><a href="#hand-ons" class="table-of-contents__link">Hand-ons:</a></li></ul></li><li><a href="#deploying-smart-contracts-with-truffle" class="table-of-contents__link">Deploying smart contracts with <em>Truffle</em></a><ul><li><a href="#using-an-account-for-the-deployment" class="table-of-contents__link">Using an account for the deployment</a></li><li><a href="#adding-a-network" class="table-of-contents__link">Adding a network</a></li><li><a href="#writing-the-migration-scripts" class="table-of-contents__link">Writing the migration scripts</a></li><li><a href="#hand-ons-2" class="table-of-contents__link">Hand-ons</a></li><li><a href="#running-a-migration" class="table-of-contents__link">Running a migration</a></li></ul></li><li><a href="#interacting-with-a-deployed-contract" class="table-of-contents__link">Interacting with a deployed contract</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 OpenTezos.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.972b4ff9.js"></script>
<script src="/assets/js/main.6ca66676.js"></script>
</body>
</html>