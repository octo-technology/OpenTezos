<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenTezos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenTezos Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Unit Testing with PyTezos | OpenTezos</title><meta data-react-helmet="true" property="og:url" content="https://opentezos.com/ligo/unit-testing"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Unit Testing with PyTezos | OpenTezos"><meta data-react-helmet="true" name="description" content="There are multiple frameworks for testing Michelson contracts:"><meta data-react-helmet="true" property="og:description" content="There are multiple frameworks for testing Michelson contracts:"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://opentezos.com/ligo/unit-testing"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/ligo/unit-testing" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/ligo/unit-testing" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.60c2ec83.css">
<link rel="preload" href="/assets/js/runtime~main.972b4ff9.js" as="script">
<link rel="preload" href="/assets/js/main.6ca66676.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT" style="margin-left:2px">üåô</span></div><div class="react-toggle-track-x"><span class="toggle_71bT" style="margin-left:1px">‚òÄÔ∏è</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Welcome</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/paths">Paths</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Blockchain Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/main-properties">Main properties of the first &quot;blockchain&quot;</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/proof-of-work">Proof-of-work</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/other-consensuses">Introduction to other consensus algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tezos Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/smart-contracts">Smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/liquid-proof-of-stake">Liquid Proof-of-Stake</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/operations">Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/cli-and-rpc">CLI and RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/governance-on-chain">Governance on-chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/history-of-amendments">History of amendments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/economics-and-rewards">Economics and rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy a node</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/set-up-a-node">Set-up a node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/networks">What about networks?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/to-go-further">To go further</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to use an Explorer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/indexer-explained">How Indexers Work?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/available-tezos-indexers">Available Tezos Explorers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-main-features">How to use the tzStats blockchain explorer?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-smart-contract">Checkout your smart contract on TzStats</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/private-indexer">Private indexer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SmartPy</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/write-contract-smartpy">Smart contract development with SmartPy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/exam">Exam</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">LIGO</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ligo">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/write-contracts-ligo">Smart contract development in PascaLIGO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/language-basics">Language basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/deploy-a-contract">Smart Contract</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/ligo/unit-testing">Unit Testing with PyTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/take-away">Take Away</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Michelson</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/tutorial">Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/instructions-reference">Instructions Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/michelson/take-away">Take away</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Build a Dapp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/truffle_compilation_migration">Smart contract deployment with Truffle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/taquito">Taquito</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/temple">Temple Wallet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/basics">Build a dapp - basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/front_user_experience">Build a dapp - User Experience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Baking</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/baking_explained">How baking works?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/reward">Rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/bakers_list">List of bakers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy Bakers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/cli-baker">CLI to become a baker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/delegating">Delegating</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/voting">Voting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DeFi</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/token-standards">Token Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/dexs">Decentralized Exchanges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/wrapped-assets">Wrapped Assets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/cross-chain-swaps">Cross-chain Swaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/oracles">On-chain Oracles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/stablecoins">Stablecoins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/synthetics">Synthetics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/lending">Lending and Flash Loans</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Formal Verification</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/gadt-coq">Coq, GADT and Mi-Cho-Coq</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/modeling-theorem">Formal verification on smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Private Blockchain</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/report-issue">Report an issue</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/opentezos">Contribute to OpenTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/tezos-core">Contribute to the Tezos Core Protocol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/grant">Receive a grant</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/baker">Become a baker or a delegator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/exam">Exam</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Unit Testing with PyTezos</h1></header><div class="markdown"><p>There are multiple frameworks for testing Michelson contracts:</p><ul><li><a href="https://pytezos.org/" target="_blank" rel="noopener noreferrer">PyTezos</a></li><li><a href="https://gitlab.com/morley-framework/morley/-/blob/9455cd384b2ab897fb7b31822abca3730a4ad08b/code/cleveland/testingEDSL.md" target="_blank" rel="noopener noreferrer">Cleveland</a></li></ul><p>Another alternative is to use Tezos&#x27;s binary <code>tezos-client</code> directly.
Or there&#x27;s also a new <a href="https://tezos.gitlab.io/user/mockup.html" target="_blank" rel="noopener noreferrer">mockup</a> mode that no longer requires a Tezos node to run.</p><p>This chapter aims to introduce the concept of unit testing
and especially, how to deal with testing Tezos smart contract using the <a href="https://pytezos.org/" target="_blank" rel="noopener noreferrer">PyTezos</a> python framework.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="unit-testing"></a>Unit Testing<a class="hash-link" href="#unit-testing" title="Direct link to heading">#</a></h2><p>Just like any other programming language, writing Ligo code (for it, to be compiled into Michelson) is not the only task of a developer:
writing the tests is as important as writing the code.</p><p>Writing a test may take extra time, but this effort is usually rewarded by some great benefits:</p><ul><li>a test helps to understand the code: a user or a new developer can easily understand the code behaviour through testing.
The test name should clearly describe what the code is checking;
the test itself shows how the code should be handled.</li><li>checking the good behaviour of the written code. It is a benefit to both the developer and the user of a smart contract:
both of them want to be sure the smart contract behaves as it should</li><li>It also makes the code robust for future modifications,
i.e. code refactoring or new functionalities.
The tests make sure that the behaviour has not changed, and if it did, it will clearly outline where.</li><li>tests can easily be automated: they can be included in a CI/CD, which will run them after any push</li></ul><blockquote><p><strong>CI/CD (Continuous Integration / Continuous Delivery)</strong> is a method to frequently deliver apps to customers by introducing automation into the stages of app development.<br>
The main concepts attributed to CI/CD are continuous integration, continuous delivery, and continuous deployment.</p></blockquote><p>There are different types of tests, as described below in the automated testing strategy.</p><br><p><img src="/assets/images/pyramide_of_tests-b40f9d80b14fb0d8f1bb1b9e0009069a.svg"></p><small class="figure">FIGURE 1: Pyramide of Tests</small><p>Unit tests are the base of the pyramid and therefore the most important part.</p><p><strong>Unit testing</strong> is performed at a very fine granularity
by fully verifying the behaviour of a portion of code<br>
or by partially isolating it from its dependencies.
It will then be simpler to write and maintain. While an integration test aims to verify that several components work well together.</p><p>To go further, take a look at <a href="https://en.wikipedia.org/wiki/Test-driven_development" target="_blank" rel="noopener noreferrer">Test-Driven Development (TDD)</a> which is a development method emphasizing
the writing of automated tests as a tool to guide the implementation of features.</p><p>Ligo does not provide a testing framework. But other languages, such as Python, do.
This chapter details how to write Michelson code unit tests in Python.
Two modules are needed:</p><ul><li>the standard <em>unittest</em> module: used to write and run unit tests in Python</li><li>the <em>pytezos</em> module: used to call the entrypoints of a smart contract, without deploying the smart contract.
This module is an interesting option because it is well-maintained and easy to use.
</li></ul><blockquote><p><strong>The execution time or CPU time</strong> of a given task is defined as the time spent by the system executing that task.<br>
<strong>Cost</strong> can be seen as the complexity and time required for the developer to write a test.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pytezos-installation"></a>PyTezos Installation<a class="hash-link" href="#pytezos-installation" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="requirement"></a>Requirement<a class="hash-link" href="#requirement" title="Direct link to heading">#</a></h3><ul><li>Python 3</li><li>Text editor</li><li>Cryptographic dependencies, detailed here <a href="https://pytezos.org/quick_start.html#requirements" target="_blank" rel="noopener noreferrer">link</a>.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installation"></a>Installation<a class="hash-link" href="#installation" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creation-of-a-virtual-environment"></a>Creation of a virtual environment<a class="hash-link" href="#creation-of-a-virtual-environment" title="Direct link to heading">#</a></h4><p>A virtual environment is a self-contained Python installation, separated from the global Python installation.
It contains its own modules. Hence, it is most useful when a specific version of a module is needed, without affecting the other modules.
Run this command to create a virtual environment:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">python3 -m venv /path/to/env</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="activating-the-environment"></a>Activating the environment<a class="hash-link" href="#activating-the-environment" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token builtin class-name" style="color:rgb(227, 98, 9)">source</span><span class="token plain"> /path/to/env/bin/activate</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installation-of-the-necessary-python-libraries"></a>Installation of the necessary python libraries<a class="hash-link" href="#installation-of-the-necessary-python-libraries" title="Direct link to heading">#</a></h4><p>Installation of <strong>PyTezos</strong>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> pip </span><span class="token function" style="color:rgb(111, 66, 193)">install</span><span class="token plain"> pytezos</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Verification of the installation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> python -c </span><span class="token string">&quot;import pytezos&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If the command returns nothing then the installation is successful.</p><p>You can find the official documentation here <a href="https://pytezos.org/" target="_blank" rel="noopener noreferrer">https://pytezos.org/</a> and
all the versions on the project&#x27;s Github <a href="https://github.com/baking-bad/pytezos" target="_blank" rel="noopener noreferrer">https://github.com/baking-bad/pytezos</a> in the <a href="https://github.com/baking-bad/pytezos/releases" target="_blank" rel="noopener noreferrer">Releases part</a>.</p><blockquote><p>The pytezos version used for the following example is <code>pytezos==3.1.0</code>.<br>
You can check the version of your package with the <code>pip freeze</code> command.<br>
You can install a specific version if needed with <code>pip install pytezos=={pytezos_version}</code>.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="unittest-python-library"></a>Unittest (Python library)<a class="hash-link" href="#unittest-python-library" title="Direct link to heading">#</a></h2><p><em>Unittest</em> is the standard unit testing framework for Python.
Before writing a test for smart contracts with <strong>PyTezos</strong>,
you need to know how to use the test library.</p><p>Let&#x27;s see how <strong>Unittest</strong> works through a simple example.</p><p>Consider a python file <code>calculator.py</code> with two functions: <code>multiply</code> and <code>divide</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)">#calculator.py</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">multiply</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(0, 92, 197)">*</span><span class="token plain"> y</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">divide</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">if</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(0, 92, 197)">!=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token plain"> y</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In order to test these two functions
let&#x27;s create a new test file beginning by <strong>test_</strong> : <code>test_calculator.py</code>.</p><p>In this file you will need to:</p><ul><li>import the unittest module</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> unittest</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>import the file you want with the functions you want to test: <code>import calculator</code></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> unittest</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> calculator</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>Create a test class that inherits from <code>unittest.TestCase</code>.<br>You can name this class whatever you want but try to keep it descriptive.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> unittest</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">from</span><span class="token plain"> unittestExample </span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> calculator</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">TestCalculator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">unittest</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">TestCase</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">pass</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">#keyword which tells the class to do nothing</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>Write your tests. Keep in mind these few basic rules:<ul><li>A test must check only one behaviour at a time.</li><li>One test = one method</li><li>No magic number: all the values used must be declared in variables, with explicit names</li><li>There can be no useless variables to pass the test. If a variable can be removed without making the test fail, it must be removed.</li><li>The method name must be explicit. Anyone should understand what the test takes as input, what behaviour is been checked and what result is expected.</li><li>A test can be divided into three parts (as implemented in the tests below):<ul><li>GIVEN section: input declarations, expected results</li><li>WHEN section: the tested method is called with the declared inputs</li><li>THEN: assertions checks</li></ul></li></ul></li></ul><p>With unittest, a test method must include <code>test_</code> otherwise it will not be considered as a test.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">TestCalculator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">unittest</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">TestCase</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test_multiplying_10_and_5_should_return_</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># GIVEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    x </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    y </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    expected_multiplication_result </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">50</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># WHEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    result </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> calculator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">multiply</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># THEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">assertEqual</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> expected_multiplication_result</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test_dividing_7_and_3_should_return_a_floating_number_2_33333333</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># GIVEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    x </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">7</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    y </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    expected_division_result </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">2.3333333333333335</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># WHEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    result </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> calculator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">divide</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># THEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">assertEqual</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> expected_division_result</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><blockquote><p>At the beginning of this chapter, several of the benefits of unit testing were raised.
This simple tests-suite gives a good example:</p><ul><li>Reading the test name gives a clear idea about its code implementation.
For instance, the second test shows that it is not a Euclidean division been implemented</li><li>The dividng method could be the Euclidean division. The test checks that it returns, is a float number and not an int.
If another developer was to change it into a Euclidean division, the test would fail and instantly warn the developer of a breaking change</li></ul></blockquote><blockquote><p>Note that class names are by convention in <strong>CamelCase</strong>
and test method names are in <strong>snake_case</strong>.</p></blockquote><p>You can run your tests in the command line as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">python -m unittest test_calculator</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This should return:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token punctuation" style="color:rgb(36, 41, 46)">..</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">----------------------------------------------------------------------</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Ran </span><span class="token number">2</span><span class="token plain"> tests </span><span class="token keyword" style="color:#e3116c">in</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">.002s</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">OK</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Note that the command has executed all the tests in the <code>test_calculator.py</code> file,
but that it is only possible to execute some specific tests.</p><p>Indeed, the unittest module can be used from the command line to execute tests from modules,
classes or even individual test methods:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">python -m unittest test_calculator</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">python -m unittest test_calculator.TestCalculator</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">python -m unittest test_calculator.TestCalculator.test_sub</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="testing-a-compiled-smart-contract-with-pytezos"></a>Testing a compiled smart contract with PyTezos<a class="hash-link" href="#testing-a-compiled-smart-contract-with-pytezos" title="Direct link to heading">#</a></h2><p><strong>PyTezos</strong> library is a <strong>Python</strong> toolset for the <strong>Tezos</strong> blockchain,
it includes work with keys, signatures, contracts, operations, RPC query builder,
and a high-level interface for smart contract interaction.</p><p>This module is very interesting for testing smart-contracts unit:</p><ul><li>it can directly test the Michelson code with a Python script, without having to deploy it on a testnet.</li><li>since it does not have to wait for transactions confirmations, the tests are fast to run</li><li>it can simulate any execution context (sender, amount, storage...)</li><li>it gives total control over the storage: each test has its own initial storage, and the output storage can be checked.</li><li>the tests are independent one from another. If the tests were run on a deployed smart contract, the initial storage of a test would be the output storage of the previous one.</li></ul><p>In this section, we will test the entrypoints of a michelson script
for a smart contract that is compiled but not deployed.</p><p>For this we will need:</p><ul><li>The <strong>Unittest</strong> library, which is the standard framework for writing tests in Python.</li><li>Two very useful classes from <strong>PyTezos</strong>:<ul><li><strong>ContractInterface</strong>: allows interfacing with the entrypoints of a contract
and interact with them.</li><li><strong>MichelsonRuntimeError</strong>: allows handling errors raised during execution.</li></ul></li></ul><p>To write the tests we will use the following template:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)"># TEMPLATE</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">from</span><span class="token plain"> unittest </span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> TestCase</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> skip</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">from</span><span class="token plain"> pytezos </span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> MichelsonRuntimeError</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> ContractInterface</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">path_to_michelson_contract </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;/path/to/contract.tz&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">TestContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">TestCase</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@classmethod</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">setUpClass</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    cls</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">myContract </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> ContractInterface</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">create_from</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">path_to_michelson_contract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test_description_1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">pass</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test_description_2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">pass</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@skip</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;test 3 is not launched&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test_description_3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">pass</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>PyTezos</strong> requires the path to a file containing Michelson code <code>path_to_michelson_contract</code>.</p><p>The compiled contract is obtained through a command of this type:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">ligo compile-contract file.ligo main </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> contract.tz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Remember to recompile after any modification of the contract.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="equivalence-between-michelson-types-and-python"></a>Equivalence between michelson types and python<a class="hash-link" href="#equivalence-between-michelson-types-and-python" title="Direct link to heading">#</a></h3><p><strong>PyTezos</strong> allows you to interpret michelson code, here are the equivalences:</p><table><thead><tr><th align="center">Michelson</th><th align="center">Python</th></tr></thead><tbody><tr><td align="center">List, Set</td><td align="center">[]</td></tr><tr><td align="center">Big_map</td><td align="center">()</td></tr><tr><td align="center">String</td><td align="center">String</td></tr><tr><td align="center">Number</td><td align="center">Integer</td></tr><tr><td align="center">mutez, tez</td><td align="center">Interpreted as Integer by <code>.interpret()</code></td></tr></tbody></table><p>For example if you want to check the content of a list in the storage you would write:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">assertEqual</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">my_list_from_the_storage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">expected_value1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> expected_value2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The way to get <code>my_list_from_the_storage</code> is detailed below in the examples.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="counter-contract-example"></a>Counter Contract Example<a class="hash-link" href="#counter-contract-example" title="Direct link to heading">#</a></h3><p>Here is an example of a <strong>Counter contract</strong> that handles an integer of &quot;counter&quot; value, an administrator address
as storage and allows the administrator <strong>only</strong> to increment or decrement this counter.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">type indiceStorage is record</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    counter </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> int</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    administrator </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">type indiceEntrypoints is </span><span class="token maybe-class-name">Increment</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">of</span><span class="token plain"> int </span><span class="token operator" style="color:rgb(0, 92, 197)">|</span><span class="token plain"> </span><span class="token maybe-class-name">Decrement</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">of</span><span class="token plain"> int</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">type indiceFullReturn is </span><span class="token function" style="color:rgb(111, 66, 193)">list</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">*</span><span class="token plain"> indiceStorage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter keyword" style="color:#e3116c">const</span><span class="token parameter"> param </span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> int</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#e3116c">const</span><span class="token parameter"> s </span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> indiceStorage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> indiceFullReturn is</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword control-flow" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">source</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token operator" style="color:rgb(0, 92, 197)">/=</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">administrator</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">then</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">failwith</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;administrator not recognized&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> indiceFullReturn</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">nil </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">list</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> s </span><span class="token keyword" style="color:#e3116c">with</span><span class="token plain"> record </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">counter</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">counter</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> param</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">decrement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter keyword" style="color:#e3116c">const</span><span class="token parameter"> param </span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> int</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#e3116c">const</span><span class="token parameter"> s </span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> indiceStorage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> indiceFullReturn is</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword control-flow" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">source</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token operator" style="color:rgb(0, 92, 197)">/=</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">administrator</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">then</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">failwith</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;administrator not recognized&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> indiceFullReturn</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">nil </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">list</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> s </span><span class="token keyword" style="color:#e3116c">with</span><span class="token plain"> record </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">counter</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">counter</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain"> param</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">main</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter keyword" style="color:#e3116c">const</span><span class="token parameter"> ep </span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> indiceEntrypoints</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#e3116c">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> indiceStorage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> indiceFullReturn is</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">block </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> ret </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> indiceFullReturn </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">case</span><span class="token plain"> ep </span><span class="token keyword" style="color:#e3116c">of</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 92, 197)">|</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(111, 66, 193)">Increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 92, 197)">|</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(111, 66, 193)">Decrement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">decrement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    end</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">with</span><span class="token plain"> ret</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Let&#x27;s compile this contract and save the result in a Michelson file <code>counter.tz</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">ligo compile-contract counter.ligo main </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> counter.tz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The output is :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">int </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">decrement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">int </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token function" style="color:rgb(111, 66, 193)">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">address </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">administrator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">int </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">counter</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">UNPAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">         </span><span class="token constant" style="color:rgb(100, 102, 149)">IF_LEFT</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">           </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">DUG</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">SOURCE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">COMPARE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">NEQ</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">IF</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DROP</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> string </span><span class="token string">&quot;administrator not recognized&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILWITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">DUG</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">SUB</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">           </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">DUG</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">SOURCE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">COMPARE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">NEQ</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">             </span><span class="token constant" style="color:rgb(100, 102, 149)">IF</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DROP</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> string </span><span class="token string">&quot;administrator not recognized&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">FAILWITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">DUG</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>First, let&#x27;s test the <strong>increment</strong> entrypoint if the user is the administrator.</p><blockquote><p>Note that only the administrator is allowed to modify the storage and if another person tries to do it
then the contract will return an error.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword control-flow" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">source</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token operator" style="color:rgb(0, 92, 197)">/=</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">administrator</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">then</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">failwith</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;administrator not recognized&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> indiceFullReturn</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test-increment-entrypoint"></a>Test increment entrypoint<a class="hash-link" href="#test-increment-entrypoint" title="Direct link to heading">#</a></h4><p>For example, let&#x27;s write a test that verifies that the storage is incremented by 5
when the administrator performs the <code>Increment(5)</code> action.</p><ul><li>For the test a false address tz1 has been assigned to the administrator,
you can generate a false address <a href="https://faucet.tzalpha.net/" target="_blank" rel="noopener noreferrer">here</a>.</li><li>In the <code>setUpClass</code> method we load the contract from the michelson source-code, stored in the <strong>counter.tz</strong> file,
with the <code>ContractInterface.from_file()</code> method.</li><li>Note that the name of the test accurately describes the test&#x27;s intention.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">from</span><span class="token plain"> unittest </span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> TestCase</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">from</span><span class="token plain"> pytezos </span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> MichelsonRuntimeError</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> ContractInterface</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">path_to_michelson_contract </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;counter.tz&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">administrator </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;tz1L738ifd66ah69PrmKAZzckvvHnbcSeqjf&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">TestCounterContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">TestCase</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(36, 41, 46)">@classmethod</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">setUpClass</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        cls</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">counterContract </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> ContractInterface</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">from_file</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">path_to_michelson_contract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test_storage_counter_is_incremented_by_5_if_the_source_is_the_administrator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># GIVEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        storage </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token string">&quot;administrator&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> administrator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;counter&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        value </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># WHEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        result </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">counterContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">interpret</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">storage</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">storage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">administrator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># THEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">assertEqual</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">storage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>GIVEN</strong> </p><ul><li>That the storage has been initialized as a dictionary <code>{}</code>
to respect the equivalence with the michelson format. </li><li>The incremented value is an <code>int</code>.</li></ul><p><strong>WHEN</strong></p><ul><li>From our contract <code>self.counterContract</code> we can call an <strong>entrypoint</strong> and its <strong>parameter</strong> with <code>.increment(value)</code>.</li><li>Then we can add a context with <code>.interpret()</code>.
to specify the storage and the source (the original address that is sending the transaction).</li></ul><p><strong>THEN</strong><br>
Finally we can check that the storage counter has been incremented by 5
with <code>self.assertEqual(&lt;actual_value&gt;, &lt;expected_value&gt;)</code>.</p><p>Let&#x27;s run the test:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">python -m unittest test_counter.TestCounterContract.test_storage_counter_is_incremented_by_5_if_the_source_is_the_administrator</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">----------------------------------------------------------------------</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Ran </span><span class="token number">1</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(227, 98, 9)">test</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">in</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">.011s</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">OK</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Great, it worked!</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="test-unauthorized-user-michelsonruntimeerror"></a>Test unauthorized user (MichelsonRuntimeError)<a class="hash-link" href="#test-unauthorized-user-michelsonruntimeerror" title="Direct link to heading">#</a></h4><p>Now let&#x27;s imagine that someone other than the administrator
tries to modify the storage by incrementing or decrementing it.</p><p>Let&#x27;s write a test to make sure that this user gets rejected.</p><p>First, let&#x27;s add a new user <strong>alice</strong> at the beginning of the file,
with a different address from the <strong>administrator</strong>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">administrator </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;tz1L738ifd66ah69PrmKAZzckvvHnbcSeqjf&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">alice </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;tz1LFuHW4Z9zsCwg1cgGTKU12WZAs27ZD14v&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then following the first test, let&#x27;s write the new test:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test_should_failed_if_the_source_is_not_the_administrator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">with</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">assertRaises</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">MichelsonRuntimeError</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">as</span><span class="token plain"> administrator_error</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># GIVEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        storage </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token string">&quot;administrator&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> administrator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;counter&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        value </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)"># WHEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">counterContract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">interpret</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">storage</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">storage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> source</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># THEN</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    error_message </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token builtin" style="color:#e3116c">str</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">administrator_error</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">exception</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;\\&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;&#x27;&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">assertEqual</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;administrator not recognized&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> error_message</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>The line <code>with self.assertRaises(MichelsonRuntimeError) as administrator_error:</code>
retrieves and stores the error in the <code>administrator_error</code> variable. </li><li>The administrator&#x27;s address is still defined in the initial state of storage
but this time alice&#x27;s address is specified in the context&#x27;s source variable: <code>source=alice</code>.</li><li>Finally, the string message from the error is stored in the variable <code>error_message</code>
and is compared with the original message written in the <code>failwith()</code> of the LIGO code. </li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">python -m unittest test_counter.TestCounterContract.test_should_failed_if_the_source_is_not_the_administrator</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">----------------------------------------------------------------------</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Ran </span><span class="token number">1</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(227, 98, 9)">test</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">in</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">.011s</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">OK</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Now it&#x27;s your turn to write your tests!
Try to do the same thing with the entrypoint <code>decrement</code> for example.<br>
The goal of writing tests is to have optimal coverage of the whole code.<br>
This allows you to have a robust and high-quality code.
Moreover, future developers that use your code will thank you, very much.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/octo-technology/OpenTezos/tree/main/docs/ligo/unit-testing.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-06-01T09:07:30.000Z" class="lastUpdatedDate_1WI_">6/1/2021</time> by <strong>Theotime-Akeare</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ligo/deploy-a-contract"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Smart Contract</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ligo/examples"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Examples ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#unit-testing" class="table-of-contents__link">Unit Testing</a></li><li><a href="#pytezos-installation" class="table-of-contents__link">PyTezos Installation</a><ul><li><a href="#requirement" class="table-of-contents__link">Requirement</a></li><li><a href="#installation" class="table-of-contents__link">Installation</a></li></ul></li><li><a href="#unittest-python-library" class="table-of-contents__link">Unittest (Python library)</a></li><li><a href="#testing-a-compiled-smart-contract-with-pytezos" class="table-of-contents__link">Testing a compiled smart contract with PyTezos</a><ul><li><a href="#equivalence-between-michelson-types-and-python" class="table-of-contents__link">Equivalence between michelson types and python</a></li><li><a href="#counter-contract-example" class="table-of-contents__link">Counter Contract Example</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 OpenTezos.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.972b4ff9.js"></script>
<script src="/assets/js/main.6ca66676.js"></script>
</body>
</html>