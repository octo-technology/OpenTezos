<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenTezos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenTezos Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Tutorial | OpenTezos</title><meta data-react-helmet="true" property="og:url" content="https://opentezos.com/michelson/tutorial"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Tutorial | OpenTezos"><meta data-react-helmet="true" name="description" content="This section introduces the main concepts of the Michelson language. It begins with the basics of stack manipulation then focuses on primitive types and more complex data structures. Finally the chapter focuses on specific features related to smart contracts concepts."><meta data-react-helmet="true" property="og:description" content="This section introduces the main concepts of the Michelson language. It begins with the basics of stack manipulation then focuses on primitive types and more complex data structures. Finally the chapter focuses on specific features related to smart contracts concepts."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://opentezos.com/michelson/tutorial"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/michelson/tutorial" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/michelson/tutorial" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.60c2ec83.css">
<link rel="preload" href="/assets/js/runtime~main.972b4ff9.js" as="script">
<link rel="preload" href="/assets/js/main.6ca66676.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT" style="margin-left:2px">üåô</span></div><div class="react-toggle-track-x"><span class="toggle_71bT" style="margin-left:1px">‚òÄÔ∏è</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/octo-technology/OpenTezos/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Welcome</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/paths">Paths</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Blockchain Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/main-properties">Main properties of the first &quot;blockchain&quot;</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/proof-of-work">Proof-of-work</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/other-consensuses">Introduction to other consensus algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blockchain-basics/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tezos Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/smart-contracts">Smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/liquid-proof-of-stake">Liquid Proof-of-Stake</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/operations">Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/cli-and-rpc">CLI and RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/governance-on-chain">Governance on-chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/history-of-amendments">History of amendments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/economics-and-rewards">Economics and rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tezos-basics/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy a node</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/set-up-a-node">Set-up a node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/networks">What about networks?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/to-go-further">To go further</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/deploy-a-node/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to use an Explorer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/indexer-explained">How Indexers Work?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/available-tezos-indexers">Available Tezos Explorers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-main-features">How to use the tzStats blockchain explorer?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/tzstats-smart-contract">Checkout your smart contract on TzStats</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/private-indexer">Private indexer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/explorer/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SmartPy</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/write-contract-smartpy">Smart contract development with SmartPy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/smartpy/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">LIGO</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/write-contracts-ligo">Smart contract development in PascaLIGO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/language-basics">Language basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/deploy-a-contract">Smart Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/unit-testing">Unit Testing with PyTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ligo/take-away">Take Away</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Michelson</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/michelson">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/michelson/smart-contracts">Smart Contracts</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/michelson/tutorial">Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/michelson/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/michelson/instructions-reference">Instructions Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/michelson/exam">Exam</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/michelson/take-away">Take away</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Build a Dapp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/truffle_compilation_migration">Smart contract deployment with Truffle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/taquito">Taquito</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/temple">Temple Wallet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/basics">Build a dapp - basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/front_user_experience">Build a dapp - User Experience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dapp/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Baking</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/baking_explained">How baking works?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/reward">Rewards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/bakers_list">List of bakers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baking/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deploy Bakers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/cli-baker">CLI to become a baker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/delegating">Delegating</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/voting">Voting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/baker/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DeFi</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/token-standards">Token Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/dexs">Decentralized Exchanges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/wrapped-assets">Wrapped Assets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/cross-chain-swaps">Cross-chain Swaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/oracles">On-chain Oracles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/stablecoins">Stablecoins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/synthetics">Synthetics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/lending">Lending and Flash Loans</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/defi/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Formal Verification</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/gadt-coq">Coq, GADT and Mi-Cho-Coq</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/modeling-theorem">Formal verification on smart contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/formal-verification/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Private Blockchain</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/private/exam">Exam</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/report-issue">Report an issue</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/opentezos">Contribute to OpenTezos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/tezos-core">Contribute to the Tezos Core Protocol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/grant">Receive a grant</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/baker">Become a baker or a delegator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribute/exam">Exam</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Tutorial</h1></header><div class="markdown"><p>This section introduces the main concepts of the Michelson language. It begins with the basics of <strong>stack manipulation</strong> then focuses on primitive types and more complex <strong>data structures</strong>. Finally the chapter focuses on specific features related to smart contracts concepts.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="stack-programming"></a>Stack programming<a class="hash-link" href="#stack-programming" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="basics"></a>Basics<a class="hash-link" href="#basics" title="Direct link to heading">#</a></h4><p>Michelson is a stack-based language, which means that all the data (manipulated by the program) is stacked on a single pile. The Michelson language provides stack operators to reorganize elements of the stack and other kinds of operators which consume the top elements of the stack. In this section, we will introduce basic stack-manipulation operators and illustrates them with simple examples. Then, in a second time, we will focus on the arithmetic operators and conditional branching.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="type-checking"></a>Type checking<a class="hash-link" href="#type-checking" title="Direct link to heading">#</a></h5><p>In order to operate Michelson instructions, certain type of elements are required to be in the stack and in a specific order. If these expectations are not met, the type checking of the Michelson script would fail and the execution of the smart contract would stop.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="basic-stack-operators-push-drop-swap"></a>Basic stack operators (PUSH DROP SWAP)<a class="hash-link" href="#basic-stack-operators-push-drop-swap" title="Direct link to heading">#</a></h5><p>The code of a smart contract is defined as a <strong>sequence</strong> of Michelson instructions. The <strong>sequence</strong> structure is defined by <code>{</code> and <code>}</code>, and contains instructions separated by <code>;</code> (semi-colon). When executing a sequence, the interpreter executes each instruction sequentially, one after the other, in the specified order.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> instruction1 </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  instruction2 </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 92, 197)">...</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  instruction n </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="root_2W3B"><p>The Michelson language must respect a precise indentation. Each instruction that introduces a new block must indent its content. It is recommended to have a single instruction per line. For instance, the `IF` instruction introduces two sequences of instructions (the `then` clause and `else` clause) which must be indented as shown below.</p></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { instruction1;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       instruction2;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       IF</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              { then_clause }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              { else_clause };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       instruction4;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Let&#x27;s describe the basic instructions (PUSH, DROP, SWAP) that manipulates stack elements.</p><p>The <code>PUSH</code> instruction adds an element at the top of the stack. The value and the type of the element pushed must be specified.</p><p>For example, the instruction <code>PUSH nat 1</code> adds an element <code>1</code> as a natural integer (i.e., a positive integer) on top of the stack. The instruction <code>PUSH string &quot;Hello&quot;</code> adds an element &quot;Hello&quot; as a string on top of the stack.</p><p>The <code>DROP</code> instruction removes the top element of the stack.</p><p>The following diagram executes the sequence <code>{ PUSH nat 1; DROP }</code> which illustrates the <code>PUSH</code> and <code>DROP</code> usage.</p><p><img src="/assets/images/michelson_tutorial_push_drop-425301f6b130aaff162d59abd67a5aa0.svg"></p><small class="figure">FIGURE 1: Execution of `PUSH` and `DROP`</small><p>The <code>SWAP</code> instruction inverts the position of the top two elements of the stack.</p><p><img src="/assets/images/michelson_instruction_swap_example-f8ab1903def5f30ecaa8a953a0790027.svg"></p><small class="figure">FIGURE 2: Illustration of the `SWAP` instruction</small><p>The <code>DUP</code> instruction duplicates the top element of the stack and prevents the loss of variables since most instructions consume and remove elements from the stack. Later examples will illustrate this further.</p><p><img src="/assets/images/michelson_instruction_dup_example-f2a97d8c62fc429aff0dca5370d989aa.svg"></p><small class="figure">FIGURE 3: Illustration of the `DUP` instruction</small><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="stack-manipulation-using-arithmetic-operators"></a>Stack manipulation using arithmetic operators<a class="hash-link" href="#stack-manipulation-using-arithmetic-operators" title="Direct link to heading">#</a></h5><p>Once elements are added to the stack, they can be combined using arithmetic operators such as addition (<code>ADD</code>) and multiplication (<code>MUL</code>). Other arithmetic operators are described in the <strong>Instructions/Operations on numbers</strong> section.</p><p>The <code>ADD</code> instruction sums the top two elements of the stack and <code>MUL</code> multiplies them. The result is then pushed on top of the stack.</p><p><img src="/assets/images/michelson_instruction_add_example-938944ba9bd680b6fc511043a9f61fdd.svg"></p><small class="figure">FIGURE 4: Illustration of the `ADD` instruction</small><p>More complex computation can be done. For instance, the mathematical expression <code>((2 + 3) * 6) + 7</code> is equivalent to the following sequence:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">MUL</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The following diagram illustrates the execution of the sequence.</p><p><img src="/assets/images/michelson_tutorial_arithmetic-bad7ef02393252f5f961faf0212c839b.svg"></p><small class="figure">FIGURE 5: Illustration of the arithmetic operators</small><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="other-basic-stack-operators-dig-dug"></a>Other basic stack operators (DIG DUG)<a class="hash-link" href="#other-basic-stack-operators-dig-dug" title="Direct link to heading">#</a></h5><p>Other instructions allow you to change the position of elements in the stack such as <code>DIG</code> and <code>DUG</code>. Other stack operators are described in the &quot;Stack operations&quot; section.</p><p>The <code>DIG n</code> instruction moves the n-th element of the stack to the top of the stack.</p><p><img src="/assets/images/michelson_instruction_dig_example-0c1f6744d93fa7c896ec6bfc70181417.svg"></p><small class="figure">FIGURE 6: Illustration of the `DIG` instruction</small><p>The <code>DUG n</code> instruction moves the top element of the stack to the n-th element of the stack.</p><p><img src="/assets/images/michelson_instruction_dug_example-a4bcecd1511e67965798974cb42ddf03.svg"></p><small class="figure">FIGURE 7: Illustration of the `DUG` instruction</small><p>For example, the mathematical expression <code>((2 + 3) * 6) + 7</code> is equivalent to the following sequence of instructions:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">DUG</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">DIG</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">MUL</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The following schema illustrates the execution of this sequence of instructions.</p><p><img src="/assets/images/michelson_tutorial_dug_dig-f95813b4a910b02c16296457f6a57716.svg"></p><small class="figure">FIGURE 8: Illustration of the `DUG` and `DIG` instructions</small><p>Now that we have seen the basic of stack operators, we are able to re-organize elements of the stack. These stack operators will be useful to prepare the stack for more complex operators that require precise elements in a specific order on the top of the stack.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conditional-branching"></a>Conditional branching<a class="hash-link" href="#conditional-branching" title="Direct link to heading">#</a></h5><p>The Michelson language provides the possibility to execute a part of the code, depending on some criteria. This is called conditional branching, and some instructions exist for this intent.</p><p>The <code>IF {} {}</code> instruction allows branches of execution to be created. It takes two sequences as arguments. It expects a boolean at the top of the stack. It consumes the top element and executes the first given sequence if this boolean top element is <em>True</em>. Otherwise it executes the second sequence.</p><p>In order to illustrate the conditional branching, let&#x27;s explain the following sequence of instructions.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">IF</span><span class="token plain"> </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This snippet of code is equivalent to the expression <code>if True then 1 else 2</code>. It checks the top element of the stack and ensures it is a boolean and consumes it. If the value of this top element is <em>True</em> then the value 1 is pushed onto the stack otherwise value 2 is pushed. </p><p>This other example removes one of the top elements of the stack. If the top element is a boolean <em>True</em> then the next element is removed or the one after is removes.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">IF</span><span class="token plain"> </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DROP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DROP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The following diagrams illustrates the modification of the stack while executing the <code>IF { DROP }</code> instruction part.</p><p><img src="/assets/images/michelson_tutorial_if_true-7cb74164e9706c0d834988a1bc7baf27.svg"></p><small class="figure">FIGURE 9: Illustration of the `IF` instruction (true case)</small><p>The following diagrams illustrates the modification of the stack while executing the <code>IF { SWAP; DROP }</code> instruction part.</p><p><img src="/assets/images/michelson_tutorial_if_false-0735e3057a36329da26b2c19ad47f415.svg"></p><small class="figure">FIGURE 10: Illustration of the `IF` instruction (false case)</small><p>The conditional branching can be combined with other instructions, such as the comparison. </p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="comparison"></a>Comparison<a class="hash-link" href="#comparison" title="Direct link to heading">#</a></h5><p>Elements of the stack can be compared if they belong to the same class of types (called <strong>comparable</strong>). For example, two integers can be compared but an integer and a string cannot, because they don&#x27;t belong to the same class of comparable types.</p><p>Since primitive types are different by design, each primitive type is comparable to itself (e.g. there is no meaning in comparing a string to a number). Basically, numbers (<em>nat</em>, <em>int</em>, <em>mutez</em>, <em>timestamp</em>) are compared numerically, sequence of characters (<em>string</em>, <em>bytes</em>, <em>key_hash</em>, <em>key</em>, <em>signature</em>, <em>chain_id</em> values) are compared lexicographically.  </p><p>For <em>pair</em> values such as <code>(Pair d1 d2)</code>, the comparison is done component-wise, starting with the left component.
For <em>option</em> values, the <code>None</code> value is considered less than <code>Some</code> value, and comparing <code>Some x</code> and <code>Some y</code> is done by comparing <code>x</code> and <code>y</code>.
These two types (<em>option</em> and <em>pair</em>) will be introduced later in this tutorial.</p><p>The <code>COMPARE</code> instruction compares the top two elements of the stack. It consumes the two top elements and returns an integer at the top of the stack. The outcome value is <code>-1</code> if the first element is smaller than the second one; <code>0</code> if the two first elements are equal; <code>1</code> otherwise.</p><p><img src="/assets/images/michelson_instruction_compare_example-e697aa4e8764e371664efa7ac5b87350.svg"></p><small class="figure">FIGURE 11: Illustration of the `COMPARE` instruction</small><p>The <code>EQ</code> instruction consumes the top element and returns a boolean on top of the stack. It returns <em>True</em> if this value is zero, <em>False</em> otherwise. </p><p>The combination of the <code>COMPARE</code> and <code>EQ</code> instructions allows you to create boolean conditions based on a number comparison. The following sequence verifies if two numbers are equal and returns a boolean answer on top of the stack.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">COMPARE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">EQ</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="/assets/images/michelson_tutorial_compare_example-00193e5f30a5b32f01b2afa717fe6b1f.svg"></p><small class="figure">FIGURE 12: Illustration of number comparison</small><p>Other comparison instructions are available to check if a number is lower or equal to zero (<code>LE</code> instruction) or greater than zero (<code>GT</code> instruction). The list of comparison operators is described in the <strong>Generic comparison</strong> section.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conditional-branching-based-on-number-comparison"></a>Conditional branching based on number comparison<a class="hash-link" href="#conditional-branching-based-on-number-comparison" title="Direct link to heading">#</a></h5><p>The combination of the <code>COMPARE</code>, <code>LE</code> and <code>IF</code> instructions allows you to apply conditional branching by comparing two numbers. The following sequence of instructions assumes that two integers are on top of the stack and removes the smaller one.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">DUP;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">DUG 2;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">SWAP;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">DUP;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">DUG 2;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">DUG 3;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">COMPARE;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">LE;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">IF { DROP } { SWAP; DROP }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that the <code>DUP; DUG 2; SWAP; DUP; DUG 2; DUG 3</code> sequence duplicates the top two elements of the stack. The <code>COMPARE; LE</code> sequence determines which is the biggest number and the <code>IF { DROP } { SWAP; DROP }</code> sequence removes the smallest number.</p><p><img src="/assets/images/michelson_tutorial_compare_numbers-30e7765a044ec0016ca6e7386736c376.svg"></p><small class="figure">FIGURE 13: Illustration of conditional branching based on number comparison</small><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="more-stack-operator-dip-cmple"></a>More stack operator (<code>DIP</code>, <code>CMPLE</code>)<a class="hash-link" href="#more-stack-operator-dip-cmple" title="Direct link to heading">#</a></h5><p>This principle of duplicating the top two elements of the stack and comparing them to choose one of them is a common pattern. Some syntactic sugar (i.e. a &quot;shortcut&quot; instruction that combines many of the language&#x27;s basic instructions) and macros have been introduced in the Michelson language to ease these common patterns. </p><p>For example, the macro <code>CMPLE</code> stands for <code>COMPARE; LE</code>. A more exhaustive list is available in the <strong>macros</strong> section.</p><p>Notice that the duplication of the top two elements of the stack is not an optimal sequence. It is intended to be like this in order to illustrate the <code>DUG</code> instruction, but some better implementation can be done with the <code>DIP</code> instruction.</p><p>The <code>DIP</code> instruction runs a provided sequence of instructions while protecting the <em>n</em> top elements of the stack.</p><p>The <code>DIP</code> instruction takes two arguments:</p><ul><li><em>n</em>: a number of elements to protect (by default 1)</li><li><em>code</em>: a sequence of instructions to execute</li></ul><p>This instruction can be very useful. For example, let&#x27;s re-write the duplication of the top two elements of the stack with the <code>DIP</code> instruction.</p><p>The following sequence of instructions expects two integers on top of the stack and removes the smaller one.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">DIP { DUP };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">DUP;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">DIP { SWAP };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">CMPLE;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">IF { DROP } { SWAP; DROP }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="/assets/images/michelson_tutorial_compare_numbers_dip-ef17a41a4f8eb0e37cfe5590a92d1fb5.svg"></p><small class="figure">FIGURE 14: Illustration of conditional branching based on number comparison</small><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="primitive-types-support"></a>Primitive types support<a class="hash-link" href="#primitive-types-support" title="Direct link to heading">#</a></h3><p>The Michelson language supports only few primitive data types:</p><ul><li><code>nat</code> represents a natural integer (e.g. 0, 3, 15)</li><li><code>int</code> represents a integer (e.g. -10, 2, 3)</li><li><code>string</code> represents a sequence of characters (e.g. &quot;Hello&quot;)</li><li><code>bool</code> represents a boolean value (e.g. True, False)</li><li><code>bytes</code> represents a sequence of bytes (octet)</li><li><code>unit</code> represents a non-specified type.</li><li><code>timestamp</code> represents a duration (e.g. NOW, 1571659294, &quot;2019-09-26T10:59:51Z&quot;; i.e. a string following the RFC3339 standard)</li></ul><p>Notice that there is no floating-point type supported (such as <em>float</em>).</p><div class="root_2W3B"><p>It is worth mentioning that there is no limit to the value of numbers (_nat_, _int_) or length of strings (_string_, _bytes_) other than the storage limit and gas limit (specified in the Tezos protocol). Therefore there is no risk of overflow errors.</p></div><p>Other Tezos specific types such as <code>tez</code> and <code>address</code> will be listed and explained later.</p><p>The Michelson language also allows for the manipulation of these types, but before going on primitive type, let&#x27;s introduce the <em>unit</em> type, the <em>optional</em> (i.e. the <em>option</em> type) and the <em>pair</em> type.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="default-unit-type"></a>Default <code>UNIT</code> type<a class="hash-link" href="#default-unit-type" title="Direct link to heading">#</a></h4><p>The <code>UNIT</code> instruction pushes a <code>Unit</code> value of type <em>unit</em> on top of the stack. The <em>unit</em> type stands in many contexts for nothing:</p><ul><li>an empty structure in case of storage. </li><li>an empty entry point in case of a parameter.</li><li>an empty argument in a function. </li></ul><p>The <code>Unit</code> value represents the value of a <em>unit</em> type.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="stopping-the-execution-of-the-smart-contract-with-failwith"></a>Stopping the execution of the smart contract with <code>FAILWITH</code><a class="hash-link" href="#stopping-the-execution-of-the-smart-contract-with-failwith" title="Direct link to heading">#</a></h4><p>The <code>FAILWITH</code> instruction aborts the execution of the Michelson script which implies the cancellation of all storage modifications and other smart contract invocations.</p><p>The <code>FAILWITH</code> instruction consumes the top element of the stack as arguments (usually a string message). The consumed element must be a push-able type. It is allowed to stop the execution of a Michelson script without a message by pushing a <code>UNIT</code> value on top of the stack.</p><p>The <code>FAIL</code> keyword has been provided as a replacement for <code>UNIT; FAILWITH</code>.</p><p>Actually, the <code>FAIL</code> keyword is not an instruction but a syntactic sugar.</p><p>A <code>FAILWITH</code> instruction provides a way to reject a transaction by stopping the execution of related instructions.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="optional"></a>Optional<a class="hash-link" href="#optional" title="Direct link to heading">#</a></h4><p>An optional value is a data structure that can hold a value (of a given type) which can be not assigned yet. The optional value has two states: it is defined as <code>NONE</code> if no value is assigned and can be defined as <code>SOME</code> if a value has been assigned.</p><p>When defining an optional value, the type of value must be specified (e.g. <code>option int</code>).</p><p>The <code>IF_SOME</code> instruction allows to check and retrieve the value if it has been assigned.</p><p>The <code>SOME</code> instruction packs a value as an optional value (i.e. allows to create an <em>option</em> type with an assigned value).</p><p>The <code>NONE</code> instruction specifies the absence of value. It requires that the type of value that can be held be specified.</p><p>This <em>option</em> type is very useful for all process that may fail such as:</p><ul><li>Euclidean division (division by zero) </li><li>slicing a string (out of bound error)</li><li>accessing an element in a collection (non-existence of the element)</li><li>invoking an other contract (entrypoint name and type verification)</li></ul><p>Rather than causing an error, the examples above make use of optional values to specify a special case to handle.</p><p>A Michelson smart contract is expected to explicitly handle all possible cases; especially the case where the process produces an option with no value.</p><p>All these cases will be detailed in their respective sections.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-optional"></a>Using optional<a class="hash-link" href="#using-optional" title="Direct link to heading">#</a></h5><p>The <code>IF_NONE bt bf</code> instruction inspects an optional value.
It requires two sequences of instructions, like with an <code>IF</code> instruction.
It executes the first sequence if the optional value has no value assigned, otherwise it executes the second sequence of instructions (where a value has been assigned with a <code>SOME</code> instruction).</p><p>If the <code>IF_NONE</code> instruction encounters a NONE value it consumes it and then start executing the first sequence.<br>
If the <code>IF_NONE</code> instruction encounters a SOME value it does not consumes it and then starts executing the second sequence.</p><p><img src="/assets/images/michelson_instruction_ifnone_none_example-f162286deb209c962f0b4220843d3f51.svg"></p><small class="figure">FIGURE 15: Illustration of the `IF_NONE` instruction</small><p><img src="/assets/images/michelson_instruction_ifnone_some_example-1583eb394f815c74940d8c5a832517d3.svg"></p><small class="figure">FIGURE 16: Illustration of the `IF_NONE` instruction</small><p>Michelson also introduces the <code>IF_SOME bt bf</code> instruction which retrieves the value behind an optional and executes the first sequence if it encounters a SOME value. It executes the second sequence if it encounters a NONE value.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pair"></a>PAIR<a class="hash-link" href="#pair" title="Direct link to heading">#</a></h4><p>The Michelson language introduces the <em>pair</em> type which defines a data structure containing multiple fields. </p><p>A <em>pair</em> type is a tuple of 2 elements.</p><p>A  <em>pair</em> type can contain values of any type, from primitive types (<code>nat</code>, <code>string</code>, <code>int</code>) to advanced composite types such as <code>list</code>, <code>map</code>, <code>set</code>, <code>lambda</code> function or <code>union</code>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-and-destructuring-pairs"></a>creating and destructuring pairs<a class="hash-link" href="#creating-and-destructuring-pairs" title="Direct link to heading">#</a></h5><p>The <code>PAIR</code> instruction takes the top two elements of the stack and pushes back on top of the stack a pair containing these two elements.</p><p>The <code>UNPAIR</code> instruction takes the top element of the stack and ensures it is a <em>pair</em> type. It pushes back on top of the stack the two elements of the <em>pair</em>.</p><p><img src="/assets/images/michelson_tutorial_pair_unpair-b8ac457ee44c1cfc5337c0024fd26287.svg"></p><small class="figure">FIGURE 18: Illustration of the _PAIR_ and _UNPAIR_ instructions</small><p>Notice that the <code>UNPAIR</code> instruction expects a <em>pair</em> element on top of the stack. </p><p>Similarly, the <code>PAIR</code> instruction expects two elements in the stack. </p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="accessing-to-elements-of-a-pair"></a>Accessing to elements of a <em>PAIR</em><a class="hash-link" href="#accessing-to-elements-of-a-pair" title="Direct link to heading">#</a></h5><p>The <code>CAR</code> instruction consumes the top element of the stack (which must be a <code>PAIR</code>) and pushes back on the top of the stack the left part of the pair.</p><p><img src="/assets/images/michelson_instruction_car_example-5aab635921f5fc0da71b5dd5ad5b72b9.svg"></p><small class="figure">FIGURE 19: Illustration of the `CAR` instruction</small><p>The <code>CDR</code> instruction consumes the top element of the stack (which must be a <code>PAIR</code>) and pushes back on top of the stack the right part of the pair.</p><p><img src="/assets/images/michelson_instruction_cdr_example-b3a0b33e8bb879111b621a676e0c1bca.svg"></p><small class="figure">FIGURE 20: Illustration of the `CDR` instruction</small><p>These <code>CDR</code> and <code>CAR</code> instructions are useful to retrieve a part of a <em>PAIR</em>. As seen in the &quot;Smart contract&quot; section, when invoking a smart contract, the initial stack is defined by a <em>PAIR</em> containing the parameter of the invoked entrypoint and the current storage value.</p><p>Now that we introduced basic instructions (like <code>CDR</code> and <code>PAIR</code>) we can explain the empty contract seen in the &quot;Smart contract&quot; section.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter unit</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage unit</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="/assets/images/michelson_smartcontract_basics-1e6ca476f5a13cceedbda97b25b68ce8.svg"></p><small class="figure">FIGURE 21: Execution of `CDR ; NIL operation ; PAIR`</small><p>Notice that the <code>CDR</code> instruction retrieves the right part of the initial <em>PAIR</em>. The <code>NIL operation</code> pushed an empty list of operations on top of the stack. The <em>PAIR</em> instructions forms a <em>pair</em> type with the empty list of operations and the initial storage.</p><p>The next section will explain the list operators (<code>NIL operation</code>).</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="nested-pairs"></a>Nested pairs<a class="hash-link" href="#nested-pairs" title="Direct link to heading">#</a></h5><p>Michelson language doesn&#x27;t directly support tuples of more than 2 elements, but we can instead create <strong>nested pairs</strong>. For example, the following nested <em>pair</em> <code>PAIR (PAIR nat 5, string &quot;Hello&quot;) int 37</code> contains a natural integer 5, a string &quot;Hello&quot; and an integer 37.</p><p><img src="/assets/images/michelson_tutorial_pair-7ad6a4f5a698df7d1539a23c368824b4.svg"></p><small class="figure">FIGURE 17: Illustration of the C[AD]+R macro</small><p>The creation of a <em>nested pair</em> consists of a succession of <code>PAIR</code> instructions (which reorganizes elements in the stack). This may become a fastidious exercise with large <em>nested pairs</em>. The Michelson language supports these nested pairs by providing the <code>PAPPAIIR</code> macros for creating <em>nested pair</em> in a single instruction.</p><p>Similarly, the Michelson language provides the <code>UNPAPPAIIR</code> macro for destructuring <em>nested pairs</em>.</p><p>Similarly, the Michelson language provides the <code>C[AD]+R</code> macro for accessing a specific field inside a <em>nested pair</em>. For example, the <code>CAAR</code> macro stands for <code>{ CAR; CAR }</code> and <code>CADAR</code> macro stands for <code>{ CAR; CDR; CAR }</code>.</p><p><img src="/assets/images/michelson_macro_C[AD]+R_example-406d9ded47e46d42e62de8fc60e22d18.svg"></p><small class="figure">FIGURE 22: Illustration of the C[AD]+R macro</small><p>These macros are described in the &quot;Instructions&quot; section (in the &quot;macros&quot; sub-section).</p><p>Here is an example of a smart contract that stores a natural integer in its storage and receives a nested pair (containing a <em>nat</em> , a <em>string</em> and an <em>int</em>) as the parameter. It only takes the nat part of the nested pair and adds it to the storage.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter (pair (pair (nat) (string)) (int));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage nat;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { UNPAIR;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       CAAR;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       ADD;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that the <code>UNPAIR</code> separates the entry point and the storage.</p><p>Notice that the <code>CAAR</code> extracts a single field from the <em>nested pair</em>. The <code>CAAR</code> macro only retrieves the <em>nat</em> field of the parameter; it is equivalent to <code>{ CAR; CAR }</code>.</p><p>This smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_caar.tz on storage &#x27;9&#x27; and input &#x27;Pair (Pair 2 &quot;toto&quot;) -23&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that defining a Michelson expression containing a <em>pair</em> in CLI expects a <code>Pair</code> keyword (which is different from <em>pair</em> type or <code>PAIR</code> instruction).</p><div class="root_2W3B"><p>Annotation usage is recommended when creating complex types and nested _pairs_ (see [Annotation](/michelson/instructions-reference#annotation) section)</p></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="numbers"></a>Numbers<a class="hash-link" href="#numbers" title="Direct link to heading">#</a></h4><p>Now let&#x27;s focus on primitive types such as numbers.</p><p>There are two number types in Michelson. The <em>nat</em> type represents natural integers and the <em>int</em> type represents integers.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="standard-arithmetic-operations"></a>Standard arithmetic operations<a class="hash-link" href="#standard-arithmetic-operations" title="Direct link to heading">#</a></h5><p>Standard arithmetic operations are supported by the Michelson language on <em>nat</em> and <em>int</em> types.</p><p>The <code>ADD</code> instruction computes additions on <em>nat</em> and <em>int</em>. It consumes the top two elements of the stack and pushes back the addition of the two elements on top of the stack.</p><p><img src="/assets/images/michelson_instruction_add_example-938944ba9bd680b6fc511043a9f61fdd.svg"></p><small class="figure">FIGURE 23: Illustration of the `ADD` instruction</small><p>The <code>SUB</code> instruction computes subtractions on <em>nat</em> and <em>int</em>. It consumes the top two elements of the stack and pushes back the difference of the two elements on top of the stack.</p><p>Notice that the subtraction of two natural integers (or of a natural integer and an integer) produces an integer (since the expression <code>2 - 4</code> produces a number smaller than 0).</p><p><img src="/assets/images/michelson_instruction_sub_example-4a0e1da09f0dd54089302c43f8dc4f13.svg"></p><small class="figure">FIGURE 24: Illustration of the `SUB` instruction</small><p>The <code>MUL</code> instruction computes multiplications on <em>nat</em> and <em>int</em>. It consumes the top two elements of the stack and pushes back the product of these two elements on top of the stack.</p><p>Notice that the multiplication of a natural integer and an integer produces an integer.</p><p><img src="/assets/images/michelson_instruction_mul_example-427e0664e857a85a48e31282eb8daefa.svg"></p><small class="figure">FIGURE 25: Illustration of the `MUL` instruction</small><p>The <code>EDIV</code> instruction computes Euclidean divisions on <em>nat</em>. The Euclidean division computes the quotient and the remainder between two numbers.</p><p>If the divisor is equal to zero, it returns an <em>option</em> type with the assigned value <em>None</em>. Otherwise, it applies the Euclidean division and returns an <em>option</em> type containing the result (i.e. a <em>pair</em> composed with the quotient and the remainder). </p><p><img src="/assets/images/michelson_instruction_ediv_example-affff443b53a6bd499435337c1ed0b6a.svg"></p><small class="figure">FIGURE 26: Illustration of the `EDIV` instruction</small><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conversions-int---nat"></a>Conversions <code>int</code> &lt;-&gt; <code>nat</code><a class="hash-link" href="#conversions-int---nat" title="Direct link to heading">#</a></h5><p>The Michelson language also provides instructions to cast an integer into a natural integer with the <code>ABS</code> instruction. Respectively the <code>INT</code> instruction casts a natural integer into an integer.</p><p>The <code>ABS</code> instruction consumes an integer on top of the stack and pushes back the absolute value of this integer as a <em>nat</em> value. </p><p><img src="/assets/images/michelson_instruction_abs_example-e134936de8f561edb77aa7e5d3ec86df.svg"></p><small class="figure">FIGURE 27: Illustration of the `ABS` instruction</small><p>The following smart contract illustrates the <code>ABS</code> usage. It receives an integer as an input parameter, computes the absolute value and adds it to the storage.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter int;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage nat;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { UNPAIR;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       ABS;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       ADD;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_abs.tz on storage &#x27;9&#x27; and input &#x27;-2&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The resulting storage has a value of 11.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="string"></a>String<a class="hash-link" href="#string" title="Direct link to heading">#</a></h4><p>The <code>string</code> type represents a sequence of characters and a <em>string</em> value is composed of a sequence of ASCII printable characters (accents are not included).</p><p>A <em>string</em> value can be split and two <em>string</em> values can be concatenated or linked together. A <em>string</em> can be compared to an other <em>string</em>.</p><p>Like for numbers, a <em>string</em> can be pushed on top of the stack with the <code>PUSH</code> instruction.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> string </span><span class="token string">&quot;Hello World&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>SIZE</code> instruction consumes a string of the top of the stack and pushes the number of characters contained in the string element.</p><p>The <code>CONCAT</code> instruction concatenates strings. It consumes the two top elements and produces a string (concatenation of the two top elements) that is placed on top of the stack. The <code>CONCAT</code> instruction also works with a list of strings. </p><p>For example, the following smart contract concatenates a given string at the end of the storage.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter string;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage string;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { UNPAIR ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       SWAP ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       CONCAT;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_string_example.tz on storage &#x27;&quot;one&quot;&#x27; and input &#x27;&quot;two&quot;&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>SLICE</code> instruction provides a way to retrieve a part of a string.
It requires these three elements at the top of the stack and in this order:</p><ul><li>an <code>offset</code> argument indicating the beginning of the substring </li><li>a <code>length</code> argument indicating the size of the substring</li><li>a <code>string</code> to slice</li></ul><p>It returns an optional string because the given offset may be out of bound. </p><p><img src="/assets/images/michelson_instruction_slice_example-e6cd513819ba4cc66ee7f3f0687ae904.svg"></p><small class="figure">FIGURE 28: Illustration of the `SLICE` instruction</small><p>For example, the following smart contract retrieves the first 5 characters of a given string and store them in the storage.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter string;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage string;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { CAR;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PUSH nat 5;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PUSH nat 0;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       SLICE;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       IF_SOME {} { FAIL };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_string_example2.tz on storage &#x27;&quot;&quot;&#x27; and input &#x27;&quot;Hello World&quot;&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>COMPARE</code> instruction allows two strings to be compared. It consumes the top two elements of the stack and pushes an integer to the top. If the first element is lexically greater than the second, then it returns 1. If the first element is lexically equal to the second element, then it returns 0. If the first element is lexically smaller than the second element, then it returns -1.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="boolean-logic"></a>Boolean logic<a class="hash-link" href="#boolean-logic" title="Direct link to heading">#</a></h4><p>Like most languages, the Michelson language supports boolean logic with a <em>bool</em> type and standard boolean operators <code>OR</code> <code>AND</code> <code>XOR</code> <code>NOT</code>.</p><p>These boolean operators are useful mixed with <code>IF</code> instruction for creating complex conditions.</p><p>The <code>OR</code> instruction consumes the top two boolean elements of the stack and pushes back on top of the stack a logical <em>OR</em> of both elements.</p><p><img src="/assets/images/michelson_instruction_or_example-8c499ecad23c5af1da00b089eead699f.svg"></p><small class="figure">FIGURE 29: Illustration of the `OR` instruction</small><p>The <code>AND</code> instruction consumes the top two boolean elements of the stack and computes a logical <em>AND</em> of the two elements.</p><p><img src="/assets/images/michelson_instruction_and_example-2fd12cc90ac9f9e196e32ebbde1b449f.svg"></p><small class="figure">FIGURE 30: Illustration of the `AND` instruction</small><p>The <code>XOR</code> instruction consumes the top two boolean elements of the stack and computes an exclusive logical <em>OR</em> of the two elements.</p><p><img src="/assets/images/michelson_instruction_xor_example-1462803c39d1fea62b796fa579ca0587.svg"></p><small class="figure">FIGURE 31: Illustration of the `XOR` instruction</small><p>The <code>NOT</code> instruction consumes a boolean top element of the stack and pushes the logical opposite of the given boolean. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="timestamp"></a>Timestamp<a class="hash-link" href="#timestamp" title="Direct link to heading">#</a></h4><p>The Michelson language supports the <code>timestamp</code> type. Like in most languages, a timestamp represents a number of seconds passed since the beginning of year 1970.
Timestamps can be used in a smart contract to authorize actions on a certain period of time.  </p><p>Timestamps can be obtained by the <code>NOW</code> operation, or retrieved from script parameters or globals.</p><p>The <code>NOW</code> instruction pushes on top of the stack the timestamp of the block whose validation triggered this execution. This timestamp does not change during the execution of the contract.</p><p>This small contract registers when it is invoked, by saving the <code>NOW</code> timestamp in the storage.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter unit;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage timestamp;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { DROP;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NOW;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>DROP</code> instruction empties the single data on the stack. The <code>NOW</code> instruction pushes on top of the stack the timestamp of the block. And finally, <code>NIL operation; PAIR</code> instructions encapsulate the returned timestamp (i.e. the new storage state) with an empty list of operations.</p><p>This second small contract registers when it is invoked, by storing in a list of timestamps the <code>NOW</code> timestamp of its transaction.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter unit;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage (list timestamp);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { CDR;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NOW;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       CONS;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>CDR</code> instruction retrieves the storage part. The <code>NOW</code> instruction pushes on top of the stack the timestamp of the block. And finally the <code>CONS</code> operator adds an element in a <em>list</em>.</p><p>This smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_timestamp.tz on storage &#x27;{ &quot;2021-04-01T12:43:31Z&quot; }&#x27; and input &#x27;Unit&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that the storage (i.e. a list of timestamps) is initialized with a <em>timestamp</em> value in string format <code>&quot;2021-04-01T12:43:31Z&quot;</code>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="standard-timestamp-operations"></a>Standard timestamp operations<a class="hash-link" href="#standard-timestamp-operations" title="Direct link to heading">#</a></h5><p>The <code>ADD</code> instruction increments a timestamp of the given number of seconds. The number of seconds must be expressed as an <code>int</code>.</p><p>The <code>SUB</code> instruction subtracts a number of seconds from a timestamp. It can also be used to subtract two timestamps and obtain an <em>int</em> that represents the difference as a number of seconds.</p><p>For example, this smart contract when invoked computes the delay between two timestamps, and keeps it in the storage.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter (pair timestamp timestamp);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage int;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { CAR;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       UNPAIR;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       SUB;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>CAR</code> instruction retrieves the parameter value. The <code>UNPAIR</code> instruction pushes on top of the stack the two given timestamps. And finally the <code>SUB</code> operator computes the difference between the two timestamps.</p><p>This smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_timestamp2.tz on storage &#x27;0&#x27; and input &#x27;Pair &quot;2021-04-01T12:43:31Z&quot; &quot;2021-04-01T12:42:31Z&quot;&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="comparing-timestamps"></a>Comparing timestamps<a class="hash-link" href="#comparing-timestamps" title="Direct link to heading">#</a></h5><p>The <code>COMPARE</code> computes timestamp comparison. It returns an integer, as with the <code>COMPARE</code> instruction for an integer.</p><p>It returns <code>1</code> if the first timestamp is bigger than the second timestamp, <code>0</code> if both timestamps are equal, and <code>-1</code> otherwise. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="bytes"></a>Bytes<a class="hash-link" href="#bytes" title="Direct link to heading">#</a></h4><p>Bytes are used for serializing data in order to check signatures and to compute hashes on them. They can also be used to incorporate data from the untyped outside world.</p><p>The Michelson language provides <em>bytes</em> supports with common operators like for <em>string</em> type. It also provides standard serialization and de-serialization. </p><p>A <em>bytes</em> values is composed by a sequence of hexadecimals prefixed by a <code>0x</code> (e.g. <code>0xa47ef2</code>).</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="serialization"></a>Serialization<a class="hash-link" href="#serialization" title="Direct link to heading">#</a></h5><p>The <code>PACK</code> instruction serializes any value of packable type to its optimized binary representation. All types are packable with the exception of <em>operation</em> and <em>big_map</em> types.
It consumes the top element of the stack and push back the corresponding <em>bytes</em> value on top of the stack.</p><p>The <code>UNPACK</code> instruction de-serializes a piece of data, if valid. It returns an <em>option</em> initialized to <em>None</em> if the de-serialization is invalid, or an <em>option</em> initialized to <em>Some</em> if valid.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="standard-operators"></a>Standard operators<a class="hash-link" href="#standard-operators" title="Direct link to heading">#</a></h5><p>The <code>CONCAT</code> instruction concatenates two byte sequences. It can also be applied to a list of byte sequences. It consumes a list of byte sequences and pushes the concatenation of all sequences (in the respective order). The <em>list</em> data structure will be explained later in this tutorial.</p><p>The <code>SIZE</code> instruction computes the size of a sequence of bytes. It consumes a byte sequence and pushes the number of bytes of the sequence.</p><p>The <code>SLICE</code> instruction provides a way to retrieve a part of a byte sequence.
It expects the following elements on top of the stack:</p><ul><li>an <code>offset</code>, indicating the beginning of the byte sequence </li><li>a <code>length</code>, indicating the size of the sub-sequence</li><li>a <code>byte sequence</code> to slice</li></ul><p>It returns an optional byte sequence because the given offset and length may be out of bound.</p><p>The following smart contract illustrates the slicing of bytes. It expects a <em>bytes</em> value as parameter and saves in the storage the first 3 bytes. Otherwise if the offset or length elements do not fit the given <em>bytes</em> value then it fails.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter bytes;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage bytes;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { CAR ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PUSH nat 3;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PUSH nat 1;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       SLICE ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       IF_NONE { FAIL } {};</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_bytes_slice.tz on storage &#x27;0x00&#x27; and input &#x27;0x12a47ef2&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This command would produce a new storage value <code>0xa47ef2</code>.</p><p>The following command will fail (out-of-bound access) due to a too short <em>bytes</em> value.  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_bytes_slice.tz on storage &#x27;0x00&#x27; and input &#x27;0x12a47e&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="comparing-bytes"></a>Comparing bytes<a class="hash-link" href="#comparing-bytes" title="Direct link to heading">#</a></h5><p>The <code>COMPARE</code> instruction computes a lexicographic comparison. As with other <code>COMPARE</code> instructions, it returns 1 if the first sequence is bigger than the second sequence, 0 if both byte sequences are equal, or -1 otherwise.</p><p>The following smart contract concatenates the given bytes with the ones in the storage only if the parameter value is 0x12. Otherwise it fails.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter bytes;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage bytes;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { UNPAIR;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       DUP;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PUSH bytes 0x12;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       COMPARE;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       EQ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       IF { CONCAT } { FAIL };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_bytes.tz on storage &#x27;0xa2&#x27; and input &#x27;0x12&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="working-with-complex-data-structures"></a>Working with complex data structures<a class="hash-link" href="#working-with-complex-data-structures" title="Direct link to heading">#</a></h3><p>Since the beginning we have used simple data structures such as primitive types (<em>int</em>, <em>nat</em>, <em>string</em>, <em>pair</em> and <em>option</em>) but more complex types can be designed. </p><p>The storage of the smart contract can store a single type which can combine composite types and <em>pairs</em> to create a complex data structure. Let&#x27;s take a deeper dive into composite data types.</p><p>A composite structure integrates many fields and can organize them in many ways. </p><p>There are 5 kinds of composite data structures: </p><ul><li><strong>ordered list</strong> of elements with type <em>list</em></li><li><strong>set</strong> of unique elements with type <em>set</em></li><li>an <strong>associative array</strong> (a collection of key-value pairs) implemented with the type <em>map</em></li><li>a <strong>union</strong> (i.e. an exclusive composite type) implemented with nested <em>or</em> structure.</li><li>an <strong>optional</strong> implements a type holding a value which handles an uninitialized state if a value hasn&#x27;t been assigned.  (seen in the previous section)</li><li><strong>records</strong> containing multiple fields implemented with nested <em>PAIR</em> structure (seen in the previous section). Notice that <em>records</em> is not a reserved word of the language but just symbolizes the concept represented by nested pairs.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="list"></a>LIST<a class="hash-link" href="#list" title="Direct link to heading">#</a></h4><p>The <code>list</code> type represents an ordered collection of elements of the same type. A <em>list</em> can contain multiple occurrences of the same value. For example, here is a list of integers <code>{ 2; 4; 5; 3; 5 }</code>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="building-a-list"></a>Building a list<a class="hash-link" href="#building-a-list" title="Direct link to heading">#</a></h5><p>The <code>NIL</code> instruction pushes an empty list on the top of the stack. When creating a <em>list</em> the type of list elements must be specified. For example, <code>NIL operation</code> pushes an empty list of operations on the top of the stack. Similarly <code>NIL int</code> pushes an empty list of integers on top of the stack.</p><p><img src="/assets/images/michelson_instruction_nillist_example-e14ad579e2909d07424acb3297cef796.svg"></p><small class="figure">FIGURE 32: Illustration of the `NIL` instruction</small><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="adding-an-element-in-the-list"></a>Adding an element in the list<a class="hash-link" href="#adding-an-element-in-the-list" title="Direct link to heading">#</a></h5><p>The <code>CONS</code> instruction allows you to add an element at the beginning of a list. It expects an element and a list on top of the stack, consumes them and pushes back the updated <em>list</em> on top of the stack.</p><p><img src="/assets/images/michelson_instruction_cons_example-72004d345be8eef54baf5d4a6ee62904.svg"></p><small class="figure">FIGURE 33: Illustration of the `CONS` instruction</small><p>To illustrate the <em>list</em> type usage take a look at the following smart contract.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter int ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage (list int);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { UNPAIR ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       CONS;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The unique entry point of smart contract expects an integer as input (<code>parameter int</code>).
Notice that the storage of this smart contract is defined as a list of integers declared with <code>(list int)</code>.
This smart contract concatenates the given integer at the beginning of the integer list and returns the updated list as the new state of the storage.</p><p>This smart contract can be simulated by running the following CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script max_list.tz on storage &#x27;{1;2;5;3}&#x27; and input &#x27;12&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that in the CLI command the integer list is specified by <code>{1;2;5;3}</code>. </p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="removing-the-top-element-of-the-list"></a>Removing the top element of the list<a class="hash-link" href="#removing-the-top-element-of-the-list" title="Direct link to heading">#</a></h5><p>The <code>IF_CONS bt bf</code> instruction inspects a list. It requires two sequences of instructions (bt anf bf), as with the <code>IF</code> instruction.</p><p>This instruction removes the first element of the list, pushes it on top of the stack and executes the first sequence of instructions (<code>bt</code>). If the list is empty, then the second list of instructions is executed (<code>bf</code>).</p><p>This <code>IF_CONS</code> instruction allows you to inspect the first element of the list (and verifies the list is not empty). It also allows to relocate elements of a list or to filter elements of a list. </p><p>As illustration purpose, the following smart contract stores a list of integer. When invoked, the smart contract modifies the storage by multiplying by 2 the first element of the list (and if the list is empty then it add element <code>1</code> in the list. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter unit ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage (list int);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { CDR ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       IF_CONS { PUSH int 2; MUL; CONS } { NIL int; PUSH int 1; CONS };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that the entry point expects a value of type <code>unit</code> (i.e. no value expected).</p><p>The smart contract can be simulated with the following CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_ifcons3.tz on storage &#x27;{1;2;5;3}&#x27; and input &#x27;Unit&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>and</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_ifcons3.tz on storage &#x27;{}&#x27; and input &#x27;Unit&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that the given parameter value is <code>Unit</code> of type <code>unit</code>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-list-map-iter-size"></a>Using list (MAP, ITER, SIZE)<a class="hash-link" href="#using-list-map-iter-size" title="Direct link to heading">#</a></h5><p>Other list operators are available to apply a process on a list.</p><p>The <code>SIZE</code> instruction computes the number of elements in the list.
It consumes a list on the top of the stack and pushes the number of elements of the list back on top of the stack.</p><p>The <code>MAP {}</code> instruction updates a <em>list</em> data structure by applying a sequence of instructions to each element of the list. It takes a <em>list</em> element on top of the stack, applies the given sequence of instruction for each element and in the end, it produces a new list on top of the stack. </p><p>The given sequence of instructions (i.e. called &quot;body&quot;) has access to the stack, thus complex algorithms can be implemented. </p><p>The following smart contract illustrates the <code>MAP</code> usage. This smart contract holds a list of integer in its storage and when invoked it increments each integer of the list by 1.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter unit ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage (list int);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { CDR ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       MAP { PUSH int 1; ADD };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This smart contract can be simulated with the following CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_list_map.tz on storage &#x27;{1;2;5;3}&#x27; and input &#x27;Unit&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>ITER {}</code> instruction iterates on all elements of a <em>list</em> and applies a sequence of instructions to each element. The <code>ITER</code> instruction requires a sequence of instructions (called &quot;body&quot;) that has access to the stack.</p><p>For example, the following smart contract computes the sum of a list of integers (given as parameter). The resulting sum is stored in the storage.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter (list int);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage int;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { CAR ; DIP { PUSH int 0 };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       ITER { ADD };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that <code>DIP { PUSH int 0 }</code> instruction pushes the value <code>0</code> on the second element of the stack. It represents the initial value of resulting sum (before the computation).</p><p>The <code>ITER { ADD }</code> instruction sums the current element of the list with the resulting sum. At the end of the loop, the list of integer has been folded into a single integer representing the sum of all integers of the given list.</p><p>This smart contract can be simulated with the following CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_list_sum.tz on storage &#x27;999&#x27; and input &#x27;{2;1;3;6;1;5;2}&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>An other example is described in the <em>Examples</em> section (Example 2), about the computation of the maximum of a list.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="set"></a>SET<a class="hash-link" href="#set" title="Direct link to heading">#</a></h4><p>The <code>set</code> type represents an unordered collection of elements. It preserves the uniqueness of elements inside the collection. For example, here is a set of integers <code>{ 2; 4; 5 }</code>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creation-and-uniqueness-checking"></a>Creation and uniqueness checking<a class="hash-link" href="#creation-and-uniqueness-checking" title="Direct link to heading">#</a></h5><p>The <code>EMPTY_SET &#x27;elt</code> instruction builds a new empty set for elements of a given type &#x27;elt. The &#x27;elt type must be a comparable type (i.e. the COMPARE primitive must be defined over it).</p><p>The <code>MEM</code> instruction checks for the existence of an element in a set. It consumes an element and a set and pushes back a boolean on top of the stack which represents the existence of the element in the <code>set</code>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="modify-elements-of-the-set"></a>Modify elements of the set<a class="hash-link" href="#modify-elements-of-the-set" title="Direct link to heading">#</a></h5><p>The <code>UPDATE</code> instruction allows to add an element in a <code>set</code> or to remove an element from a set.</p><p>It takes the top three elements of the stack:</p><ul><li>an element whose type corresponds to the <em>set</em> type</li><li>a boolean representing the existence of this element in the <em>set</em></li><li>a set to update</li></ul><p>If the boolean argument is <em>False</em> then the element will be removed.</p><p><img src="/assets/images/michelson_instruction_updatesetremove_example-4c3a938c8048ccc2eb3839835a6a770d.svg"></p><small class="figure">FIGURE 34: Illustration of the `UPDATE` instruction</small><p>If the boolean argument is <em>True</em> then the element will be inserted.</p><p><img src="/assets/images/michelson_instruction_updatesetinsert_example-fb43a4f5d1e08e0d3c9bee5d40e1e89e.svg"></p><small class="figure">FIGURE 35: Illustration of the `UPDATE` instruction</small><p>An attempt to add a value which already exists in the set will let the <em>set</em> unchanged. Similarly an attempt to remove a value which does not exist in the set will let the <em>set</em> unchanged.</p><p>The following smart contract illustrates the <code>UPDATE</code> instruction usage. This smart contract stores a set of integers and can be invoked by specifying an integer that will be inserted in the set.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">set</span><span class="token plain"> int</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> bool </span><span class="token maybe-class-name">True</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You can test the smart contract with the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain">client run script set_example</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">tz</span><span class="token plain"> on storage </span><span class="token string">&#x27;{1; 2; 3; 9}&#x27;</span><span class="token plain"> and input </span><span class="token string">&#x27;7&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The following diagram illustrates the execution of this command</p><p><img src="/assets/images/michelson_instruction_set_insert-266978af556dfd5a0c894c1a4186b61e.svg"></p><small class="figure">FIGURE 36: Illustration of the `UPDATE` instruction on a _set_ type</small><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="apply-process-on-a-set"></a>Apply process on a set<a class="hash-link" href="#apply-process-on-a-set" title="Direct link to heading">#</a></h5><p>The <code>ITER</code> instruction iterates on all elements of a <em>set</em> and applies a sequence of instructions to each element. The <code>ITER</code> instruction requires a sequence of instructions (called &quot;body&quot;) that has access to the stack.</p><p>The <code>ITER</code> usage on <code>set</code> is similar to its usage on <code>list</code>.</p><p>The <code>SIZE</code> instruction consumes a set from the top of the stack and pushes to the top the number of elements contained in the set.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="map"></a>MAP<a class="hash-link" href="#map" title="Direct link to heading">#</a></h4><p>A <code>map</code> is an associative array. It stores many pairs of key-value elements, i.e. it binds a key and a value. Type definitions of key and value must be defined when instantiating a new <code>map</code>.</p><p>The <code>map</code> data structure can only contain a limited amount of data. Another associative array called <code>big_map</code> is introduced in the Michelson language to optimize the storage of large amount of data. </p><p>These big_maps should be used if you intend to store large amounts of data in a map. Using big_maps can reduce gas costs significantly compared to standard maps, as as data is lazily deserialized. </p><p>The behavior of <code>GET</code>, <code>UPDATE</code> and <code>MEM</code> instructions is the same on big_maps as on standard maps. Note however that single operations on big_maps have higher gas costs than those over standard maps (because, under the hood, they have to load and deserialize data on demand). </p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="building-a-map"></a>Building a map<a class="hash-link" href="#building-a-map" title="Direct link to heading">#</a></h5><p>The <code>EMPTY_MAP &#x27;key &#x27;val</code> instruction builds a new empty map. It requires the type definition of the key (<em>&#x27;key</em>) and types definition of the value (<em>&#x27;val</em>).</p><p>The <em>&#x27;key</em> type must be comparable (the COMPARE primitive must be defined over it).</p><p>For example, this smart contract always returns an empty <em>map</em> (typed map string int) and an empty list of <em>operations</em>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter unit;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage (map string int);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { DROP;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       EMPTY_MAP string int;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This script can be simulated with the following command line:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_empty_map.tz on storage &#x27;{ Elt &quot;toto&quot; 1 }&#x27; and input &#x27;Unit&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that:</p><ul><li><p>The <code>EMPTY_BIG_MAP</code> instruction builds a new empty <code>big_map</code> data structure.</p></li><li><p>The Michelson syntax for defining a non-empty <em>map</em> value is:</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">{ Elt &lt;key1&gt; &lt;value1&gt;; Elt &lt;key2&gt; &lt;value2&gt; }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="checking-existence-of-a-binding-for-the-key"></a>Checking existence of a binding for the key<a class="hash-link" href="#checking-existence-of-a-binding-for-the-key" title="Direct link to heading">#</a></h5><p>The <code>MEM</code> instruction checks for the existence of a binding for a key in a map.</p><p>It expects a key and a map on top of the stack and pushes back a boolean on top of the stack which represents the existence of the element in the <code>map</code>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="modifying-a-map"></a>Modifying a map<a class="hash-link" href="#modifying-a-map" title="Direct link to heading">#</a></h5><p>The <code>UPDATE</code> instruction adds, removes or updates an element in a map.</p><p>The <code>UPDATE</code> instruction expects a key, an optional value and a map on top of the stack. It consumes the key and the optional value and modifies the map accordingly.</p><p>If the optional value is defined as <code>None</code>, then the element is removed from the map.
If the optional value is defined as <code>Some</code> value, then the element corresponding to the given key is updated with the given value.  </p><p> The following smart contract (map_remove_example.tz) illustrates the <code>UPDATE</code> usage while removing an element from the map.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter string </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">map string int</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NONE</span><span class="token plain"> int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This smart contract can be tested with the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain">client run script map_remove_example</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">tz</span><span class="token plain"> on storage </span><span class="token string">&#x27;{ Elt &quot;toto&quot; 1 }&#x27;</span><span class="token plain"> and input </span><span class="token string">&#x27;&quot;toto&quot;&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="/assets/images/michelson_instruction_mapremove_example-c398367edc01b4738fcfe4898af9fb64.svg"></p><small class="figure">FIGURE 37: Illustration of the `UPDATE` instruction</small><p>If the optional value is defined as <code>Some</code> then the element is inserted into the map. The following smart contract (map_insert_example.tz) illustrates the <code>UPDATE</code> usage while inserting an element into the map.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter string </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">map string int</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">SOME</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This smart contract can be tested with the following command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain">client run script map_insert_example</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">tz</span><span class="token plain"> on storage </span><span class="token string">&#x27;{ Elt &quot;toto&quot; 1 }&#x27;</span><span class="token plain"> and input </span><span class="token string">&#x27;&quot;tutu&quot;&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="/assets/images/michelson_instruction_mapinsert_example-bf78e54704a2a5bf367f5cbba30d23bf.svg"></p><small class="figure">FIGURE 38: Illustration of the `UPDATE` instruction</small><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="accessing-element-of-a-map"></a>Accessing element of a map<a class="hash-link" href="#accessing-element-of-a-map" title="Direct link to heading">#</a></h4><p>The <code>GET</code> instruction allows access to an element inside a map. It returns an optional value to be checked with an <code>IF_SOME</code> instruction.</p><p>The following smart contract illustrates the usage of <code>GET</code>. The storage of this contract defines a map. This smart contract takes a key as the parameter and inserts a new element in the map if the key does not exist. In this case, it assigns the value 0 to the given key. Or if the map possesses an element for the given key then it increments its associated value.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter string </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">map string int</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">GET</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">IF_NONE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SOME</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SOME</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This smart contract can be simulated with the following commands:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain">client run script map_example</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">tz</span><span class="token plain"> on storage </span><span class="token string">&#x27;{}&#x27;</span><span class="token plain"> and input </span><span class="token string">&#x27;&quot;toto&quot;&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain">client run script map_example</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">tz</span><span class="token plain"> on storage </span><span class="token string">&#x27;{ Elt &quot;toto&quot; 5 }&#x27;</span><span class="token plain"> and input </span><span class="token string">&#x27;&quot;toto&quot;&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that <code>{}</code> represents an empty map and <code>{ Elt &quot;toto&quot; 5 }</code> a map containing one element where &quot;toto&quot; is the key and its associated value is 5.</p><p>The following diagram illustrates the execution of this command.</p><p><img src="/assets/images/michelson_instruction_map_get-7a19c06895237f9916dcf81a32ba4518.svg"></p><small class="figure">FIGURE 39: Illustration of the `GET` and `UPDATE`  instructions</small><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="applying-some-process-on-a-map"></a>Applying some process on a map<a class="hash-link" href="#applying-some-process-on-a-map" title="Direct link to heading">#</a></h5><p>The <code>SIZE</code> instruction computes the number of elements inside a map. It consumes a map on top of the stack and places the number of elements on top of the stack.</p><p>The <code>SIZE</code> instruction cannot be applied to the <code>big_map</code> type. </p><p>The <code>MAP</code> instruction updates a <em>map</em> data structure by applying a sequence of instructions to each element of a <code>map</code>. It takes a sequence of instructions as its argument (called &quot;body&quot;) which has access to the stack.</p><p>The <code>MAP</code> instruction takes a <em>map</em> on top of the stack, applies the given sequence of instruction for each element and in the end, it produces a new <em>map</em> on top of the stack. </p><p>The following smart contract (map_map_example.tz) illustrates the <code>MAP</code> usage. This smart contract stores a <code>map string nat</code> and when invoked it goes through all key-value elements of the map and multiplies by 2 the <code>nat</code> value.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter unit </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">map string nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">MAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> nat </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">MUL</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The smart contract can be simulated with the following command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain">client run script map_map_example</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">tz</span><span class="token plain"> on storage </span><span class="token string">&#x27;{ Elt &quot;toto&quot; 1 ; Elt &quot;tutu&quot; 4 }&#x27;</span><span class="token plain"> and input </span><span class="token maybe-class-name">Unit</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="iterating-on-a-map"></a>Iterating on a map<a class="hash-link" href="#iterating-on-a-map" title="Direct link to heading">#</a></h5><p>The <code>ITER body</code> instruction iterates on all elements of a <em>map</em> and applies a sequence of instructions (called &quot;body&quot;) to each element. So, the &quot;body&quot; sequence expects an element of the stack (i.e. a <em>pair</em> key-value) on top of the stack. The &quot;body&quot; sequence has access to the underlying stack.</p><p>An example (&quot;Max list&quot;) illustrating <code>ITER</code> instruction usage is described in the <em>Examples</em> section. Despite being applied to a list of integers, the <code>ITER</code> instruction works in the same way with a map (except at each iteration a <em>pair</em> key-value is pushed on the stack instead of an integer, as in the example &quot;Max list&quot;).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="union"></a>Union<a class="hash-link" href="#union" title="Direct link to heading">#</a></h4><p>The <code>union</code> data structure specifies two possible type definitions with logical <em>or</em>. It can be used to create a new type that can handle two different types exclusively.</p><p>For example, the following Michelson expression defines the type &quot;int_or_nat&quot; as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">or int nat</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The logical <em>or</em> operator has 2 branches a left part and a right part. It is possible to form nested <em>or</em> structure in order to combine more than 2 types. For example, the type <code>string_or_int_or_nat</code> would be defined by </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">or (or (int) (nat)) (string)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><em>Unions</em> are often used to define the <strong>parameter</strong> of the smart contract. As said in previous sections, the smart contract accepts a single parameter. This <strong>parameter</strong> can be a <em>union</em> and thus offer multiple choices (i.e. multiple entry points).</p><p>For example, <code>parameter (or (or (nat %add) (nat %sub)) (unit %default))</code> defines the parameter of a smart contract as a union of three entry points (add, sub, default). Each entrypoint specifies the expected argument type (e.g. &quot;add&quot; entry point expects an integer).</p><p>Notice that when using a nested <em>or</em> structure for the parameter of the smart contract, each entry point requires an annotation (&quot;%add&quot;, &quot;%sub&quot;) which is not the case for regular <em>union</em> such as <code>string_or_int_or_nat</code>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="left--right"></a>LEFT &amp; RIGHT<a class="hash-link" href="#left--right" title="Direct link to heading">#</a></h5><p>When using <em>union</em> type it is necessary to respect the strict typing of the Michelson language.
For example, let&#x27;s consider the type <em>int_or_nat</em> defined as <code>or int nat</code>. A single integer value cannot be held in an <em>int_or_nat</em> type. It has to be &quot;cast&quot; in a logical <em>or</em> structure. The <code>LEFT</code> and <code>RIGHT</code> operators are provided by the Michelson language to form logical <em>or</em> structures based on a single value. Obviously, the type of the given value can be deduced but the other possible type of the <em>or</em> must be specified. </p><p>The <code>LEFT p</code> instruction takes the top-element of the stack and produces a <em>union</em>.
The top element is placed in the right branch of the <code>or</code> structure and the left branch is typed with the given <code>p</code> argument.</p><p>It consumes a type definition on top of the stack and pushes a union where the left part is defined as the consumed type definition.</p><p><img src="/assets/images/michelson_instruction_left-51e4943fe674856964ae1bea7fe26244.svg"></p><small class="figure">FIGURE 40: Illustration of the `LEFT` instruction</small><p>Usage of the <code>LEFT</code> instruction is illustrated in the example section.</p><p>The <code>RIGHT p</code> instruction takes the top-element of the stack and produces a <em>union</em>.
The top-element is placed in the left branch of the <code>or</code> structure and the right branch is typed with the given <code>p</code> argument.</p><p>It consumes a type definition on top of the stack and pushes a union where the right part is defined as the consumed type definition.</p><p><img src="/assets/images/michelson_instruction_right-2421961d73e6d0e3f6ed0f1f2c0ce30c.svg"></p><small class="figure">FIGURE 41: Illustration of the `RIGHT` instruction</small><p>Usage of the <code>RIGHT</code> instruction is illustrated in the example section.</p><p>Now that the creation of a <em>union</em> is described, let&#x27;s see how to inspect a <em>union</em>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="inspecting-a-union-with-if_left"></a>Inspecting a <em>union</em> with <code>IF_LEFT</code><a class="hash-link" href="#inspecting-a-union-with-if_left" title="Direct link to heading">#</a></h5><p>The <code>IF_LEFT</code> instruction inspects a value of <em>union</em>. It requires two sequences of instructions (bt bf), like with an <code>IF</code> instruction. </p><p>The <code>IF_LEFT bt bf</code> executes the &quot;bt&quot; sequence if the left part of a <em>union</em> has been given, otherwise it will execute the &quot;bf&quot; sequence.</p><p>The <code>IF_LEFT</code> instruction consumes a Michelson expression on top of the stack which specifies which part of the <em>union</em> has been defined and pushes on top of the stack the element underneath the <em>union</em>.</p><p>The following smart contract (union_example.tz) illustrates the <code>IF_LEFT</code> usage. Notice that the parameter is a <em>union</em> <code>(or string int)</code> and the storage is an integer. This smart contract increments the storage if an integer is passed as a parameter (i.e. if the smart contract is invoked with an integer) and does nothing if a string is given.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token function" style="color:rgb(111, 66, 193)">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">or string int</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">IF_LEFT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DROP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To illustrate the invocation of the smart contract, we will break down its execution.</p><p>The following command simulates the execution of the smart contract when called with an integer.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain">client run script union_example</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">tz</span><span class="token plain"> on storage </span><span class="token string">&#x27;5&#x27;</span><span class="token plain"> and input </span><span class="token string">&#x27;Right 1&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="/assets/images/michelson_instruction_ifleft_right_example-24b5d95ac17997958bdf0411855b54c0.svg"></p><small class="figure">FIGURE 42: Illustration of the `IF_LEFT` instruction</small><p>Notice that the <code>IF_LEFT</code> instruction consumes the <em>union</em> value <code>RIGHT int 1</code> and pushed back the element behind the <em>right</em> branch <code>int 1</code>, and finally selects the <code>{ ADD }</code> sequence.</p><p>The following command simulates the execution of the smart contract when called with a string.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain">client run script union_example</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">tz</span><span class="token plain"> on storage </span><span class="token string">&#x27;5&#x27;</span><span class="token plain"> and input </span><span class="token string">&#x27;Left &quot;Hello&quot;&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="/assets/images/michelson_instruction_ifleft_left_example-4be764b370901ac4c41804b7c62bee2f.svg"></p><small class="figure">FIGURE 43: Illustration of the `IF_LEFT` instruction</small><p>Notice that the <code>IF_LEFT</code> instruction consumes the <em>union</em> value <code>LEFT string &quot;Hello&quot;</code> and pushed back the element behind the <em>left</em> branch <code>string &quot;Hello&quot;</code>, and finally selects the <code>{ DROP }</code> sequence.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="contract-specific-types-and-operations"></a>Contract specific types and operations<a class="hash-link" href="#contract-specific-types-and-operations" title="Direct link to heading">#</a></h3><p>Now let&#x27;s focus on the specific types related to Tezos smart contract such as crypto-currency (mutez), address identifying an account or a contract, delegation.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mutez"></a>Mutez<a class="hash-link" href="#mutez" title="Direct link to heading">#</a></h4><p>Mutez (micro-Tez) are internally represented by a 64-bit, signed integer. </p><p>There are restrictions to prevent creating a negative amount of mutez. Operations are limited in order to prevent overflow and to avoid mixing with other numerical types by mistake. </p><p>Operations <code>ADD</code> and <code>MUL</code> must be checked for overflows (i.e. the <code>ADD</code> and <code>MUL</code> instructions will fail in case of overflow).</p><p>Operations <code>SUB</code> must be checked for underflow (i.e. the <code>SUB</code> instruction will fail if the result is negative).</p><p>So, keep in mind that taking under/overflows into account is mandatory while manipulating <em>mutez</em> type.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="standard-currency-operations"></a>Standard currency operations<a class="hash-link" href="#standard-currency-operations" title="Direct link to heading">#</a></h5><p>Standard operations on currency are supported by the Michelson language. These operators are more restricted than for integers.</p><p>The <code>ADD</code> instruction computes additions on mutez. It consumes two <em>mutez</em> elements on top of the stack and pushes back the addition of the two quantities on top of the stack.
This operation may fail in case of overflow.</p><p>The <code>SUB</code> instruction computes subtractions on mutez. It consumes two <em>mutez</em> elements on top of the stack and pushes back the difference of the two quantities on top of the stack.
A <em>mutez</em> value cannot be negative so this subtraction may fail if the first value is smaller than the second one.</p><p>The <code>MUL</code> instruction computes multiplications on mutez. It consumes a <em>mutez</em> and a <em>nat</em> elements on top of the stack and pushes back the product of the two quantities on top of the stack.
The multiplication allows mutez to be multiplied with natural integers.
Multiplication of 2 <code>mutez</code> operands is not allowed. </p><p>The <code>EDIV</code> instruction computes the Euclidean division on mutez. It consumes a <em>mutez</em> and a <em>nat</em> elements on top of the stack and pushes back a <code>pair</code> with the quotient and the reminder (of the two elements) on top of the stack.</p><p>The Euclidean division allows a mutez to be divided by a natural integer. It is also possible to divide 2 mutez, in this case, it returns a <em>pair</em> composed with a <code>nat</code> as a quotient and a mutez as the rest of the Euclidean division.</p><p>The <code>COMPARE</code> instruction compares two mutez and returns an integer on top of the stack. It returns 0 if both elements are equal, 1 if the first element is bigger than the second, and -1 otherwise. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="contract-communication"></a>Contract communication<a class="hash-link" href="#contract-communication" title="Direct link to heading">#</a></h4><p>This section describes instructions specific to smart contracts and interactions between contracts. It includes key features such as emitting transactions and invoking a contract, setting delegations, and even creating contracts on the fly. </p><p>This section introduces the <em>address</em> type identifying an account or a deployed smart contract; and other built-in instructions related to transactions.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="address-type"></a><code>address</code> type<a class="hash-link" href="#address-type" title="Direct link to heading">#</a></h5><p>The <em>address</em> type represents an identifier for a user account or a deployed smart contract (e.g. &quot;tz1n2Vm2dvjey...&quot;, &quot;KT1faswCTD...&quot; ).</p><p>For example, an <em>address</em> value can be pushed on top of the stack with the <code>PUSH</code> instruction (e.g. <code>PUSH address &quot;tz1n2Vm2dvjey...&quot;</code>).</p><p>The <em>address</em> type is a comparable type (i.e. <em>address</em> values can be compared between each other). Addresses of implicit accounts are considered strictly less than addresses of originated accounts. Addresses of the same type are compared lexicographically.</p><p>Built-ins macros such as SOURCE or SENDER push an <em>address</em> value on top of the stack. (see &quot;Built-ins&quot; section) </p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="entrypoint-verification-with-contract"></a>Entrypoint verification with <code>CONTRACT</code><a class="hash-link" href="#entrypoint-verification-with-contract" title="Direct link to heading">#</a></h5><p>Smart contract communicates among each other with transactions. When invoking a smart contract, the execution must insure that the invocation parameter matches the parameter of the targeted smart contract. For example, if a smart contract (possessing 2 entrypoints) can only &quot;Increment&quot; and &quot;Decrement&quot; one can not ask it to &quot;Multiply&quot;. In the same manner, the arguments of entrypoints must be respected.</p><p>All this verification is done based on entry point definition and expectation. The <code>CONTRACT</code> stands for this concept. Actually the <code>CONTRACT &#x27;p</code> instruction permits to specify what kind of entry points one expects to invoke (i.e. the type definition of invoked entrypoint).</p><p>The <code>CONTRACT &#x27;p</code> instruction casts the address to the given contract type if possible.
It consumes an <code>address</code> to the top element of the stack and returns a contract instance that corresponds to the given parameter type.
The element returned on top of the stack is typed <em>option contract</em> and its value represents a valid instance of contract at the given address.</p><p>The parameter is <code>unit</code> in case of an implicit account.</p><p>The <code>CONTRACT &#x27;p</code> instruction considers the default entrypoint if it exists, otherwise the full parameter is returned. </p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transaction-with-transfer_tokens"></a>Transaction with <code>TRANSFER_TOKENS</code><a class="hash-link" href="#transaction-with-transfer_tokens" title="Direct link to heading">#</a></h5><p>Communication between contracts (and accounts) are done via transactions. The Michelson language supports the creation of transactions.</p><p>The <code>TRANSFER_TOKENS</code> instruction forges a transaction. In Michelson, the <code>operation</code> type represents a transaction.
Forging a transaction requires the following to be specified: </p><ul><li>the <em>parameter</em> (i.e. the entrypoint expected by the targeted contract)</li><li>a <em>quantity of mutez</em> transferred by this transaction</li><li>a <em>recipient contract</em> representing the target of the transaction (i.e. to which contract this transaction will be sent)</li></ul><p>The parameter must be consistent with the one expected by the contract.
If the transaction is sent to an implicit account (i.e. the address of an account) then the parameter must be set to <code>unit</code>.</p><p>The <code>TRANSFER_TOKENS</code> instruction consumes the three top elements of the stack and outputs a transaction on top of the stack.</p><p>As seen in previous sections, the invocation of a Tezos smart contract produces a list of operations and a new storage state. In a smart contract, when using a <code>TRANSFER_TOKENS</code> instruction to forge a transaction the produced transaction must be included in the returned list of operations in order to be taken into account.</p><p>To illustrate the usage of the <code>TRANSFER_TOKENS</code> instruction, we will consider a simple &quot;Counter&quot; smart contract that can increment or decrement a value. We will create a second smart contract, &quot;CounterCaller&quot;, which forges a transaction and sends it to the &quot;Counter&quot; smart contract using the <code>TRANSFER_TOKENS</code> instruction.</p><p>The following smart contract demonstrates the implementation of the &quot;Counter&quot; smart contract.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token function" style="color:rgb(111, 66, 193)">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">int </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">decrement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">int </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">IF_LEFT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SUB</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The following smart contract demonstrates the implementation of the &quot;CounterCaller&quot; smart contract.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token function" style="color:rgb(111, 66, 193)">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">or int int</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage address</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">CONTRACT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">or int int</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">IF_NONE</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token constant" style="color:rgb(100, 102, 149)">DROP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                     </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                     </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                     </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> mutez </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                     </span><span class="token constant" style="color:rgb(100, 102, 149)">TRANSFER_TOKENS</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                     </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                     </span><span class="token constant" style="color:rgb(100, 102, 149)">CONS</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Now, let&#x27;s break down the execution of the &quot;CounterCaller&quot; smart contract:</p><p>The following command simulates the invocation of the smart contract.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain">client run script countercaller</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">tz</span><span class="token plain"> on storage </span><span class="token string">&#x27;&quot;KT1HUbVyf62ZAp7BRqwQaDueb6kgb7Q86cc3&quot;&#x27;</span><span class="token plain"> and input </span><span class="token string">&#x27;Left 3&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="/assets/images/michelson_example_transfertoken_execution-1e728baa011cb9db29a3da35c5063b08.svg"></p><small class="figure">FIGURE 44: Illustration of the `TRANSFER_TOKENS` instruction</small><p>Notice that the <code>CONTRACT (or int int)</code> instruction produces an optional instance of contract. This instance,once the optional is resolved, is typed <code>contract (or int int)</code> and its value contains the <code>address</code> of a valid deployed smart contract (<code>instance @&quot;KT..&quot;</code> in the schema).</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="delegation-with-set_delegate"></a>Delegation with <code>SET_DELEGATE</code><a class="hash-link" href="#delegation-with-set_delegate" title="Direct link to heading">#</a></h5><p>Delegation is when you delegate your staking/baking rights to another person (called ‚Äúbaker‚Äù), rather than setting your own Tezos node. It‚Äôs a quite useful feature as it allows you to participate in staking and receive Tezos staking rewards without the necessity of maintaining a node (see Chapter Baking).</p><p>The <code>SET_DELEGATE</code> sets or withdraws the contract&#x27;s delegation. It consumes an <em>option key_hash</em> specifying the delegate and returns a transaction (operation) on top of the stack.</p><p>Using this instruction is the only way to modify the delegation of a smart contract. If the top element is <em>None</em>, then the delegation of the current contract is withdrawn. If the top element is <em>Some kh</em>, where <em>kh</em> is the key hash of a registered delegate (that is not the current delegate of the contract), then this operation sets the delegate of the contract to this registered delegate. The operation fails if <em>kh</em> is the current delegate of the contract or if <em>kh</em> is not a registered delegate.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="inspecting-the-balance-of-the-contract"></a>Inspecting the balance of the contract<a class="hash-link" href="#inspecting-the-balance-of-the-contract" title="Direct link to heading">#</a></h5><p>The <code>BALANCE</code> instruction pushes the current amount of mutez held by the executing contract to the stack, including any mutez added by the calling transaction.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-contract-dynamically-with-create_contract"></a>Creating contract dynamically with <code>CREATE_CONTRACT</code><a class="hash-link" href="#creating-contract-dynamically-with-create_contract" title="Direct link to heading">#</a></h5><p>The <code>CREATE_CONTRACT</code> instruction forges a new contract. It consumes the top three elements of the stack and pushes back a <em>transaction</em> (responsible for creating the contract) and the <em>address</em> of the newly created contract.</p><p>The <code>CREATE_CONTRACT</code> instruction expects as an argument the smart contract definition as a literal <code>{ storage &#x27;g ; parameter &#x27;p ; code ... }</code>, including the storage definition, parameter definition and the code of the smart contract.</p><p>The <code>CREATE_CONTRACT</code> instruction expects three elements on top of the stack (these elements represent arguments for deploying a contract):</p><ul><li>the initial storage value for the new contract.</li><li>an optional <code>key_hash</code> value representing the delegate</li><li>a quantity of mutez transferred to the new contract</li></ul><p>Accessing the newly created contract (via a <code>CONTRACT &#x27;p</code> instruction) will fail until it is actually originated.</p><p>So as to illustrate the dynamic creation of contracts, let&#x27;s make a smart contract that creates the &quot;Counter&quot; contract seen previously in <code>TRANSFER_TOKENS</code>.</p><p>The implementation of the &quot;Counter&quot; smart contract is:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token function" style="color:rgb(111, 66, 193)">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">int </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">decrement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">int </span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token plain">increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">IF_LEFT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SUB</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Now let&#x27;s see the implementation of a &quot;Factory&quot; contract that creates and deploys a &quot;Counter&quot; contract.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter unit;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage unit;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { DROP;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PUSH int 9;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PUSH mutez 0;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NONE key_hash;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       CREATE_CONTRACT { parameter (or (int %decrement) (int %increment)) ; storage int ; code { DUP ; CDR ; SWAP ; CAR ; IF_LEFT { SWAP ; SUB } { ADD } ; NIL operation ; PAIR } };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       DIP { NIL operation };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       CONS;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       DIP { DROP; UNIT };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>DROP</code> instruction removes entrypoint and storage elements from the stack since they are not used.</p><p>The first expected element for <code>CREATE_CONTRACT</code> is the delegate of the smart contract. Here we specify there is none (<code>NONE key_hash;</code>). Notice that the <code>NONE</code> instruction must be typed.
The second expected element for <code>CREATE_CONTRACT</code> is the quantity of mutez transferred to the new contract. Here we specify 0 with <code>PUSH mutez 0;</code>.
The third expected element for <code>CREATE_CONTRACT</code> is the initial storage value for the new contract. Here the <code>PUSH int 9;</code> set the default counter value to 9.</p><p>The <code>CREATE_CONTRACT</code> instruction produces on top of the stack an <em>operation</em> and the <em>address</em> of the contract.
The <code>DIP { NIL operation }; CONS</code> sequence adds this operation into a list of operation (which will constitute the return of the smart contract).
The <code>DIP { DROP }</code> sequence deletes the address of the (because we don&#x27;t use it here).
The <code>UNIT</code> instruction specifies an empty storage as described in the storage definition (<code>storage unit;</code>)
The <code>PAIR</code> instruction forms the <em>pair</em> returned by the smart contract (including the list of operation and the storage).</p><p>This smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script factory.tz on storage &#x27;Unit&#x27; and input &#x27;Unit&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This CLI command produces the following output:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  Unit</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">emitted operations</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  Internal origination:</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    From: KT1BEqzn5Wx8uJrZNvuS9DVHmLvG9td3fDLi</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    Credit: Íú©0</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    Script:</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      { parameter (or (int %decrement) (int %increment)) ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        storage int ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        code { DUP ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">               CDR ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">               SWAP ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">               CAR ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">               IF_LEFT { SWAP ; SUB } { ADD } ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">               NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">               PAIR } }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      Initial storage: 9</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      No delegate for this contract</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="built-ins"></a>Built-ins<a class="hash-link" href="#built-ins" title="Direct link to heading">#</a></h5><p>The <code>ADDRESS</code> instruction casts the contract to its address. It consumes a contract on top of the stack and pushes back the address of the contract.</p><p>The <code>SELF</code> instruction pushes the default entry point of a contract on top of the stack. This default entry point specifies the expected parameter type.
The <code>SELF &#x27;p</code> instruction allows you to take a entry point name &#x27;p as argument. In this case, it pushed the specified entrypoint on top of the stack. </p><p>The <code>SOURCE</code> instruction pushes the address of the contract that initiated the current transaction, i.e. the contract that paid the fees and storage cost, and whose manager signed the operation that was sent on the blockchain. Note that since the TRANSFER_TOKENS instructions can be chained, <code>SOURCE</code> and <code>SENDER</code> are not necessarily the same.</p><p>The <code>SENDER</code> instruction pushes the address of the contract that initiated the current internal transaction. It may be the <code>SOURCE</code>, but may also be different if the source sent an order to an intermediate smart contract, which then called the current contract.</p><p>The <code>SOURCE</code> and <code>SENDER</code> built-ins represent the identity that invoked the smart contract. </p><p>To illustrates the <code>SENDER</code> macro, here is a smart contract handling a set of address as storage. When invoked this smart contract saves the identifier of the invoker (i.e. its <em>address</em>) inside the storage.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter unit;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage (set address);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { CDR;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       SENDER;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       DIP { PUSH bool True };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       UPDATE;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>CDR</code> extracts the storage value. The <code>SENDER</code> instruction push on top of the stack the address of the invoker. The <code>DIP { PUSH bool True }</code> pushes a True boolean value on the second position of the stack. Finally, the <code>UPDATE</code> consumes the 3 top elements (the address , the boolean and the set) and produces an updated <em>set</em> containing the sender address. </p><p>This smart contract can be simulated with CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_sender.tz on storage &#x27;{}&#x27; and input &#x27;Unit&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>An other useful built-in is the <code>AMOUNT</code> instruction which is key when currencies are being exchanged. The <code>AMOUNT</code> instruction pushes the amount of mutez of the current transaction on top of the stack.</p><p>The following smart contract illustrates the <code>AMOUNT</code> usage. When invoked it concatenates a given string to the string of the storage only if no money has been transferred with this transaction. In fact, it verifies that the <em>amount</em> is equal to zero.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter string;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage string;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code { AMOUNT;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PUSH mutez 0;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       COMPARE;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       EQ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       IF { UNPAIR; CONCAT } { FAIL };</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       NIL operation ;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       PAIR }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> The <code>AMOUNT</code> instruction pushes the amount of mutez of the current transaction on top of the stack. The <code>PUSH mutez 0; COMPARE; EQ</code> sequence verifies that the amount is equal to zero. If it is the case then the parameter string and the storage string are concatenated (with sequence<code>{ UNPAIR; CONCAT }</code>) otherwise the transaction stops with a <code>FAIL</code> instruction.</p><p>This contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tezos-client run script instruction_amount.tz on storage &#x27;&quot;Hello&quot;&#x27; and input &#x27;&quot;World&quot;&#x27; --amount 0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that the <code>tezos-client run script</code> command provides an optional argument <code>--amount 0</code> for specifying the amount of mutez sent with this transaction.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lambda-functions"></a>Lambda functions<a class="hash-link" href="#lambda-functions" title="Direct link to heading">#</a></h3><p>The Michelson language supports anonymous functions, also called <strong>lambda</strong>. Lambda functions are strongly typed and when called it executes a sequence of instructions.</p><p>Lambda functions are useful for factoring code, thus preventing code duplication. </p><p>An important limitation is that Lambda functions can&#x27;t manipulate the stack of the calling contract, but instead have their own stack.
Though, data can be passed as arguments to the lambda function.</p><p>Lambda functions can also be defined inside the storage. A smart contract would be able to apply on-demand the stored lambda; and would also be able to change the code of the lambda. BE CAREFUL! In this case, it means the smart contract is not immutable. This kind of design requires a strong administration layer (with multi-signature patterns); and proofs on those smart contracts might become irrelevant.</p><p>The <code>LAMBDA</code> instruction defines a lambda function and the <code>EXEC</code> instruction allows to execute its code.</p><p>A function can be partially applied (i.e. partially resolved) with the <code>APPLY</code> instruction. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lambda-definition-with-lambda"></a>Lambda definition with <code>LAMBDA</code><a class="hash-link" href="#lambda-definition-with-lambda" title="Direct link to heading">#</a></h4><p>The <code>LAMBDA</code> instruction pushes an anonymous function on top of the stack. The function is an element like others being pushed on the stack excepts that only a few instructions may be applied on this kind of element. A lambda can be executed with the <code>EXEC</code> instruction if lambda arguments have been provided on the stack. A lambda can be partially resolved (i.e. producing a new lambda function) with the <code>APPLY</code> instruction. </p><p>The <code>LAMBDA</code> instruction requires three arguments:</p><ul><li>the type of the function argument</li><li>the type returned by the function</li><li>the sequence of instructions associated with the function (code of the function)</li></ul><p>Michelson grammar defines the <code>LAMBDA</code> instruction as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">LAMBDA</span><span class="token plain"> _ _ code </span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain">  code </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">S</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that &quot;_&quot; represents any type. So, a <code>lambda</code> takes and returns arguments that can be of any type.</p><p>Here is an example of a smart contract that defines a function with the <code>LAMBDA</code> instruction and executes the function with the <code>EXEC</code> instruction.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">LAMBDA</span><span class="token plain"> int int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">EXEC</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>lambda</code> function is just incrementing a given int.</p><p>The execution of this smart contract is described in the example section.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lambda-execution-with-exec"></a>Lambda execution with <code>EXEC</code><a class="hash-link" href="#lambda-execution-with-exec" title="Direct link to heading">#</a></h4><p>The <code>EXEC</code> instruction executes a function from the stack.</p><p>The <code>EXEC</code> instruction consumes a function and its related input arguments on top of the stack. The <code>EXEC</code> instruction produces the expected function output on the top of the stack.</p><p>Here is an example of a smart contract that defines a function with the <code>LAMBDA</code> instruction and executes the function with the <code>EXEC</code> instruction.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">parameter int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">storage int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">code </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">LAMBDA</span><span class="token plain"> int int </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> int </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">EXEC</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that the code of the <code>LAMBDA</code> function just increments a given integer by 1.</p><p>The execution of this smart contract is described in the &quot;example&quot; section.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="partially-resolving-functions-with-apply"></a>Partially resolving functions with <code>APPLY</code><a class="hash-link" href="#partially-resolving-functions-with-apply" title="Direct link to heading">#</a></h4><p>The <code>APPLY &#x27;a</code> instruction partially applies a <em>tuplified</em> function from the stack (i.e. arguments are grouped in pairs or nested pairs). It is parameterized by a type <code>&#x27;a</code>. Values that are not both push-able and storable (i.e. values of type <em>operation</em>, <em>contract</em>, and <em>big map</em>) cannot be captured by <em>APPLY</em> (and so cannot appear in argument <code>&#x27;a</code>).</p><p>The instruction produces a new function that is only partially resolved. For example, if a function takes 2 arguments, it is possible to provide one argument and to use the <code>APPLY</code> instruction to produce an equivalent partially-resolved function which takes one argument.</p><p>Michelson grammar defines the <code>APPLY</code> instruction as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&#x27;a : lambda (pair &#x27;</span><span class="token plain">a </span><span class="token string">&#x27;b) &#x27;</span><span class="token plain">c </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&#x27;C   -&gt;   lambda &#x27;</span><span class="token plain">b </span><span class="token string">&#x27;c : &#x27;</span><span class="token constant" style="color:rgb(100, 102, 149)">C</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">APPLY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">f</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> &#x27;a a </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> f </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">S</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>For example, let&#x27;s consider a <code>lambda</code> function (called <em>additionAB</em>) that takes a pair of <em>nat</em> and returns a <em>nat</em>. It computes the addition of two numbers.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">LAMBDA</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">pair nat nat</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> nat </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice that the function is &#x27;tuplified&#x27;.</p><p>The <code>APPLY</code> instruction allows a new <code>lambda</code> function to be formed (called <em>addition2B</em>) which takes a single <em>nat</em> as argument and returns a <em>nat</em>. This function would increment a given <em>nat</em> by two. </p><p>The resulting function <em>addition2B</em> is equivalent to:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token constant" style="color:rgb(100, 102, 149)">LAMBDA</span><span class="token plain"> nat nat </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUSH</span><span class="token plain"> nat </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="iterative-processing"></a>Iterative processing<a class="hash-link" href="#iterative-processing" title="Direct link to heading">#</a></h3><p>The Michelson language supports repetitive processing. As seen the previous sections, the collection types (set, list, map) supports the <code>ITER</code> instruction allowing to parse each element of the collection and applying a sequence of instruction to each element.</p><p>The example (<a href="https://opentezos.com/michelson/examples#example-2--maximum-of-a-list-with-iter-and-cmple" target="_blank" rel="noopener noreferrer">#2</a> in the &quot;Examples&quot; section illustrates the <code>ITER</code> instruction usage on <em>list</em> type.</p><p>There are also two other instructions allowing repetitive processing: the <code>LOOP</code> and the <code>LOOP_LEFT</code> instructions.
The <code>LOOP</code> instructions have access to the stack and the repetitiveness of the process is controlled by boolean on the stack. It is very similar to <em>while</em> operators in other languages.</p><p>The <code>LOOP_LEFT</code> instruction is a bit more complex and allows to handle a repetitive process with an accumulator. An accumulator is an element used for aggregating data during a repetitive process. The <code>LOOP_LEFT</code> is based on <em>union</em> type for storing the accumulator and controlling the repetition.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="loop-"></a>LOOP {}<a class="hash-link" href="#loop-" title="Direct link to heading">#</a></h4><p>The <code>LOOP</code> instruction is a generic loop, i.e. it repeatedly applies a sequence of instructions (called &quot;body&quot;) many times until a condition is reached. The condition is tested before each application of the sequence.</p><p>The <code>LOOP</code> instruction consumes a boolean value on top of the stack. If the value is true then the &#x27;body&quot; sequence is applied; otherwise the repetitive process is stopped. </p><div class="root_2W3B"><p>This &quot;body&quot; sequence of instructions must recompute and push the boolean condition on top of the stack in order to make the process repeatable).</p></div><p>The <code>LOOP</code> instruction makes it possible to iterate on a composite structure (list, set, map, big_map) and apply a process to all elements sequentially.</p><p>The example (<a href="https://opentezos.com/michelson/examples#example-1--modulo-with-loop-and-if" target="_blank" rel="noopener noreferrer">#1</a> in the &quot;Examples&quot; section illustrates the <code>LOOP</code> instruction usage by implementing a modulo function.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="loop_left-loop-with-accumulator"></a>LOOP_LEFT (loop with accumulator)<a class="hash-link" href="#loop_left-loop-with-accumulator" title="Direct link to heading">#</a></h4><p>Like the <code>LOOP</code> instruction, <code>LOOP_LEFT {}</code> is a generic loop that handles accumulators generally used for aggregating data during a repetitive process. </p><p>The <code>LOOP_LEFT {}</code> takes a sequence of instructions as an argument and requires a <code>union</code> (composed of a given data structure and an accumulator) on top of the stack. </p><p>If the left part of the <code>union</code> is initialized the process is repeated (i.e. the value of the <em>union</em> defines the left branch <code>LEFT &lt;datatype&gt; &lt;value&gt;</code>).
If the right part is initialized (i.e. the value of the <em>union</em> defines the right branch <code>RIGHT &lt;datatype&gt; &lt;value&gt;</code>) then the process is stopped and the accumulator is returned.</p><p>Two examples (<a href="https://opentezos.com/michelson/examples#example-4--computing-a-sum-with-loop_left" target="_blank" rel="noopener noreferrer">#4</a> and <a href="https://opentezos.com/michelson/examples#example-5--computing-a-factorial-with-loop_left" target="_blank" rel="noopener noreferrer">#5</a>) in the <em>Examples</em> section describe in detail the <code>LOOP_LEFT</code> instruction usage.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="more-detail-in-the-instructions-section"></a>More detail in the &quot;Instructions&quot; section<a class="hash-link" href="#more-detail-in-the-instructions-section" title="Direct link to heading">#</a></h3><p>This &quot;Tutorial&quot; part ends, with hope that you have had a satisfying introduction to the Michelson language.</p><p>More detail about macros and syntactic sugar are available int the &quot;Instructions&quot; section.</p><p>For more advanced Michelson programmers, there are other concepts such as cryptographic features and annotations that are described in the &quot;Instructions&quot; section. </p><p>As the Michelson language is part of the protocol it is destined to change and thus many other features may be supported in the future, bringing new possibilities like anonymity (with sapling techniques) or allowing for the stamping of atomic information (with tickets).</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/octo-technology/OpenTezos/tree/main/docs/michelson/tutorial.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-05-31T20:13:56.000Z" class="lastUpdatedDate_1WI_">5/31/2021</time> by <strong>AymericBethencourt</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/michelson/smart-contracts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Smart Contracts</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/michelson/examples"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Examples ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#stack-programming" class="table-of-contents__link">Stack programming</a></li><li><a href="#primitive-types-support" class="table-of-contents__link">Primitive types support</a></li><li><a href="#working-with-complex-data-structures" class="table-of-contents__link">Working with complex data structures</a></li><li><a href="#contract-specific-types-and-operations" class="table-of-contents__link">Contract specific types and operations</a></li><li><a href="#lambda-functions" class="table-of-contents__link">Lambda functions</a></li><li><a href="#iterative-processing" class="table-of-contents__link">Iterative processing</a></li><li><a href="#more-detail-in-the-instructions-section" class="table-of-contents__link">More detail in the &quot;Instructions&quot; section</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 OpenTezos.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.972b4ff9.js"></script>
<script src="/assets/js/main.6ca66676.js"></script>
</body>
</html>