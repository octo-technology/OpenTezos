(self.webpackChunkopentezos=self.webpackChunkopentezos||[]).push([[9006],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return l},kt:function(){return u}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),p=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},l=function(e){var t=p(e.components);return n.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),h=p(a),u=r,d=h["".concat(c,".").concat(u)]||h[u]||m[u]||i;return a?n.createElement(d,o(o({ref:t},l),{},{components:a})):n.createElement(d,o({ref:t},l))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},7705:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var n=a(7294),r="root_2W3B",i=function(e){var t=e.children;return n.createElement("div",{className:r},t)}},9692:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return m}});var n=a(2122),r=a(9756),i=(a(7294),a(3905)),o=a(7705),s={id:"smart-contracts",disable_pagination:!0,title:"Smart Contracts",authors:"Thomas Zoughebi"},c={unversionedId:"blockchain-basics/smart-contracts",id:"blockchain-basics/smart-contracts",isDocsHomePage:!1,title:"Smart Contracts",description:"In this chapter, we're going to explain how and why Bitcoin's programming features are limited. We'll define what are Smart Contracts and how they are already present on Bitcoin. And finally, what is Gas and why it was introduced on Ethereum.",source:"@site/docs/blockchain-basics/smart-contracts.md",sourceDirName:"blockchain-basics",slug:"/blockchain-basics/smart-contracts",permalink:"/blockchain-basics/smart-contracts",editUrl:"https://github.com/octo-technology/OpenTezos/tree/main/docs/blockchain-basics/smart-contracts.md",version:"current",lastUpdatedBy:"ThomasZoughebi",lastUpdatedAt:1622477141,formattedLastUpdatedAt:"5/31/2021",frontMatter:{id:"smart-contracts",disable_pagination:!0,title:"Smart Contracts",authors:"Thomas Zoughebi"},sidebar:"docs",previous:{title:"Introduction to other consensus algorithms",permalink:"/blockchain-basics/other-consensuses"},next:{title:"Exam",permalink:"/blockchain-basics/exam"}},p=[{value:"Limitations of Bitcoin",id:"limitations-of-bitcoin",children:[]},{value:"Definition of a &quot;smart&quot; contract",id:"definition-of-a-smart-contract",children:[]},{value:"Halting problem of Turing-complete machines and Gas",id:"halting-problem-of-turing-complete-machines-and-gas",children:[]},{value:"What have we learned so far?",id:"what-have-we-learned-so-far",children:[]},{value:"References",id:"references",children:[]}],l={toc:p};function m(e){var t=e.components,a=(0,r.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"In this chapter, we're going to explain how and why Bitcoin's programming features are limited. We'll define what are ",(0,i.kt)("em",{parentName:"p"},"Smart Contracts")," and how they are already present on Bitcoin. And finally, what is ",(0,i.kt)("em",{parentName:"p"},"Gas")," and why it was introduced on Ethereum."),(0,i.kt)("h2",{id:"limitations-of-bitcoin"},"Limitations of Bitcoin"),(0,i.kt)("p",null,"The primary use case of Bitcoin is to be ",(0,i.kt)("em",{parentName:"p"},"distributed digital currency"),". It's also an ",(0,i.kt)("em",{parentName:"p"},"augmented")," currency that is a ",(0,i.kt)("em",{parentName:"p"},"programmable")," currency, with such things as programmable ",(0,i.kt)("strong",{parentName:"p"},"spending conditions"),"."),(0,i.kt)("p",null,"The metaphor of ",(0,i.kt)("strong",{parentName:"p"},"vaults")," is meaningful as bitcoins are ",(0,i.kt)("strong",{parentName:"p"},"always locked inside ",(0,i.kt)("em",{parentName:"strong"},"transactions")),"."),(0,i.kt)("p",null,"Programable conditions for Bitcoin describe ",(0,i.kt)("strong",{parentName:"p"},"how")," vaults can be opened and ",(0,i.kt)("em",{parentName:"p"},"bitcoins moved to other vaults"),"."),(0,i.kt)("p",null,"The low-level language used to describe these spending conditions is called ",(0,i.kt)("em",{parentName:"p"},"Script"),". By extension, we call it ",(0,i.kt)("em",{parentName:"p"},"Bitcoin Script")," ",(0,i.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts#references"},"[1]"),". It is inspired by ",(0,i.kt)("em",{parentName:"p"},"Forth")," ",(0,i.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts#references"},"[2]")," by Charles H. Moore. Both ",(0,i.kt)("em",{parentName:"p"},"Forth")," and ",(0,i.kt)("em",{parentName:"p"},"Bitcoin Script")," are ",(0,i.kt)("em",{parentName:"p"},"stack-based")," languages ",(0,i.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts#references"},"[3]"),"."),(0,i.kt)("p",null,"Below is the ",(0,i.kt)("em",{parentName:"p"},"legacy")," code (before ",(0,i.kt)("a",{parentName:"p",href:"https://en.bitcoin.it/wiki/Segregated_Witness"},(0,i.kt)("em",{parentName:"a"},"Segregated Witness"))," activation) that allows the simplest transaction from one vault to another ",(0,i.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts#references"},"[4]"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"OP_DUP OP_HASH160 <pubKeyHash> OP_EQUALVERIFY OP_CHECKSIG\n")),(0,i.kt)("p",null,'Operands are in-between "',(0,i.kt)("strong",{parentName:"p"},"<"),'" and "',(0,i.kt)("strong",{parentName:"p"},">"),'", while operators are in capitals and begin with "',(0,i.kt)("strong",{parentName:"p"},"OP_"),'".'),(0,i.kt)("p",null,"If ",(0,i.kt)("strong",{parentName:"p"},"the awaited ",(0,i.kt)("em",{parentName:"strong"},"public key"))," and a ",(0,i.kt)("strong",{parentName:"p"},"valid corresponding ",(0,i.kt)("em",{parentName:"strong"},"signature"))," are provided, the vault is opened:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<sig> <pubKey> \n")),(0,i.kt)("p",null,"Because ",(0,i.kt)("em",{parentName:"p"},"Bitcoin Script")," is stack-based, the complete code executed is:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<sig> <pubKey> OP_DUP OP_HASH160 <pubKeyHash> OP_EQUALVERIFY OP_CHECKSIG\n")),(0,i.kt)("p",null,'So, in the stack, the solution "',(0,i.kt)("inlineCode",{parentName:"p"},"<sig> <pubKey>"),'" (key to open the vault) has to be provided here first, before the problem "',(0,i.kt)("inlineCode",{parentName:"p"},"OP_DUP OP_HASH160 <pubKeyHash> OP_EQUALVERIFY OP_CHECKSIG"),'" (lock of the vault).'),(0,i.kt)("p",null,"The fact that ",(0,i.kt)("em",{parentName:"p"},"Bitcoin Script")," is a low-level and stack-based language does not actually limit coding possibilities. For instance, at the same low-level, ",(0,i.kt)("em",{parentName:"p"},"Ethereum")," also uses ",(0,i.kt)("a",{parentName:"p",href:"https://www.ethervm.io/"},"OP_codes")," and a stack ",(0,i.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts#references"},"[5]"),". EVM code is the ",(0,i.kt)("em",{parentName:"p"},"Bitcoin Script")," of ",(0,i.kt)("em",{parentName:"p"},"Ethereum"),"."),(0,i.kt)("p",null,"The first limitation is the number and types of usable ",(0,i.kt)("em",{parentName:"p"},"OP_codes"),". For security purposes, various ",(0,i.kt)("em",{parentName:"p"},"OP_codes")," are either absent, or have been disabled ",(0,i.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts#references"},"[1]")," following the discovery of vulnerabilities."),(0,i.kt)("p",null,"Certain absences of ",(0,i.kt)("em",{parentName:"p"},"OP_codes")," are also voluntary. They could lead to errors and out-of-control operations. This means ",(0,i.kt)("em",{parentName:"p"},"Bitcoin Script")," is ",(0,i.kt)("strong",{parentName:"p"},"willingly non-turing complete"),". For instance, it is impossible to create a ",(0,i.kt)("strong",{parentName:"p"},"loop")," with ",(0,i.kt)("em",{parentName:"p"},"Bitcoin Script"),"."),(0,i.kt)("p",null,"The transaction's structure also limits possibilities. Two critical points should be understood while programming with Bitcoin Script:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"a Bitcoin script is unable to know and handle the ",(0,i.kt)("strong",{parentName:"li"},"transaction amount")," inside"),(0,i.kt)("li",{parentName:"ul"},"a Bitcoin script is ",(0,i.kt)("strong",{parentName:"li"},"unaware of anything happening outside the stack"),". It ",(0,i.kt)("strong",{parentName:"li"},"can't access the blockchain data"),".")),(0,i.kt)("p",null,'Finally, because of the "',(0,i.kt)("em",{parentName:"p"},"vaults"),'" system, knowing the balance of someone means checking all his/her vaults ',(0,i.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts#references"},"[6]"),".\nThis means you need to sum up the amounts of all the transactions sent to the same address in the ledger. This impacts the coding logic of Bitcoin's spending conditions, again because you can't use the balance of a private key inside the code.\nThis is a significant difference with systems like Ethereum, which have an ",(0,i.kt)("em",{parentName:"p"},"account")," point of view: you can directly use the amounts and balances inside your codes."),(0,i.kt)("h2",{id:"definition-of-a-smart-contract"},'Definition of a "smart" contract'),(0,i.kt)("p",null,'The very first definition of "',(0,i.kt)("em",{parentName:"p"},"Smart Contracts"),'" is originally from Nick Szabo ',(0,i.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts#references"},"[7]")," in 1996 ",(0,i.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts#references"},"[8]"),":"),(0,i.kt)(o.Z,{mdxType:"NotificationBar"},(0,i.kt)("p",null,(0,i.kt)("blockquote",null,'"A smart contract is a set of promises, specified in digital form, including protocols within which the parties perform on these promises." \u2014 Nick Szabo'))),(0,i.kt)("p",null,"This definition is pretty hard to understand because very general."),(0,i.kt)("p",null,"A smart contract is a ",(0,i.kt)("strong",{parentName:"p"},"code")," stored inside the ",(0,i.kt)("em",{parentName:"p"},"blockchain"),". It executes a set of pre-defined instructions (promises). Once deployed (stored), it becomes ",(0,i.kt)("strong",{parentName:"p"},"immutable"),". A smart contract is deployed using a ",(0,i.kt)("strong",{parentName:"p"},"transaction"),", so we embed spending conditions inside it, which are then ",(0,i.kt)("strong",{parentName:"p"},"immutable"),". We will go into more detail about this immutability in the ",(0,i.kt)("a",{parentName:"p",href:"/tezos-basics/introduction"},"Tezos Basics module"),"."),(0,i.kt)("p",null,"Strictly speaking, a Bitcoin transaction is a smart contract. The ",(0,i.kt)("strong",{parentName:"p"},"promise")," to open the ",(0,i.kt)("em",{parentName:"p"},"vault")," from one party is fulfilled, given that the other party has the right ",(0,i.kt)("em",{parentName:"p"},"key")," to open it. Note that ",(0,i.kt)("em",{parentName:"p"},"the way")," this key is provided is also meaningful here. It must follow ",(0,i.kt)("strong",{parentName:"p"},"protocols"),"."),(0,i.kt)("h2",{id:"halting-problem-of-turing-complete-machines-and-gas"},"Halting problem of Turing-complete machines and Gas"),(0,i.kt)("p",null,"To increase the possibilities for smart contracts, more ",(0,i.kt)("em",{parentName:"p"},"OP_codes")," had to be incorporated than inside blockchain systems. With Ethereum, adding these ",(0,i.kt)("em",{parentName:"p"},"OP_codes")," made its low-level language ",(0,i.kt)("em",{parentName:"p"},"Turing-complete"),". This meant that from this moment on, one could program any operation, including ",(0,i.kt)("em",{parentName:"p"},"jumps")," and ",(0,i.kt)("em",{parentName:"p"},"loops"),"."),(0,i.kt)("p",null,"A loop is a problem for Turing-complete machine, especially the ones that use a currency to function. If we can't control the halt of the machine and it starts an endless loop, we can't control the infinite spending of the currency either."),(0,i.kt)("p",null,"So the idea in Ethereum was to introduce another variable to stop the machine: ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Gas")),". A machine running on gas can't move endlessly without enough gas. That's exactly what's happening with Ethereum smart contracts. Gas, which is a sub-unit of the ",(0,i.kt)("em",{parentName:"p"},"Ether")," currency, is consumed with each operation."),(0,i.kt)("p",null,"Gas consumption isn't the same for all operations because certain operations are more complex than others. The miners who also execute these operations receive the Gas as fees for using their computational power."),(0,i.kt)("h2",{id:"what-have-we-learned-so-far"},"What have we learned so far?"),(0,i.kt)("p",null,"In this chapter, we learned what are ",(0,i.kt)("em",{parentName:"p"},"Smart Contracts"),", the limiting factors of Bitcoin's smart contracts, and how ",(0,i.kt)("em",{parentName:"p"},"Gas")," was introduced to lift them."),(0,i.kt)("p",null,'This chapter concludes the "',(0,i.kt)("em",{parentName:"p"},"Blockchain Basics"),'" module. The next module will focus on the basics of Tezos.'),(0,i.kt)("h2",{id:"references"},"References"),(0,i.kt)("p",null,"[1]"," ",(0,i.kt)("a",{parentName:"p",href:"https://en.bitcoin.it/wiki/Script"},"https://en.bitcoin.it/wiki/Script")),(0,i.kt)("p",null,"[2]"," ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Forth_(programming_language)"},"https://en.wikipedia.org/wiki/Forth_(programming_language)")),(0,i.kt)("p",null,"[3]"," ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Stack-oriented_programming"},"https://en.wikipedia.org/wiki/Stack-oriented_programming")),(0,i.kt)("p",null,"[4]"," ",(0,i.kt)("a",{parentName:"p",href:"https://en.bitcoin.it/wiki/Transaction#Pay-to-PubkeyHash"},"https://en.bitcoin.it/wiki/Transaction#Pay-to-PubkeyHash")),(0,i.kt)("p",null,"[5]"," ",(0,i.kt)("a",{parentName:"p",href:"https://ethereum.org/en/developers/docs/evm/"},"https://ethereum.org/en/developers/docs/evm/")),(0,i.kt)("p",null,"[6]"," ",(0,i.kt)("a",{parentName:"p",href:"https://en.bitcoin.it/wiki/UTXO"},"https://en.bitcoin.it/wiki/UTXO")),(0,i.kt)("p",null,"[7]"," ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Nick_Szabo"},"https://en.wikipedia.org/wiki/Nick_Szabo")),(0,i.kt)("p",null,"[8]"," ",(0,i.kt)("a",{parentName:"p",href:"https://www.fon.hum.uva.nl/rob/Courses/InformationInSpeech/CDROM/Literature/LOTwinterschool2006/szabo.best.vwh.net/smart_contracts_2.html"},"https://www.fon.hum.uva.nl/rob/Courses/InformationInSpeech/CDROM/Literature/LOTwinterschool2006/szabo.best.vwh.net/smart_contracts_2.html")))}m.isMDXComponent=!0}}]);