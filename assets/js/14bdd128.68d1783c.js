(self.webpackChunkopentezos=self.webpackChunkopentezos||[]).push([[7622],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return p},kt:function(){return d}});var s=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,s,n=function(e,t){if(null==e)return{};var a,s,n={},r=Object.keys(e);for(s=0;s<r.length;s++)a=r[s],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)a=r[s],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var c=s.createContext({}),l=function(e){var t=s.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=l(e.components);return s.createElement(c.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},u=s.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,c=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=l(a),d=n,m=u["".concat(c,".").concat(d)]||u[d]||h[d]||r;return a?s.createElement(m,i(i({ref:t},p),{},{components:a})):s.createElement(m,i({ref:t},p))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,i=new Array(r);i[0]=u;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:n,i[1]=o;for(var l=2;l<r;l++)i[l]=a[l];return s.createElement.apply(null,i)}return s.createElement.apply(null,a)}u.displayName="MDXCreateElement"},6871:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return i},metadata:function(){return o},toc:function(){return c},default:function(){return p}});var s=a(2122),n=a(9756),r=(a(7294),a(3905)),i={id:"cross-chain-swaps",title:"Cross-chain Swaps",author:"Aymeric Bethencourt"},o={unversionedId:"defi/cross-chain-swaps",id:"defi/cross-chain-swaps",isDocsHomePage:!1,title:"Cross-chain Swaps",description:"Swap scenarios",source:"@site/docs/defi/cross-chain-swaps.md",sourceDirName:"defi",slug:"/defi/cross-chain-swaps",permalink:"/defi/cross-chain-swaps",editUrl:"https://github.com/octo-technology/OpenTezos/tree/main/docs/defi/cross-chain-swaps.md",version:"current",lastUpdatedBy:"AymericBethencourt",lastUpdatedAt:1620327772,formattedLastUpdatedAt:"5/6/2021",frontMatter:{id:"cross-chain-swaps",title:"Cross-chain Swaps",author:"Aymeric Bethencourt"},sidebar:"docs",previous:{title:"Wrapped Assets",permalink:"/defi/wrapped-assets"},next:{title:"On-chain Oracles",permalink:"/defi/oracles"}},c=[{value:"Swap scenarios",id:"swap-scenarios",children:[{value:"Using a centralized exchange",id:"using-a-centralized-exchange",children:[]},{value:"Using a DEX",id:"using-a-dex",children:[]},{value:"Cross chain swaps",id:"cross-chain-swaps",children:[]}]},{value:"Hash Time Lock Contracts",id:"hash-time-lock-contracts",children:[]},{value:"Cross-chain swaps on Tezos",id:"cross-chain-swaps-on-tezos",children:[]},{value:"References",id:"references",children:[]}],l={toc:c};function p(e){var t=e.components,i=(0,n.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,s.Z)({},l,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"swap-scenarios"},"Swap scenarios"),(0,r.kt)("p",null,"Let's consider the following scenario: Alice has 100 XTZ and wants to exchange them for 0.1 BTC from Bob. How does she proceed? There are multiple ways:"),(0,r.kt)("h3",{id:"using-a-centralized-exchange"},"Using a centralized exchange"),(0,r.kt)("p",null,"One way is to use a centralized exchange like Binance. This means that you trust them to store your tokens and process the transaction correctly securely. But this way is built on a single point of failure that could, potentially, fail at any time. ",(0,r.kt)("a",{parentName:"p",href:"https://www.binance.com/en/blog/336904059293999104/Security-Incident-Recap"},"Binance was hacked in 2019, and 7,000 bitcoins were stolen.")," In addition, exchanges usually take a fee for the service they offer. Is there a better solution? Could we use a DEX instead?"),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(4062).Z})),(0,r.kt)("small",{className:"figure"},"FIGURE 1: Illustration of non-atomic swap on a centralized exchange"),(0,r.kt)("h3",{id:"using-a-dex"},"Using a DEX"),(0,r.kt)("p",null,"Using a DEX is a great solution for making trustless token swaps. However, they only work within the same blockchain network. ",(0,r.kt)("em",{parentName:"p"},"Dexter")," and ",(0,r.kt)("em",{parentName:"p"},"Quipuswap")," only work on Tezos and only with FA1.2 or FA2 tokens. So what if I want to exchange some XTZ against some BTC? One way is to use wrapped assets as seen in the ",(0,r.kt)("a",{parentName:"p",href:"defi/wrapped-assets"},"previous chapter")," and exchange wrapped XTZ (wXTZ) against wrapped BTC (tzBTC) on a Tezos DEX. However, this increases the difficulty of the process as you have to wrap and unwrap tokens. Additionally you have to trust that the smart contract that allows you to unwrap your tzBTC for actual BTC is secured. So, is there a fully trustless solution?"),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(1395).Z})),(0,r.kt)("small",{className:"figure"},"FIGURE 2: Illustration of non-atomic swap on a decentralized exchange"),(0,r.kt)("h3",{id:"cross-chain-swaps"},"Cross chain swaps"),(0,r.kt)("p",null,"A ",(0,r.kt)("em",{parentName:"p"},"cross-chain swap")," (also referred to as an ",(0,r.kt)("em",{parentName:"p"},"Atomic Swap"),") refers to exchanging two different cryptocurrencies on different blockchains in a peer-to-peer fashion, i.e., without using a third party. This is possible thanks to code locking mechanisms known as ",(0,r.kt)("strong",{parentName:"p"},"Hash Time Locked Contracts (HTLCs)")," codeable into blockchain transactions. For this, Alice and Bob have to proceed as follows :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Alice deposits her XTZ into an HTLC smart contract which acts like a safe and locks the funds. When this safe is created, Alice also generates a key to access it.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Alice shares a cryptographic hash of this key with Bob. Note that Bob can't access the XTZ yet because he only has the key's hash and not the key itself.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Bob uses the hash provided by Alice to create another HTLC smart contract, in which he deposits his BTC (",(0,r.kt)("a",{parentName:"p",href:"/blockchain-basics/smart-contracts"},"Bitcoin is indeed capable of running basic smart contracts")," such as HTLC). ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To claim the BTC, Alice is required to use that same key and, by doing so, she reveals it to Bob (thanks to a particular function called ",(0,r.kt)("em",{parentName:"p"},"hashlock")," from HTLC). ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"This means that as soon as Alice claims the BTC, Bob can claim the XTZ and the swap is complete."))),(0,r.kt)("p",null,"The term ",(0,r.kt)("strong",{parentName:"p"},"atomic")," relates to the fact that these transactions either happen entirely or not at all. If any of the parties give up or fails to do what they are supposed to, the contract is canceled, and the funds are automatically returned to their owners."),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(9257).Z})),(0,r.kt)("small",{className:"figure"},"FIGURE 3: Illustration of an atomic swap."),(0,r.kt)("p",null,"Alice's HTLC will time-out and refund the funds to Alice automatically if Bob never sends the funds. "),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(9207).Z})),(0,r.kt)("small",{className:"figure"},"FIGURE 4: Illustration of a failed atomic swap (Bob did not send the funds)."),(0,r.kt)("h2",{id:"hash-time-lock-contracts"},"Hash Time Lock Contracts"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Hash Timelock Contracts")," (HTLC) are one of the critical components that makes atomic swaps possible. As the name suggests, they are based on two essential functions: "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"a hashlock, which prevents funds from being spent unless a piece of data is revealed (Alice's key in the previous example)."),(0,r.kt)("li",{parentName:"ul"},"a timelock, which ensures the contract can only be executed within a predefined timeframe. ")),(0,r.kt)("p",null,"Consequently, the use of HTLCs removes the need for trust because they create a specific set of rules that prevent atomic swaps from executing partially."),(0,r.kt)("p",null,"To learn more about HTLCs, you can read ",(0,r.kt)("a",{parentName:"p",href:"https://medium.com/blockchainio/what-are-atomic-swaps-bc1d034634c9"},"this article"),"."),(0,r.kt)("h2",{id:"cross-chain-swaps-on-tezos"},"Cross-chain swaps on Tezos"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://medium.com/stakerdao/stakerbridge-eth-tez-is-live-1841cb75557d"},"StakerBridge")," by ",(0,r.kt)("a",{parentName:"li",href:"https://www.stakerdao.com/"},"StakerDAO")," is an open-source, trustless method of bi-directional transfer of tokens between Ethereum and Tezos."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://tezex.io/"},"TEZEX")," is currently in development and will enable cross-chain swaps. At first, TEZEX Bridge will allow token swaps between Ethereum and Tezos.")),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("p",null,"[1]"," ",(0,r.kt)("a",{parentName:"p",href:"https://medium.com/tezosexchange/the-changemakers-of-tezex-bridge-fd73bb1d8da2"},"https://medium.com/tezosexchange/the-changemakers-of-tezex-bridge-fd73bb1d8da2")),(0,r.kt)("p",null,"[2]"," ",(0,r.kt)("a",{parentName:"p",href:"https://liquality.io/blog/atomic-swaps-explained/"},"https://liquality.io/blog/atomic-swaps-explained/")),(0,r.kt)("p",null,"[3]"," ",(0,r.kt)("a",{parentName:"p",href:"https://academy.binance.com/en/articles/atomic-swaps-explained"},"https://academy.binance.com/en/articles/atomic-swaps-explained")))}p.isMDXComponent=!0},9207:function(e,t,a){"use strict";t.Z=a.p+"assets/images/atomic-swap-fail-76e121c9f9bb66cbf7b6b54e95131a6e.svg"},9257:function(e,t,a){"use strict";t.Z=a.p+"assets/images/atomic-swap-8942051bafebf1e524a2f80099ccd338.svg"},4062:function(e,t,a){"use strict";t.Z=a.p+"assets/images/swap-cex-01a8a74bc6f95f4bb92885b06abb9d04.svg"},1395:function(e,t,a){"use strict";t.Z=a.p+"assets/images/swap-dex-fe4b20275503bbfcc876031e019dd92b.svg"}}]);